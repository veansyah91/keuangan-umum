import{W as J,r as d,y as S,j as e,Y as q,a as h}from"./app-9a2e89b5.js";import{D as X,A as Z}from"./AuthenticatedLayout-7f13fa89.js";import{H as Q}from"./Header-cd07cfd4.js";import{k as ee,Q as v}from"./react-toastify.esm-b47c724b.js";/* empty css                      */import{c as ae}from"./index.esm-a6435f24.js";import{F as se}from"./FormInput-a610f1a3.js";import{I as o}from"./InputLabel-136cef46.js";import{T as j}from"./TextInput-96f96be1.js";import{S as le}from"./SecondaryButton-ec3f1868.js";import{P as te}from"./PrimaryButton-f753a1cf.js";import{d as D}from"./dayjs.min-30fc4208.js";import"./studyYear-7c19cd25.js";import{C as ne}from"./StudentSelectInput-b257f0ee.js";import{N as ie}from"./react-number-format.es-44999568.js";import{f as T}from"./formatNumber-b542c689.js";import{C as re}from"./ClientSelectInput-3ec885e5.js";import me from"./ReceivableListBox-3bd35b21.js";import{a as de,u as oe}from"./index.module-dde64431.js";import"./ApplicationLogo-c42a5f47.js";import"./iconBase-bc6ea5d4.js";import"./transition-10f39bd0.js";import"./combobox-5e25dd40.js";import"./portal-69f187ce.js";function ce({organization:r,newRef:N,contacts:P,contact:ue,date:p,selectedContactQuery:n,studyYears:xe,cashAccounts:R,payments:i,whatsappPlugin:_}){const{data:t,setData:m,processing:I,post:Y,errors:s,setError:F,reset:C}=J({contact_id:n?n.id:null,date:p,level:n?n.last_level.level:"",student_id:n?n.student.no_ref:"",no_ref:N,value:i.length>0?i[0].receivable_value:0,paidValue:0,description:n?`Pembayaran Piutang Iuran Tahunan Oleh ${n.name}`:"",payment_id:i.length>0?i[0].id:null,cash_account_id:null,send_wa:_}),[c,b]=d.useState({id:n?n.id:null,name:n?n.name:"",phone:n?n.phone:""}),[u,y]=d.useState({id:null,name:"",code:"",is_cash:!0}),[x,w]=d.useState({id:i.length>0?i[0].id:null,noRef:i.length>0?i[0].no_ref:"",receivablevalue:i.length>0?i[0].receivable_value:0,studyYear:i.length>0?i[0].study_year:""}),[E,k]=d.useState(i),[f,V]=d.useState({startDate:p,endDate:p}),[A]=de(f,500),O=oe(f);d.useEffect(()=>{g(N)},[]),d.useEffect(()=>{setTimeout(()=>{c.id&&K()},0)},[c]),d.useEffect(()=>{O!==void 0&&f.startDate&&B()},[A]);const B=()=>{S.reload({only:["newRef"],data:{date:D(f.startDate).format("YYYY-MM-DD")},onSuccess:a=>{m("no_ref",a.props.newRef)}})},K=()=>{S.reload({only:["payments"],data:{selectedContact:c.id},onSuccess:({props:a})=>{const{payments:l}=a;m({...t,value:l[0].receivable_value,payment_id:l[0].id}),k(l),w({id:l[0].id,noRef:l[0].no_ref,receivablevalue:l[0].receivable_value,studyYear:l[0].study_year})}})},g=a=>{let l=t;l={...l,date:p,no_ref:a,paidValue:0,value:0,cash_account_id:null},m(l)},M=a=>{a.preventDefault(),Y(route("cashflow.student-entry-receivable-payment.store",r.id),{only:["newRef","flash"],onSuccess:({props:l})=>{const{flash:G,newRef:W}=l;C(),v.success(G.success,{position:v.POSITION.TOP_CENTER}),y({id:null,name:"",code:"",is_cash:!0}),b({id:null,name:"",phone:""}),w({id:null,noRef:"",receivablevalue:0,studyYear:""}),g(W)},onError:l=>{v.error(l.error,{position:v.POSITION.TOP_CENTER})},preserveScroll:!1,preserveState:!0})},U=a=>{V(a),m("date",D(a.startDate).format("YYYY-MM-DD"))},$=a=>{if(a){b({id:a?a.id:null,name:a?a.name:"",phone:a?a.phone:""});let l=t;l={...l,contact_id:a?a.id:null,description:`Pembayaran Iuran Tahunan dari ${a?a.name.toUpperCase():""}`,student_id:a?a.student.no_ref:"",level:a?a.last_level.level:""},m(l)}},z=a=>{a&&(y({id:a.id,name:a.name,code:a.code,is_cash:!0}),m("cash_account_id",a.id),F("cash_account_id",""))},H=a=>{const{value:l}=a;m("paidValue",parseInt(l)??0)},L=a=>{a&&w({id:a.id,noRef:a.no_ref,receivablevalue:a.receivable_value,studyYear:a.study_year})};return e.jsxs(e.Fragment,{children:[e.jsx(q,{title:"Piutang Iuran Tahunan Siswa"}),e.jsx(ee,{}),e.jsx(se,{onSubmit:M,children:e.jsx("div",{className:"w-full sm:mt-2 sm:py-5",children:e.jsxs("div",{className:"sm:w-1/2 sm:mx-auto px-3 sm:px-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(o,{value:"No. Ref",htmlFor:"no_ref",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(j,{id:"no_ref",name:"no_ref",className:`w-full ${(s==null?void 0:s.no_ref)&&"border-red-500"}`,placeholder:"No. Ref",value:t.no_ref||"",onChange:a=>m("no_ref",a.target.value.toUpperCase())}),(s==null?void 0:s.no_ref)&&e.jsx("span",{className:"text-red-500 text-xs",children:s.no_ref})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(o,{value:"Tanggal",htmlFor:"date",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx("div",{children:e.jsx(X,{value:f,onChange:U,inputClassName:(s==null?void 0:s.date)&&"border-red-500 rounded-lg",useRange:!1,asSingle:!0,placeholder:"Tanggal",inputId:"date",displayFormat:"MMMM DD, YYYY"})}),(s==null?void 0:s.date)&&e.jsx("span",{className:"text-red-500 text-xs",children:s.date})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(o,{value:"Nama Siswa",htmlFor:"name",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(ne,{resources:P,selected:c,setSelected:a=>$(a),maxHeight:"max-h-40",placeholder:"Cari Kontak",isError:!!s.contact_id,id:"name",notFound:e.jsxs("span",{children:["Tidak Ada Data. ",e.jsx(h,{className:"font-bold text-blue-600",href:route("data-master.students.create",{organization:r.id}),children:"Buat Baru ?"})]})}),(s==null?void 0:s.name)&&e.jsx("span",{className:"text-red-500 text-xs",children:s.name})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(o,{value:"No. Siswa",htmlFor:"student_id",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(j,{id:"student_id",name:"student_id",className:`w-full ${(s==null?void 0:s.student_id)&&"border-red-500"}`,placeholder:"No. Siswa",value:t.student_id||"",onChange:a=>m("student_id",a.target.value.toUpperCase()),disabled:!0}),(s==null?void 0:s.student_id)&&e.jsx("span",{className:"text-red-500 text-xs",children:s.student_id})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(o,{value:"Kelas",htmlFor:"level",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(j,{id:"level",name:"level",className:`w-full ${(s==null?void 0:s.level)&&"border-red-500"}`,placeholder:"Kelas",value:t.level||"",onChange:a=>m("level",a.target.value.toUpperCase()),disabled:!0}),(s==null?void 0:s.level)&&e.jsx("span",{className:"text-red-500 text-xs",children:s.level})]})]}),e.jsx("div",{className:"text-center mt-5 font-bold",children:"Rincian Pembayaran"}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(o,{value:"No Ref",htmlFor:"payment",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(me,{id:"payment",payments:E,isError:!1,selected:x,setSelected:a=>L(a)}),(x==null?void 0:x.studyYear)&&e.jsxs("div",{className:"absolute text-xs",children:["Tahun Ajaran: ",x.studyYear]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 pt-5 sm:mt-2 font-bold text-xl",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:"TOTAL PIUTANG"}),e.jsxs("div",{className:"w-full sm:w-2/3 text-end",children:["Rp. ",T(t.value)]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(o,{value:"Jumlah Bayar",htmlFor:"paid-value",className:" mx-auto my-auto"})}),e.jsx("div",{className:"w-full sm:w-2/3",children:e.jsx(ie,{value:t.paidValue,customInput:j,onValueChange:a=>H(a),thousandSeparator:!0,className:"text-end w-full border",prefix:"IDR ",id:"paid-value"})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:"Sisa"}),e.jsxs("div",{className:"w-full sm:w-2/3 text-end",children:["Rp. ",T(t.value-t.paidValue)]})]}),t.paidValue>0&&e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(o,{value:"Akun Kas",htmlFor:"account",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(re,{resources:R,selected:u,setSelected:a=>z(a),maxHeight:"max-h-40",placeholder:"Cari Akun",isError:!!s.cash_account_id,id:"account",contactFilter:""}),(u==null?void 0:u.code)&&e.jsxs("div",{className:"absolute text-xs",children:["Kode: ",u.code]}),(s==null?void 0:s.cash_account_id)&&e.jsx("span",{className:"text-red-500 text-xs",children:s.cash_account_id})]})]}),_&&c.phone&&e.jsx("div",{className:"md:w-1/3 w-2/3 mt-5",children:e.jsx("div",{className:"form-control ",children:e.jsxs("label",{className:"label cursor-pointer",htmlFor:"send_wa",children:[e.jsx("input",{type:"checkbox",className:"checkbox",id:"send_wa",value:t.send_wa,onChange:()=>m("send_wa",!t.send_wa),checked:t.send_wa}),e.jsx("span",{className:"label-text",children:"Kirim Bukti Via WhatsApp"})]})})}),e.jsxs("div",{className:"flex justify-end flex-col-reverse sm:flex-row gap-2 mt-5",children:[e.jsx("div",{className:"w-full sm:w-1/6 my-auto text-center",children:e.jsx(h,{href:route("cashflow.student-entry-receivable-payment",r.id),children:e.jsx(le,{className:"w-full",children:e.jsx("div",{className:"text-center w-full",children:"Kembali"})})})}),t.value-t.paidValue>=0&&t.cash_account_id&&e.jsx("div",{className:"w-full sm:w-1/6 text-center",children:e.jsx(te,{className:"w-full",disabled:I,children:e.jsx("div",{className:"text-center w-full",children:"Simpan"})})})]})]})})})]})}ce.layout=r=>e.jsx(Z,{header:e.jsx(Q,{children:"Tambah Pembayaran"}),children:r,user:r.props.auth.user,organization:r.props.organization,title:"Tambah Pembayaran",backLink:e.jsx(h,{href:route("cashflow.student-entry-receivable-payment",r.props.organization.id),children:e.jsx(ae,{})}),breadcrumbs:e.jsx("div",{className:"text-sm breadcrumbs",children:e.jsxs("ul",{children:[e.jsx("li",{className:"font-bold",children:e.jsx(h,{href:route("cashflow",r.props.organization.id),children:"Arus Kas"})}),e.jsx("li",{className:"font-bold",children:e.jsx(h,{href:route("cashflow.student-entry-receivable-payment",r.props.organization.id),children:"Pembayaran Piutang Iuran Tahunan Siswa"})}),e.jsx("li",{children:"Tambah Pembayaran"})]})}),role:r.props.role});export{ce as default};

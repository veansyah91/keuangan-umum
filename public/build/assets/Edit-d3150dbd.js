import{r as u,W as J,y as X,j as e,Y as Z,a as v}from"./app-9a2e89b5.js";import{D as ee,A as ae}from"./AuthenticatedLayout-7f13fa89.js";import{H as te}from"./Header-cd07cfd4.js";import{k as se,Q as b}from"./react-toastify.esm-b47c724b.js";/* empty css                      */import{c as le}from"./index.esm-a6435f24.js";import{F as ne}from"./FormInput-a610f1a3.js";import{I as r}from"./InputLabel-136cef46.js";import{T as g}from"./TextInput-96f96be1.js";import{S as de}from"./SecondaryButton-ec3f1868.js";import{P as ie}from"./PrimaryButton-f753a1cf.js";import{d as C}from"./dayjs.min-30fc4208.js";import"./studyYear-7c19cd25.js";import{C as oe}from"./StudentSelectInput-b257f0ee.js";import{N as me}from"./react-number-format.es-44999568.js";import{f as re}from"./formatNumber-b542c689.js";import{C as ce}from"./ClientSelectInput-3ec885e5.js";import{a as ue,u as xe}from"./index.module-dde64431.js";import"./ApplicationLogo-c42a5f47.js";import"./iconBase-bc6ea5d4.js";import"./transition-10f39bd0.js";import"./combobox-5e25dd40.js";import"./portal-69f187ce.js";const fe=()=>{const l=C().year(),i=l-10;let x=[];for(let c=i;c<l+1;c++)x=[...x,c];return x},he=()=>{let l=[];for(let i=7;i<13;i++)l=[...l,i];for(let i=1;i<7;i++)l=[...l,i];return l};function pe({organization:l,newRef:i,contacts:x,date:c,categories:I,accounts:T,payment:je,receivable:_,ledger:f,contact:w,lastLevel:F,details:P,creditAccount:N,selectedContactParam:ve}){const[R,D]=u.useState(0),{data:d,setData:o,processing:Y,patch:E,errors:t,setError:B}=J({contact_id:_.contact_id,date:c,level:F.level,student_id:w.student.no_ref,no_ref:i,value:R,month:f.month,study_year:f.study_year,description:f.description,credit_account:N.id,details:[],id:f.id}),[k,M]=u.useState({id:w.id,name:w.name,phone:w.phone}),[h,U]=u.useState({id:N.id,name:N.name,code:N.code,is_cash:!1}),[p,z]=u.useState({startDate:c,endDate:c}),[O]=ue(p,500),$=xe(p);u.useEffect(()=>{A()},[]),u.useEffect(()=>{$!==void 0&&p.startDate&&K()},[O]);const A=()=>{let a=d,s=[];I.filter((n,j)=>{let y=P.filter(S=>S.student_payment_category_id==n.id);s=[...s,{id:n.id,name:n.name,value:y.length>0?y[0].value:n.value}]});let m=s.reduce((n,j)=>n+j.value,0);D(m),a={...a,details:s,value:m},o(a)},K=a=>{X.reload({only:["newRef"],data:{date:C(p.startDate).format("YYYY-MM-DD")},onSuccess:({props:s})=>{const{newRef:m}=s;let n=d;n={...d,no_ref:m,date:a},o(n)}})},V=a=>{a.preventDefault(),E(route("cashflow.student-monthly-receivable.update",{organization:l.id,receivable:_.id,ledger:f.id}),{onSuccess:({props:s})=>{const{flash:m,newRef:n}=s;b.success(m.success,{position:b.POSITION.TOP_CENTER})},onError:s=>{console.log(s),b.error(s.error,{position:b.POSITION.TOP_CENTER})},preserveScroll:!1})},L=a=>{if(a){M({id:a.id,name:a.name,phone:a.phone});let s=d;s={...s,contact_id:a.id,description:`Piutang Iuran Bulanan dari ${a.name.toUpperCase()}`,student_id:a.student.no_ref,level:a.levels[a.levels.length-1].level},o(s)}},H=a=>{z(a),o("date",C(a.startDate).format("YYYY-MM-DD"))},Q=(a,s)=>{const{value:m}=a;let n=[...d.details];n[s]={...n[s],value:parseInt(m)};let j=n.reduce((y,S)=>y+S.value,0);D(j),o({...d,details:n,value:j})},W=a=>{o("study_year",a.target.value)},q=a=>{o("month",parseInt(a.target.value))},G=a=>{a&&(U({id:a.id,name:a.name,code:a.code,is_cash:!1}),o("credit_account",a.id),B("credit_account",""))};return e.jsxs(e.Fragment,{children:[e.jsx(Z,{title:"Ubah Piutang Iuran Bulanan Siswa"}),e.jsx(se,{}),e.jsx(ne,{onSubmit:V,children:e.jsx("div",{className:"w-full md:mt-2 md:py-5",children:e.jsxs("div",{className:"md:w-1/2 md:mx-auto px-3 md:px-0",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(r,{value:"No. Ref",htmlFor:"no_ref",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx(g,{id:"no_ref",name:"no_ref",className:`w-full ${(t==null?void 0:t.no_ref)&&"border-red-500"}`,placeholder:"No. Ref",value:d.no_ref||"",onChange:a=>o("no_ref",a.target.value.toUpperCase()),disabled:!0}),(t==null?void 0:t.no_ref)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.no_ref})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(r,{value:"Tanggal Input",htmlFor:"date",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx("div",{children:e.jsx(ee,{value:p,onChange:H,inputClassName:(t==null?void 0:t.date)&&"border-red-500 rounded-lg",useRange:!1,asSingle:!0,placeholder:"Tanggal",id:"date",displayFormat:"MMMM DD, YYYY"})}),(t==null?void 0:t.date)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.date})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(r,{value:"Nama Siswa",htmlFor:"name",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx(oe,{resources:x,selected:k,setSelected:a=>L(a),maxHeight:"max-h-40",placeholder:"Cari Kontak",isError:!!t.contact_id,id:"name",notFound:e.jsxs("span",{children:["Tidak Ada Data. ",e.jsx(v,{className:"font-bold text-blue-600",href:route("data-master.students.create",{organization:l.id}),children:"Buat Baru ?"})]})}),(t==null?void 0:t.name)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.name})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(r,{value:"No. Siswa",htmlFor:"student_id",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx(g,{id:"student_id",name:"student_id",className:`w-full ${(t==null?void 0:t.student_id)&&"border-red-500"}`,placeholder:"No. Siswa",value:d.student_id||"",onChange:a=>o("student_id",a.target.value.toUpperCase()),disabled:!0}),(t==null?void 0:t.student_id)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.student_id})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(r,{value:"Kelas",htmlFor:"level",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx(g,{id:"level",name:"level",className:`w-full ${(t==null?void 0:t.level)&&"border-red-500"}`,placeholder:"Kelas",value:d.level||"",onChange:a=>o("level",a.target.value.toUpperCase()),disabled:!0}),(t==null?void 0:t.level)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.level})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(r,{value:"Tahun Ajaran",htmlFor:"study_year",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx("select",{className:"select select-bordered w-full",defaultValue:d.study_year,onChange:W,id:"study_year",children:fe().map((a,s)=>e.jsxs("option",{value:`${a.toString()}/${(a+1).toString()}`,children:[a.toString(),"/",(a+1).toString()]},s))}),(t==null?void 0:t.study_year)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.study_year})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(r,{value:"Bulan",htmlFor:"month",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx("select",{className:"select select-bordered w-full",defaultValue:d.month,onChange:q,id:"month",children:he().map((a,s)=>e.jsx("option",{children:a},s))}),(t==null?void 0:t.month)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.month})]})]}),e.jsx("div",{className:"text-center mt-5 font-bold",children:"Rincian Pembayaran"}),d.details.map((a,s)=>e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(r,{value:a.name,htmlFor:`category-${s}`,className:" mx-auto my-auto"})}),e.jsx("div",{className:"w-full md:w-2/3",children:e.jsx(me,{value:a.value,customInput:g,onValueChange:m=>Q(m,s),thousandSeparator:!0,className:"text-end w-full border",prefix:"IDR ",id:`category-${s}`})})]},s)),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 pt-5 md:mt-2 font-bold text-xl",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:"TOTAL"}),e.jsxs("div",{className:"w-full md:w-2/3 text-end",children:["Rp. ",re(d.value)]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(r,{value:"Akun Kredit",htmlFor:"account",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(ce,{resources:T,selected:h,setSelected:a=>G(a),maxHeight:"max-h-40",placeholder:"Cari Akun",isError:!!t.cash_account_id,id:"account",contactFilter:""}),(h==null?void 0:h.code)&&e.jsxs("div",{className:"absolute text-xs",children:["Kode: ",h.code]}),(t==null?void 0:t.cash_account_id)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.cash_account_id})]})]}),e.jsxs("div",{className:"flex justify-end flex-col-reverse md:flex-row gap-2 mt-5",children:[e.jsx("div",{className:"w-full md:w-1/6 my-auto text-center",children:e.jsx(v,{href:route("cashflow.student-monthly-receivable.show",{organization:l.id,receivable:_.id}),children:e.jsx(de,{className:"w-full",children:e.jsx("div",{className:"text-center w-full",children:"Kembali"})})})}),e.jsx("div",{className:"w-full md:w-1/6 text-center",children:e.jsx(ie,{className:"w-full",disabled:Y,children:e.jsx("div",{className:"text-center w-full",children:"Ubah"})})})]})]})})})]})}pe.layout=l=>e.jsx(ae,{header:e.jsx(te,{children:"Ubah Piutang Iuran Bulanan Siswa"}),children:l,user:l.props.auth.user,organization:l.props.organization,title:"Ubah Piutang Iuran",backLink:e.jsx(v,{href:route("cashflow.student-monthly-receivable.show",{organization:l.props.organization.id,receivable:l.props.receivable.id}),children:e.jsx(le,{})}),breadcrumbs:e.jsx("div",{className:"text-sm breadcrumbs",children:e.jsxs("ul",{children:[e.jsx("li",{className:"font-bold",children:e.jsx(v,{href:route("cashflow",l.props.organization.id),children:"Arus Kas"})}),e.jsx("li",{className:"font-bold",children:e.jsx(v,{href:route("cashflow.student-monthly-receivable.show",{organization:l.props.organization.id,receivable:l.props.receivable.id}),children:"Piutang Iuran Bulanan Siswa"})}),e.jsx("li",{children:"Ubah Piutang Iuran Bulanan Siswa"})]})}),role:l.props.role});export{pe as default};

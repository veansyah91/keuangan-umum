import{r as x,j as e,W as te,y as le,Y as ie,a as B}from"./app-a32b9fee.js";import{D as ne,A as oe}from"./AuthenticatedLayout-d85d1243.js";import{H as re}from"./Header-57a5809c.js";import{k as de,Q as T}from"./react-toastify.esm-8b7ace3e.js";/* empty css                      */import{m as me,n as ce,I as ue,a as xe,z as he,c as fe}from"./index.esm-e8f6b728.js";import{d as I}from"./dayjs.min-1711e039.js";import{I as v}from"./InputLabel-9e43e893.js";import{o as pe,u as je}from"./index.module-63367142.js";import{f as O}from"./formatNumber-b542c689.js";import{P as z}from"./PrimaryButton-611e4b8f.js";import{S as ve}from"./SecondaryButton-cc98d738.js";import{C as Ne}from"./ClientSelectInput-72a75664.js";import{H as Y}from"./combobox-8b36cf56.js";import{X as we}from"./transition-a190b099.js";import{T as y}from"./TextInput-dff60c87.js";import{N as P}from"./react-number-format.es-803c13e7.js";import{M as be}from"./Modal-f51c1575.js";import"./ApplicationLogo-3600c114.js";import"./iconBase-55b2c5a6.js";import"./portal-28911e26.js";import"./close-provider-43ee790a.js";function ye({resources:n,selected:o,setSelected:N,maxHeight:r="max-h-60",placeholder:C,onCLick:u,isError:k=!0,id:l="",notFound:p=null}){const[w,i]=x.useState(""),[F,D]=x.useState(n);return x.useEffect(()=>{const h=w===""?n:n.filter(b=>b.name.toLowerCase().replace(/\s+/g,"").includes(w==null?void 0:w.toLowerCase().replace(/\s+/g,"")));D(h)},[w]),x.useEffect(()=>{i(o.name)},[o]),e.jsx(Y,{value:o,onChange:N,children:e.jsxs("div",{className:"relative mt-1 w-full",children:[e.jsxs("div",{className:`relative w-full cursor-default rounded-md bg-white text-left border focus:outline-none focus-visible:ring-2 focus-visible:ring-white/75 focus-visible:ring-offset-2 focus-visible:ring-offset-teal-300 sm:text-sm ${k?"border-red-500":"border-gray-300"}`,children:[e.jsx(Y.Input,{className:"w-full border-none py-3 pl-3 pr-10 leading-5 text-gray-800 focus:ring-0",displayValue:h=>h.name.toUpperCase(),onChange:h=>i(h.target.value.toUpperCase()),placeholder:C,type:"search",id:l}),e.jsx(Y.Button,{className:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-600 text-lg",onClick:u,children:e.jsx(me,{})})]}),e.jsx(we,{as:x.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx(Y.Options,{className:`absolute mt-1 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black/5 focus:outline-none sm:text-sm ${r} z-10`,children:F.length===0&&w!==""?e.jsx("div",{className:"relative cursor-default select-none px-4 py-2 text-gray-700",children:p??"Tidak Ada Data"}):F.map(h=>e.jsx(Y.Option,{className:({active:b})=>`relative flex cursor-default select-none py-2 pl-10 pr-4 ${b?"bg-teal-600 text-white":"text-slate-900"}`,value:h,children:({selected:b,active:S})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`block truncate ${b?"font-medium":"font-normal"}`,children:[e.jsx("div",{className:"text-xs",children:h.position}),e.jsx("div",{className:"text-base",children:h.name.toUpperCase()})]}),b?e.jsx("div",{className:`absolute inset-y-0 left-0 flex items-center pl-3 ${S?"text-white":"text-teal-600"}`,children:e.jsx(ce,{className:"h-5 w-5","aria-hidden":"true"})}):null]})},h.id))})})]})})}const ge=()=>I().format("MM"),_e=()=>{let n=[];for(let o=7;o<13;o++)n=[...n,o];for(let o=1;o<7;o++)n=[...n,o];return n},R=n=>n.map(o=>({id:o.contact_id,name:o.contact.name,position:o.position,no_ref:o.no_ref})),Ce=(n,o)=>n.map(N=>({id:N.contact_id,name:N.contact.name,position:N.position,no_ref:N.no_ref,value:o.reduce((r,C)=>r+(C.has_hour?0:C.value),0),categories:o.map(r=>({id:r.id,name:r.name,value:r.value,unit:r.unit,is_cut:!!r.is_cut,has_hour:!!r.has_hour,qty:r.has_hour?0:1,total:r.has_hour?0:r.value}))}));function De({organization:n,categories:o,newRef:N,date:r,cashAccounts:C,contacts:u,history:k}){var E;const{data:l,setData:p,post:w,errors:i,processing:F}=te({value:0,organization_id:n.id,no_ref:N,date:r,month:parseInt(ge()),study_year:I(r).format("YYYY").toString(),cash_account_id:"",details:Ce(u,o)}),[D,h]=x.useState({startDate:r,endDate:r}),[b,S]=x.useState({id:null,name:"",position:"",no_ref:""}),[g,_]=x.useState({}),[V,A]=x.useState(!1),[H,$]=x.useState({id:null,name:"",code:"",is_cash:!0}),[G]=pe(D,500),L=je(D),[c,M]=x.useState(0);x.useEffect(()=>{q()},[]),x.useEffect(()=>{L!==void 0&&U()},[G]);const U=()=>{le.reload({only:["newRef"],data:{date:I(D.startDate).format("YYYY-MM-DD")},onSuccess:a=>{p("no_ref",a.props.newRef)}})},q=()=>{S({id:u[0].contact_id,name:u[0].contact.name,position:u[0].position,no_ref:u[0].no_ref}),_({id:l.details[0].id,name:l.details[0].name,position:l.details[0].position,no_ref:l.details[0].no_ref,categories:l.details[0].categories,value:l.details[0].categories.reduce((s,t)=>s+(t.has_hour?0:t.value),0)});let a=l.details;p("value",a.reduce((s,t)=>s+t.value,0))},K=a=>{h(a),p("date",I(a.startDate).format("YYYY-MM-DD"))},J=a=>{let s=a-1;S(R(u)[s]),_({id:l.details[s].id,name:l.details[s].name,position:l.details[s].position,no_ref:l.details[s].no_ref,categories:l.details[s].categories,value:l.details[s].categories.reduce((t,d)=>t+(d.has_hour?0:d.value),0)}),M(s)},Q=a=>{let s=a+1;S(R(u)[s]),_({id:l.details[s].id,name:l.details[s].name,position:l.details[s].position,no_ref:l.details[s].no_ref,categories:l.details[s].categories,value:l.details[s].categories.reduce((t,d)=>t+(d.has_hour?0:d.value),0)}),M(s)},X=a=>{if(a){S({id:a.id,name:a.name,position:a.position,no_ref:a.no_ref});let s=R(u).findIndex(t=>t.id===a.id);_({id:l.details[s].id,name:l.details[s].name,position:l.details[s].position,no_ref:l.details[s].no_ref,categories:l.details[s].categories}),M(s)}},W=(a,s)=>{let t={...g},d=a.floatValue||0;t.categories[s]={...t.categories[s],qty:d,total:d*t.categories[s].value*(t.categories[s].is_cut?-1:1)},t={...t,value:t.categories.reduce((f,j)=>f+j.total,0)},_(t);let m={...l};m.details[c]=t,m.value=m.details.reduce((f,j)=>f+j.value,0),p(m)},Z=(a,s)=>{let t={...g},d=a.floatValue||0;t.categories[s]={...t.categories[s],value:d,total:d*t.categories[s].qty*(t.categories[s].is_cut?-1:1)},t={...t,value:t.categories.reduce((f,j)=>f+j.total,0)},_(t);let m={...l};m.details[c]=t,m.value=m.details.reduce((f,j)=>f+j.value,0),p(m)},ee=()=>{let a=l,s=a.details.map(t=>{let d=t.categories.map(m=>{let f=k.details.find(j=>j.contact_id===t.id&&j.category_id===m.id);return{...m,value:m.has_hour?m.value:f.value,total:m.has_hour?0:f.value,qty:m.has_hour?0:1}});return{...t,categories:d,value:d.reduce((m,f)=>m+f.total,0)}});a={...a,value:s.reduce((t,d)=>t+d.value,0),details:s},p(a),_({id:a.details[c].id,name:a.details[c].name,position:a.details[c].position,no_ref:a.details[c].no_ref,categories:a.details[c].categories,value:a.details[c].categories.reduce((t,d)=>t+(d.has_hour?0:d.value),0)})},ae=a=>{$({id:a.id,name:a.name,code:a.code,is_cash:!0}),p("cash_account_id",a.id)},se=a=>{a.preventDefault(),w(route("cashflow.staff-salary-payment.store",{organization:n.id}),{onSuccess:({props:s})=>{const{flash:t}=s;T.success(t.success,{position:T.POSITION.TOP_CENTER})},onError:s=>{const{error:t}=s;T.error(t,{position:T.POSITION.TOP_CENTER})}})};return e.jsxs(e.Fragment,{children:[e.jsx(ie,{title:"Pembayaran Gaji Staf"}),e.jsx(de,{}),e.jsx("div",{className:"w-full sm:mt-2",children:e.jsx("div",{className:"sm:mx-auto px-3 sm:px-5 bg-white py-2 sm:pt-0 space-y-5 md:space-y-0",children:e.jsx("div",{className:"sm:pt-0 pb-16 pt-12",children:e.jsxs("div",{className:"bg-white py-2 px-2 sm:pt-0",children:[e.jsxs("div",{className:"w-full md:flex gap-2 md:py-5 ",children:[e.jsx("div",{className:"sm:w-1/2 text-center md:text-start w-full text-slate-900 space-y-2",children:e.jsx(z,{onClick:()=>A(!0),children:"Buat Pembayaran"})}),e.jsxs("div",{className:"sm:w-1/2 w-full text-center md:text-end text-sm text-slate-900 space-y-2 my-auto md:text-2xl font-bold",children:["Total: IDR. ",O(l.value)]})]}),e.jsxs("div",{className:"mt-5 md:mt-0",children:[e.jsxs("section",{children:[e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx("div",{className:"my-auto",children:e.jsx("button",{onClick:()=>J(c),className:"my-auto p-2",disabled:c<1?"disabled":!1,type:"button",children:e.jsx(ue,{size:20,color:c<1?"gray":""})})}),e.jsx("div",{className:"my-auto relative md:w-1/3 w-3/4",children:e.jsx("div",{children:e.jsx(ye,{resources:R(u),selected:b,setSelected:a=>X(a),maxHeight:"max-h-40",placeholder:"Cari Kontak",isError:!1,id:"contact",notFound:e.jsx("span",{children:"Tidak Ada Data."})})})}),e.jsx("div",{className:"my-auto",children:e.jsx("button",{onClick:()=>Q(c),className:"my-auto p-2",disabled:u.length>c+1?!1:"disabled",type:"button",children:e.jsx(xe,{size:20,color:u.length>c+1?"":"gray"})})})]}),e.jsxs("div",{className:"text-center text-xs",children:[c+1," / ",u.length]})]}),e.jsxs("section",{className:"w-full md:w-10/12 mx-auto mt-5",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(v,{value:"Nama Staff",htmlFor:"name",className:" mx-auto my-auto"})}),e.jsx("div",{className:"w-full sm:w-2/3",children:e.jsx(y,{id:"name",name:"name",className:"w-full",placeholder:"Nama",value:g.name||"",disabled:!0})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(v,{value:"Jabatan",htmlFor:"position",className:" mx-auto my-auto"})}),e.jsx("div",{className:"w-full sm:w-2/3",children:e.jsx(y,{id:"position",name:"position",className:"w-full",placeholder:"Jabatan",value:g.position||"",disabled:!0})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(v,{value:"No. Id",htmlFor:"id",className:" mx-auto my-auto"})}),e.jsx("div",{className:"w-full sm:w-2/3",children:e.jsx(y,{id:"id",name:"id",className:"w-full",placeholder:"No.Id",value:g.no_ref||"",disabled:!0})})]}),k&&e.jsx("div",{className:"w-full text-end mt-2 text-blue-500",children:e.jsxs("button",{className:"border text-xs rounded-md p-1 font-medium hover:bg-slate-100 flex space-x-1",onClick:ee,children:[e.jsx("div",{className:"my-auto",children:e.jsx(he,{})}),e.jsx("div",{className:"my-auto",children:"Ambil Dari Data Sebelumnya"})]})}),e.jsx("div",{className:"mt-5 overflow-x-auto",children:e.jsxs("div",{className:"w-[750px] md:w-full",children:[e.jsxs("div",{className:"flex font-bold gap-3 border-b py-3",children:[e.jsx("div",{className:"w-4/12",children:"Kategori"}),e.jsx("div",{className:"w-2/12 text-end",children:"Jam/Hari"}),e.jsx("div",{className:"w-3/12 text-end",children:"Nilai"}),e.jsx("div",{className:"w-3/12 text-end",children:"Total"})]}),(E=g.categories)==null?void 0:E.map((a,s)=>e.jsxs("div",{className:"flex gap-3 border-b py-3",children:[e.jsx("div",{className:`w-5/12 my-auto${a.is_cut?" text-red-500":""}`,children:a.name}),e.jsx("div",{className:"w-1/12 text-end",children:a.has_hour&&e.jsxs("div",{className:"gap-1",children:[e.jsx(P,{value:a.qty,customInput:y,onValueChange:t=>W(t,s),thousandSeparator:!0,className:`text-end w-full${a.is_cut?" text-red-500":""}`,prefix:""}),e.jsx("div",{className:"my-auto hidden md:block text-xs",children:a.unit})]})}),e.jsx("div",{className:"w-3/12 text-end",children:e.jsx(P,{value:a.value,customInput:y,onValueChange:t=>Z(t,s),thousandSeparator:!0,className:`text-end w-full${a.is_cut?" text-red-500":""}`,prefix:"IDR. "})}),e.jsx("div",{className:"w-3/12 text-end",children:e.jsx(P,{value:a.total,customInput:y,thousandSeparator:!0,className:`text-end w-full${a.is_cut?" text-red-500":""}`,prefix:"IDR. ",disabled:"disabled"})})]},s)),e.jsxs("div",{className:"flex font-bold gap-3 border-b py-3",children:[e.jsx("div",{className:"w-5/12",children:"Total"}),e.jsxs("div",{className:"w-7/12 text-end",children:["IDR. ",O(g.value)]})]})]})})]})]})]})})})}),e.jsx(be,{show:V,onClose:()=>A(!1),children:e.jsxs("form",{onSubmit:se,className:"p-6",id:"filter",name:"filter",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Buat Pembayaran Gaji"}),e.jsxs("div",{className:"mt-6 ",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(v,{value:"No. Ref",htmlFor:"study_year",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(y,{id:"no_ref",name:"no_ref",className:"w-full",placeholder:"No Ref",value:l.no_ref||"",disabled:!0}),(i==null?void 0:i.no_ref)&&e.jsx("span",{className:"text-red-500 text-xs",children:i.no_ref})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(v,{value:"Tanggal",htmlFor:"study_year",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(ne,{value:D,onChange:K,inputClassName:(i==null?void 0:i.date)&&"border-red-500 rounded-lg",useRange:!1,asSingle:!0,placeholder:"Tanggal",id:"date",displayFormat:"MMMM DD, YYYY"}),(i==null?void 0:i.date)&&e.jsx("span",{className:"text-red-500 text-xs",children:i.date})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(v,{value:"Tahun Ajaran",htmlFor:"study_year",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsxs("select",{className:"select select-bordered w-full",value:l.study_year,onChange:a=>p("study_year",a.target.value),id:"study_year",children:[e.jsx("option",{children:I(r).format("YYYY").toString()}),e.jsx("option",{children:(I(r).format("YYYY")-1).toString()})]}),(i==null?void 0:i.study_year)&&e.jsx("span",{className:"text-red-500 text-xs",children:i.study_year})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(v,{value:"Bulan",htmlFor:"month",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx("select",{className:"select select-bordered w-full",value:l.month,onChange:a=>p("month",a.target.value),id:"month",children:_e().map((a,s)=>e.jsx("option",{children:a},s))}),(i==null?void 0:i.month)&&e.jsx("span",{className:"text-red-500 text-xs",children:i.month})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(v,{value:"Total",htmlFor:"total",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(P,{value:l.value,customInput:y,thousandSeparator:!0,className:"text-end w-full",prefix:"IDR. ",disabled:"disabled",id:"total"}),(i==null?void 0:i.value)&&e.jsx("span",{className:"text-red-500 text-xs",children:i.value})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(v,{value:"Akun Kas",htmlFor:"cash_account",className:" mx-auto my-auto"})}),e.jsx("div",{className:"w-full sm:w-2/3",children:e.jsx(Ne,{resources:C,selected:H,setSelected:a=>ae(a),maxHeight:"max-h-40",placeholder:"Cari Akun",isError:!!i.cash_account_id,id:"cash_account",notFound:e.jsxs("span",{children:["Tidak Ada Data. ",e.jsx(B,{className:"font-bold text-blue-600",href:route("data-ledger.account",{organization:n.id}),children:"Buat Baru ?"})]})})})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end",children:[e.jsx(ve,{onClick:()=>A(!1),children:"Batal"}),e.jsx(z,{className:"ms-3",disabled:F,children:"Simpan"})]})]})})]})}De.layout=n=>e.jsx(oe,{header:e.jsx(re,{children:"Pembayaran Gaji Bulanan"}),children:n,user:n.props.auth.user,organization:n.props.organization,title:"Pembayaran Gaji Bulanan",backLink:e.jsx(B,{href:route("cashflow",n.props.organization.id),children:e.jsx(fe,{})}),breadcrumbs:e.jsx("div",{className:"text-sm breadcrumbs",children:e.jsxs("ul",{children:[e.jsx("li",{className:"font-bold",children:e.jsx(B,{href:route("cashflow.staff-salary-payment",n.props.organization.id),children:"Arus Kas"})}),e.jsx("li",{className:"font-bold",children:e.jsx(B,{href:route("cashflow.staff-salary-payment",n.props.organization.id),children:"Pembayaran Gaji Bulanan"})}),e.jsx("li",{children:"Tambah Pembayaran Gaji Bulanan"})]})}),role:n.props.role});export{De as default};

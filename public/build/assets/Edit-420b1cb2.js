import{r as p,W,j as e,Y as q,a as b,y as G}from"./app-932dac43.js";import{D as J,A as X}from"./AuthenticatedLayout-50777d53.js";import{H as Z}from"./Header-7a4c0d6b.js";import{k as ee,Q as N}from"./react-toastify.esm-e687779d.js";/* empty css                      */import{c as ae}from"./index.esm-ab259f8a.js";import{F as te}from"./FormInput-5e90ba04.js";import{I as r}from"./InputLabel-a51f7073.js";import{T as y}from"./TextInput-235f3e02.js";import{S as le}from"./SecondaryButton-467ac377.js";import{P as se}from"./PrimaryButton-3b78d5d6.js";import{d as ne}from"./dayjs.min-d7aa8949.js";import"./studyYear-cff9f22a.js";import{C as de}from"./StudentSelectInput-f462afb2.js";import{N as ie}from"./react-number-format.es-a053e672.js";import{f as me}from"./formatNumber-b542c689.js";import{C as oe}from"./ClientSelectInput-289f6ece.js";import"./ApplicationLogo-ab6856d2.js";import"./iconBase-d14e2caf.js";import"./transition-4af5feaf.js";import"./index.module-4b0a6979.js";import"./combobox-8eb3c90d.js";import"./keyboard-61ed8e30.js";const re=()=>{const s=ne().year(),i=s-10;let u=[];for(let c=i;c<s+1;c++)u=[...u,c];return u},ce=()=>{let s=[];for(let i=7;i<13;i++)s=[...s,i];for(let i=1;i<7;i++)s=[...s,i];return s};function ue({organization:s,newRef:i,contacts:u,date:c,categories:I,accounts:D,payment:xe,receivable:g,ledger:x,contact:j,lastLevel:T,details:F,creditAccount:v}){const[R,S]=p.useState(0),{data:d,setData:m,processing:P,patch:E,errors:t,setError:B}=W({contact_id:g.contact_id,date:c,level:T.level,student_id:j.student.no_ref,no_ref:i,value:R,month:x.month,study_year:x.study_year,description:x.description,credit_account:v.id,details:[],id:x.id}),[U,k]=p.useState({id:j.id,name:j.name,phone:j.phone}),[h,z]=p.useState({id:v.id,name:v.name,code:v.code,is_cash:!1}),[C,O]=p.useState({startDate:c,endDate:c});p.useEffect(()=>{$()},[]);const $=()=>{let a=d,l=[];I.filter((n,f)=>{let w=F.filter(_=>_.student_payment_category_id==n.id);l=[...l,{id:n.id,name:n.name,value:w.length>0?w[0].value:n.value}]});let o=l.reduce((n,f)=>n+f.value,0);S(o),a={...a,details:l,value:o},m(a)},K=a=>{G.reload({only:["newRef"],data:{date:C.startDate},onSuccess:({props:l})=>{const{newRef:o}=l;let n=d;n={...d,no_ref:o,date:a},m(n)}})},Y=a=>{a.preventDefault(),E(route("cashflow.student-monthly-receivable.update",{organization:s.id,receivable:g.id,ledger:x.id}),{onSuccess:({props:l})=>{const{flash:o,newRef:n}=l;N.success(o.success,{position:N.POSITION.TOP_CENTER})},onError:l=>{console.log(l),N.error(l.error,{position:N.POSITION.TOP_CENTER})},preserveScroll:!1})},A=a=>{k({id:a.id,name:a.name,phone:a.phone});let l=d;l={...l,contact_id:a.id,description:`Piutang Iuran Bulanan dari ${a.name.toUpperCase()}`,student_id:a.student.no_ref,level:a.levels[a.levels.length-1].level},m(l)},L=a=>{O(a),m("date",a.startDate),K(a.startDate)},M=(a,l)=>{const{value:o}=a;let n=[...d.details];n[l]={...n[l],value:parseInt(o)};let f=n.reduce((w,_)=>w+_.value,0);S(f),m({...d,details:n,value:f})},V=a=>{m("study_year",a.target.value)},H=a=>{m("month",parseInt(a.target.value))},Q=a=>{z({id:a.id,name:a.name,code:a.code,is_cash:!1}),m("credit_account",a.id),B("credit_account","")};return e.jsxs(e.Fragment,{children:[e.jsx(q,{title:"Ubah Piutang Iuran Bulanan Siswa"}),e.jsx(ee,{}),e.jsx(te,{onSubmit:Y,children:e.jsx("div",{className:"w-full md:mt-2 md:py-5",children:e.jsxs("div",{className:"md:w-1/2 md:mx-auto px-3 md:px-0",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(r,{value:"No. Ref",htmlFor:"no_ref",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx(y,{id:"no_ref",name:"no_ref",className:`w-full ${(t==null?void 0:t.no_ref)&&"border-red-500"}`,placeholder:"No. Ref",value:d.no_ref||"",onChange:a=>m("no_ref",a.target.value.toUpperCase()),disabled:!0}),(t==null?void 0:t.no_ref)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.no_ref})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(r,{value:"Tanggal Input",htmlFor:"date",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx("div",{children:e.jsx(J,{value:C,onChange:L,inputClassName:(t==null?void 0:t.date)&&"border-red-500 rounded-lg",useRange:!1,asSingle:!0,placeholder:"Tanggal",id:"date",displayFormat:"MMMM DD, YYYY"})}),(t==null?void 0:t.date)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.date})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(r,{value:"Nama Siswa",htmlFor:"name",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx(de,{resources:u,selected:U,setSelected:a=>A(a),maxHeight:"max-h-40",placeholder:"Cari Kontak",isError:!!t.contact_id,id:"name"}),(t==null?void 0:t.name)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.name})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(r,{value:"No. Siswa",htmlFor:"student_id",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx(y,{id:"student_id",name:"student_id",className:`w-full ${(t==null?void 0:t.student_id)&&"border-red-500"}`,placeholder:"No. Siswa",value:d.student_id||"",onChange:a=>m("student_id",a.target.value.toUpperCase()),disabled:!0}),(t==null?void 0:t.student_id)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.student_id})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(r,{value:"Kelas",htmlFor:"level",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx(y,{id:"level",name:"level",className:`w-full ${(t==null?void 0:t.level)&&"border-red-500"}`,placeholder:"Kelas",value:d.level||"",onChange:a=>m("level",a.target.value.toUpperCase()),disabled:!0}),(t==null?void 0:t.level)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.level})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(r,{value:"Tahun Ajaran",htmlFor:"study_year",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx("select",{className:"select select-bordered w-full",defaultValue:d.study_year,onChange:V,id:"study_year",children:re().map((a,l)=>e.jsxs("option",{value:`${a.toString()}/${(a+1).toString()}`,children:[a.toString(),"/",(a+1).toString()]},l))}),(t==null?void 0:t.study_year)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.study_year})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(r,{value:"Bulan",htmlFor:"month",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx("select",{className:"select select-bordered w-full",defaultValue:d.month,onChange:H,id:"month",children:ce().map((a,l)=>e.jsx("option",{children:a},l))}),(t==null?void 0:t.month)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.month})]})]}),e.jsx("div",{className:"text-center mt-5 font-bold",children:"Rincian Pembayaran"}),d.details.map((a,l)=>e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(r,{value:a.name,htmlFor:`category-${l}`,className:" mx-auto my-auto"})}),e.jsx("div",{className:"w-full md:w-2/3",children:e.jsx(ie,{value:a.value,customInput:y,onValueChange:o=>M(o,l),thousandSeparator:!0,className:"text-end w-full border",prefix:"IDR ",id:`category-${l}`})})]},l)),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 pt-5 md:mt-2 font-bold text-xl",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:"TOTAL"}),e.jsxs("div",{className:"w-full md:w-2/3 text-end",children:["Rp. ",me(d.value)]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(r,{value:"Akun Kredit",htmlFor:"account",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(oe,{resources:D,selected:h,setSelected:a=>Q(a),maxHeight:"max-h-40",placeholder:"Cari Akun",isError:!!t.cash_account_id,id:"account",contactFilter:""}),(h==null?void 0:h.code)&&e.jsxs("div",{className:"absolute text-xs",children:["Kode: ",h.code]}),(t==null?void 0:t.cash_account_id)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.cash_account_id})]})]}),e.jsxs("div",{className:"flex justify-end flex-col-reverse md:flex-row gap-2 mt-5",children:[e.jsx("div",{className:"w-full md:w-1/6 my-auto text-center",children:e.jsx(b,{href:route("cashflow.student-monthly-receivable.show",{organization:s.id,receivable:g.id}),children:e.jsx(le,{className:"w-full",children:e.jsx("div",{className:"text-center w-full",children:"Kembali"})})})}),e.jsx("div",{className:"w-full md:w-1/6 text-center",children:e.jsx(se,{className:"w-full",disabled:P,children:e.jsx("div",{className:"text-center w-full",children:"Ubah"})})})]})]})})})]})}ue.layout=s=>e.jsx(X,{header:e.jsx(Z,{children:"Ubah Piutang Iuran Bulanan Siswa"}),children:s,user:s.props.auth.user,organization:s.props.organization,title:"Ubah Piutang Iuran",backLink:e.jsx(b,{href:route("cashflow.student-monthly-receivable.show",{organization:s.props.organization.id,receivable:s.props.receivable.id}),children:e.jsx(ae,{})}),breadcrumbs:e.jsx("div",{className:"text-sm breadcrumbs",children:e.jsxs("ul",{children:[e.jsx("li",{className:"font-bold",children:e.jsx(b,{href:route("cashflow",s.props.organization.id),children:"Arus Kas"})}),e.jsx("li",{className:"font-bold",children:e.jsx(b,{href:route("cashflow.student-monthly-receivable.show",{organization:s.props.organization.id,receivable:s.props.receivable.id}),children:"Piutang Iuran Bulanan Siswa"})}),e.jsx("li",{children:"Ubah Piutang Iuran Bulanan Siswa"})]})}),role:s.props.role});export{ue as default};

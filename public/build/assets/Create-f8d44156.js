import{r as d,m as pe,S as fe,j as e,L as je,$ as T}from"./app-e310aa01.js";import{D as ve,A as Ne}from"./AuthenticatedLayout-69c8267d.js";import{H as be}from"./Header-e91d9d17.js";import{t as S,u as ge,m as we,c as De}from"./index.esm-d43a1de0.js";import{S as ye}from"./SecondaryButton-94e34b2f.js";import{P as Se}from"./PrimaryButton-5a931109.js";import{F as _e}from"./FormInput-319be417.js";import{k as Ee,Q as o}from"./react-toastify.esm-1fbb98bc.js";import{I as x}from"./InputLabel-befcccbc.js";import{T as _}from"./TextInput-99d89a9a.js";import{a as Te,u as Ie}from"./index.module-6d257d70.js";import{N as U}from"./react-number-format.es-0daa2554.js";import{C as E}from"./ClientSelectInput-deddca07.js";import{f as B}from"./formatNumber-b542c689.js";import{d as J}from"./dayjs.min-0b1597b0.js";import{j as F}from"./disclosure-a67610bf.js";import{z as Ce}from"./transition-dbb0fec3.js";import"./ApplicationLogo-874ab5e7.js";import"./iconBase-076ca044.js";/* empty css                      */import"./combobox-418cbed0.js";import"./portal-abeed8eb.js";import"./close-provider-a657bad9.js";function ke({organization:n,newRef:L,date:I,accounts:H,projects:C,programs:k,departments:P}){const[u,N]=d.useState([{id:null,name:"",code:"",is_cash:!1},{id:null,name:"",code:"",is_cash:!1}]),[h,b]=d.useState(["",""]),[g,A]=d.useState({id:null,name:"",code:""}),[z,Pe]=d.useState(""),[w,O]=d.useState({id:null,name:"",code:""}),[V,Ae]=d.useState(""),[D,R]=d.useState({id:null,name:"",code:""}),[$,Oe]=d.useState(""),{data:c,setData:r,post:q,reset:Re,errors:y,setError:Be,processing:Q}=pe({date:I,no_ref:L,description:"Jurnal Umum",is_approved:!0,program_id:null,project_id:null,department_id:null,accounts:[{id:null,name:"",code:"",debit:0,credit:0,is_cash:!1},{id:null,name:"",code:"",debit:0,credit:0,is_cash:!1}]}),[p,K]=d.useState({startDate:I,endDate:I}),[f,G]=d.useState(0),[j,W]=d.useState(0),[X]=Te(p,500),Z=Ie(p);d.useEffect(()=>{Z!==void 0&&p.startDate&&ee()},[X]),d.useEffect(()=>{let t=c.accounts.reduce((l,a)=>l+a.debit,0);G(t);let s=c.accounts.reduce((l,a)=>l+a.credit,0);W(s)},[c]);const ee=()=>{fe.reload({only:["newRef"],data:{date:J(p.startDate).format("YYYY-MM-DD")},onSuccess:t=>{r("no_ref",t.props.newRef)}})},se=(t,s)=>{const{value:l}=t,a=[...c.accounts];a[s]={...a[s],debit:parseInt(l)},r("accounts",a)},te=(t,s)=>{const{value:l}=t,a=[...c.accounts];a[s]={...a[s],credit:parseInt(l)},r("accounts",a)},ae=t=>{K(t),r("date",J(t.startDate).format("YYYY-MM-DD"))},le=t=>{const s=[...c.accounts];s.splice(t,1),r("accounts",s);const l=[...u];l.splice(t,1),N(l);let a=[...h];a.splice(t,1),b(a)},re=()=>{const t=[...c.accounts,{account_id:null,account_name:"",account_code:"",debit:0,credit:0,is_cash:!1}];r("accounts",t);const s=[...u,{id:null,name:"",code:"",is_cash:!1}];N(s);let l=[...h];l=[...l,""],b(l)},ce=(t,s)=>{var m,v,M,Y;const l=[...u];l[s]=t,N(l);const a=[...c.accounts];a[s]={...a[s],id:(m=l[s])==null?void 0:m.id,code:(v=l[s])==null?void 0:v.code,name:(M=l[s])==null?void 0:M.name,is_cash:(Y=l[s])==null?void 0:Y.is_cash},r("accounts",a);let i=[...h];i[s]="",b(i)},de=t=>{O(t),r("program_id",t.id)},ne=()=>{O({id:null,name:"",code:""}),r("program_id",null)},ie=t=>{A(t),r("project_id",t.id)},oe=()=>{A({id:null,name:"",code:""}),r("project_id",null)},me=t=>{R(t),r("department_id",t.id)},ue=()=>{R({id:null,name:"",code:""}),r("department_id",null)},xe=t=>{t.preventDefault(),q(route("data-ledger.journal.store",n.id),{onSuccess:s=>{he(s.props),o.success("Jurnal Berhasil Ditambahkan",{position:o.POSITION.TOP_CENTER})},onError:s=>{const l=Object.entries(s).map(([i,m])=>({key:i,value:m}));let a=[];for(let i=0;i<h.length;i++){let m="";l.map(v=>{v.key.split(".").length===3&&v.key==`accounts.${i}.id`&&(m="required")}),a=[...a,m]}b(a),s!=null&&s.no_ref&&o.error(s.no_ref,{position:o.POSITION.TOP_CENTER}),s!=null&&s.empty&&o.error("Nilai Debit Dan Kredit Tidak Boleh Kosong",{position:o.POSITION.TOP_CENTER}),s!=null&&s.date&&o.error(s.date,{position:o.POSITION.TOP_CENTER})},preserveScroll:!0})},he=t=>{N([{id:null,name:"",code:"",is_cash:!1},{id:null,name:"",code:"",is_cash:!1}]),R({id:null,name:"",code:""}),A({id:null,name:"",code:""}),O({id:null,name:"",code:""}),r({date:t.date,no_ref:t.newRef,description:"Jurnal Umum",is_approved:!0,program_id:null,project_id:null,department_id:null,accounts:[{id:null,name:"",code:"",debit:0,credit:0,is_cash:!1},{id:null,name:"",code:"",debit:0,credit:0,is_cash:!1}]}),K({startDate:t.date,endDate:t.date})};return e.jsxs(e.Fragment,{children:[e.jsx(je,{title:"Tambah Jurnal Umum"}),e.jsx(Ee,{}),e.jsx(_e,{onSubmit:xe,children:e.jsx("div",{className:"w-full sm:mt-2 sm:py-5",children:e.jsxs("div",{className:"sm:mx-auto px-3 sm:px-5",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-3",children:[e.jsxs("div",{className:"sm:w-1/4 w-full text-slate-900 space-y-2",children:[e.jsx("div",{children:e.jsx(x,{value:"Tanggal"})}),e.jsx("div",{children:e.jsx(ve,{value:p,onChange:ae,inputClassName:(y==null?void 0:y.date)&&"border-red-500 rounded-lg",useRange:!1,asSingle:!0,placeholder:"Tanggal",id:"date",displayFormat:"MMMM DD, YYYY"})})]}),e.jsxs("div",{className:"sm:w-1/4 w-full text-slate-900 space-y-2",children:[e.jsx("div",{children:e.jsx(x,{value:"No. Ref",htmlFor:"no_ref"})}),e.jsx("div",{children:e.jsx(_,{id:"no_ref",className:`w-full ${y.no_ref&&"border-red-500"}`,value:c.no_ref,onChange:t=>r("no_ref",t.target.value)})})]}),e.jsxs("div",{className:"sm:w-1/2 w-full text-slate-900 space-y-2",children:[e.jsx("div",{children:e.jsx(x,{value:"Deskripsi",htmlFor:"description"})}),e.jsx("div",{children:e.jsx(_,{id:"description",className:"w-full",value:c.description,onChange:t=>r("description",t.target.value)})})]})]}),(C.length>0||k.length>0||P.length>0)&&e.jsx("div",{className:"mt-3",children:e.jsx(F,{children:({open:t})=>e.jsxs(e.Fragment,{children:[e.jsx(Ce,{enter:"transition duration-100 ease-out",enterFrom:"transform scale-95 opacity-0",enterTo:"transform scale-100 opacity-100",leave:"transition duration-75 ease-out",leaveFrom:"transform scale-100 opacity-100",leaveTo:"transform scale-95 opacity-0",children:e.jsx(F.Panel,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-start gap-3 sm:py-5 mb-3",children:[k.length>0&&e.jsxs("div",{className:"sm:w-1/3 w-full text-slate-900 space-y-2",children:[e.jsx("div",{children:e.jsx(x,{value:"Program Kegiatan",htmlFor:"program"})}),e.jsxs("div",{className:"flex w-full relative",children:[e.jsxs("div",{className:"w-5/6",children:[e.jsx(E,{resources:k,selected:w,setSelected:s=>de(s),maxHeight:"max-h-40",placeholder:"Cari Program Kegiatan",isError:!!V,id:"program"}),w.id&&e.jsxs("span",{className:"text-xs absolute",children:["Kode: ",w.code]})]}),w.id&&e.jsx("div",{className:"w-1/6 my-auto",children:e.jsx("button",{type:"button",className:"text-red-500 text-xl hover:bg-slate-200 rounded-full p-2",onClick:ne,children:e.jsx(S,{})})})]})]}),C.length>0&&e.jsxs("div",{className:"sm:w-1/3 w-full text-slate-900 space-y-2",children:[e.jsx("div",{children:e.jsx(x,{value:"Proyek",htmlFor:"project"})}),e.jsxs("div",{className:"flex w-full relative",children:[e.jsxs("div",{className:"w-5/6",children:[e.jsx(E,{resources:C,selected:g,setSelected:s=>ie(s),maxHeight:"max-h-40",placeholder:"Cari Proyek",isError:!!z,id:"project"}),g.id&&e.jsxs("span",{className:"text-xs absolute",children:["Kode: ",g.code]})]}),g.id&&e.jsx("div",{className:"w-1/6 my-auto",children:e.jsx("button",{type:"button",className:"text-red-500 text-xl hover:bg-slate-200 rounded-full p-2",onClick:oe,children:e.jsx(S,{})})})]})]}),P.length>0&&e.jsxs("div",{className:"sm:w-1/3 w-full text-slate-900 space-y-2",children:[e.jsx("div",{children:e.jsx(x,{value:"Departemen",htmlFor:"department"})}),e.jsxs("div",{className:"flex w-full relative",children:[e.jsxs("div",{className:"w-5/6",children:[e.jsx(E,{resources:P,selected:D,setSelected:s=>me(s),maxHeight:"max-h-40",placeholder:"Cari Departemen",isError:!!$,id:"department"}),D.id&&e.jsxs("span",{className:"text-xs absolute",children:["Kode: ",D.code]})]}),D.id&&e.jsx("div",{className:"w-1/6 my-auto",children:e.jsx("button",{type:"button",className:"text-red-500 text-xl hover:bg-slate-200 rounded-full p-2",onClick:ue,children:e.jsx(S,{})})})]})]})]})})}),e.jsx(F.Button,{className:"flex w-full justify-between rounded-lg bg-slate-100 px-4 py-2 text-left text-sm font-medium text-slate-900 hover:bg-slate-200 focus:outline-none focus-visible:ring focus-visible:ring-slate-500/75",children:e.jsxs("div",{className:"flex justify-center w-full gap-3",children:[e.jsxs("span",{children:["Tampilkan Lebih ",t?"Sedikit":"Banyak"]}),e.jsx(ge,{className:`${t?"":"rotate-180 transform"} h-5 w-5 text-slate-500`})]})})]})})}),e.jsx("div",{className:"mt-5 overflow-x-auto",children:e.jsxs("div",{className:"w-[600px] md:w-full",children:[e.jsxs("div",{className:"flex font-bold gap-3 border-b py-3",children:[e.jsx("div",{className:"w-5/12",children:"AKUN"}),e.jsx("div",{className:"w-3/12 text-end",children:"DEBIT"}),e.jsx("div",{className:"w-3/12 text-end",children:"KREDIT"}),e.jsx("div",{className:"w-1/12 text-center",children:"#"})]}),c.accounts.map((t,s)=>{var l;return e.jsxs("div",{className:"flex gap-3 py-3 mt-2",children:[e.jsxs("div",{className:"w-5/12 relative",children:[e.jsx(E,{resources:H,selected:u[s],setSelected:a=>ce(a,s),maxHeight:"max-h-40",placeholder:"Cari Akun",isError:!!h[s]}),((l=u[s])==null?void 0:l.code)&&e.jsxs("div",{className:"absolute text-xs",children:["Kode: ",u[s].code]})]}),e.jsx("div",{className:"w-3/12 text-end my-auto",children:e.jsx(U,{value:t.debit,customInput:_,onValueChange:a=>se(a,s),thousandSeparator:!0,className:"text-end w-full",prefix:"IDR "})}),e.jsx("div",{className:"w-3/12 text-end my-auto",children:e.jsx(U,{value:t.credit,customInput:_,onValueChange:a=>te(a,s),thousandSeparator:!0,className:"text-end w-full",prefix:"IDR "})}),e.jsx("div",{className:"w-1/12 text-center my-auto",children:e.jsx("button",{type:"button",className:"text-red-500 text-xl hover:bg-slate-200 rounded-full p-2",onClick:()=>le(s),children:e.jsx(S,{})})})]},s)}),e.jsx("div",{className:"py-3 mt-4",children:e.jsxs("button",{className:"w-full border bg-slate-100 hover:bg-slate-200 text-slate-500 py-3 flex justify-center gap-2",type:"button",onClick:re,children:[e.jsx("div",{className:"my-auto",children:e.jsx(we,{})}),e.jsx("div",{children:"Tambah Baris Baru"})]})})]})}),e.jsxs("div",{className:"md:flex font-bold gap-3",children:[e.jsx("div",{className:"w-5/12"}),e.jsxs("div",{className:"md:w-7/12 w-full md:flex border-t py-3 gap-12 px-3",children:[e.jsxs("div",{className:"md:w-1/2 w-full font-bold flex gap-1",children:[e.jsx("div",{className:"w-1/2",children:"TOTAL DEBIT "}),e.jsxs("div",{className:"w-1/2 text-end",children:["IDR ",B(f)]})]}),e.jsxs("div",{className:"md:w-1/2 w-full font-bold flex gap-1",children:[e.jsx("div",{className:"w-1/2",children:"TOTAL KREDIT "}),e.jsxs("div",{className:"w-1/2 text-end",children:["IDR ",B(j)]})]})]})]}),e.jsxs("div",{className:"md:flex font-bold gap-3",children:[e.jsx("div",{className:"w-5/12"}),e.jsxs("div",{className:"md:w-7/12 flex border-t py-3 gap-12 px-3",children:[e.jsx("div",{className:"w-1/2",children:"SELISIH "}),e.jsxs("div",{className:`w-1/2 text-end ${Math.abs(f-j)>0&&"text-red-500"}`,children:["IDR ",B(Math.abs(f-j))]})]})]}),e.jsxs("div",{className:"md:flex font-bold gap-3",children:[e.jsx("div",{className:"w-5/12"}),e.jsx("div",{className:"md:w-7/12 flex border-t py-3 gap-2 px-3",children:e.jsx("div",{className:"form-control",children:e.jsxs("label",{className:"label cursor-pointer gap-2",htmlFor:"checkbox",children:[e.jsx("input",{type:"checkbox",className:"checkbox",id:"checkbox",value:!c.is_approved,onChange:()=>r("is_approved",!c.is_approved),checked:!c.is_approved}),e.jsx("span",{className:"label-text",children:"Simpan Ke Dalam Draft"})]})})})]}),e.jsxs("div",{className:"flex justify-end flex-col-reverse sm:flex-row gap-2 mt-5",children:[e.jsx("div",{className:"w-full sm:w-1/12 my-auto text-center",children:e.jsx(T,{href:route("data-ledger.journal",n.id),children:e.jsx(ye,{className:"w-full",children:e.jsx("div",{className:"text-center w-full",children:"Batal"})})})}),Math.abs(f-j)===0&&Math.abs(f+j)!==0&&e.jsx("div",{className:"w-full sm:w-1/12 text-center",children:e.jsx(Se,{className:"w-full",disabled:Q,children:e.jsx("div",{className:"text-center w-full",children:"Tambah"})})})]})]})})})]})}ke.layout=n=>e.jsx(Ne,{header:e.jsx(be,{children:"Tambah Jurnal Umum"}),children:n,user:n.props.auth.user,organization:n.props.organization,title:"Tambah Jurnal Umum",backLink:e.jsx(T,{href:route("data-ledger.journal",n.props.organization.id),children:e.jsx(De,{})}),breadcrumbs:e.jsx("div",{className:"text-sm breadcrumbs",children:e.jsxs("ul",{children:[e.jsx("li",{className:"font-bold",children:e.jsx(T,{href:route("data-ledger",n.props.organization.id),children:"Buku Besar"})}),e.jsx("li",{className:"font-bold",children:e.jsx(T,{href:route("data-ledger.journal",n.props.organization.id),children:"Jurnal Umum"})}),e.jsx("li",{children:"Tambah Jurnal Umum"})]})}),role:n.props.role});export{ke as default};

import{r as p,j as e,W as me,y as ue,Y as ce,a as B}from"./app-f7a09652.js";import{D as xe,A as he}from"./AuthenticatedLayout-c244f9ed.js";import{H as fe}from"./Header-693ecab8.js";import{k as pe,Q as O}from"./react-toastify.esm-3b93a9f9.js";/* empty css                      */import{o as je,p as ve,I as Ne,a as we,A as be,c as _e}from"./index.esm-d266f787.js";import{d as P}from"./dayjs.min-d811e899.js";import{I as g}from"./InputLabel-dcaa09a0.js";import{a as ye,u as ge}from"./index.module-e6de8ac4.js";import{f as K}from"./formatNumber-b542c689.js";import{P as U}from"./PrimaryButton-02d903bc.js";import{S as Ce}from"./SecondaryButton-54b37b1d.js";import{C as Se}from"./ClientSelectInput-8f52b80f.js";import{H as A}from"./combobox-9f4a512d.js";import{z as De}from"./transition-2fb3bce8.js";import{T as I}from"./TextInput-9daff345.js";import{N as z}from"./react-number-format.es-0576c33a.js";import{M as Ie}from"./Modal-33ff5a47.js";import"./ApplicationLogo-bd8fcc84.js";import"./iconBase-e8876c39.js";import"./portal-a488097d.js";import"./close-provider-2e8d3748.js";function Ye({resources:d,selected:n,setSelected:o,maxHeight:v="max-h-60",placeholder:i,onCLick:m,isError:M=!0,id:l="",notFound:N=null}){const[C,r]=p.useState(""),[E,T]=p.useState(d);return p.useEffect(()=>{const j=C===""?d:d.filter(S=>S.name.toLowerCase().replace(/\s+/g,"").includes(C==null?void 0:C.toLowerCase().replace(/\s+/g,"")));T(j)},[C]),p.useEffect(()=>{r(n.name)},[n]),e.jsx(A,{value:n,onChange:o,children:e.jsxs("div",{className:"relative mt-1 w-full",children:[e.jsxs("div",{className:`relative w-full cursor-default rounded-md bg-white text-left border focus:outline-none focus-visible:ring-2 focus-visible:ring-white/75 focus-visible:ring-offset-2 focus-visible:ring-offset-teal-300 sm:text-sm ${M?"border-red-500":"border-gray-300"}`,children:[e.jsx(A.Input,{className:"w-full border-none py-3 pl-3 pr-10 leading-5 text-gray-800 focus:ring-0",displayValue:j=>j.name.toUpperCase(),onChange:j=>r(j.target.value.toUpperCase()),placeholder:i,type:"search",id:l}),e.jsx(A.Button,{className:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-600 text-lg",onClick:m,children:e.jsx(je,{})})]}),e.jsx(De,{as:p.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx(A.Options,{className:`absolute mt-1 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black/5 focus:outline-none sm:text-sm ${v} z-10`,children:E.length===0&&C!==""?e.jsx("div",{className:"relative cursor-default select-none px-4 py-2 text-gray-700",children:N??"Tidak Ada Data"}):E.map(j=>e.jsx(A.Option,{className:({active:S})=>`relative flex cursor-default select-none py-2 pl-10 pr-4 ${S?"bg-teal-600 text-white":"text-slate-900"}`,value:j,children:({selected:S,active:F})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`block truncate ${S?"font-medium":"font-normal"}`,children:[e.jsx("div",{className:"text-xs",children:j.position}),e.jsx("div",{className:"text-base",children:j.name.toUpperCase()})]}),S?e.jsx("div",{className:`absolute inset-y-0 left-0 flex items-center pl-3 ${F?"text-white":"text-teal-600"}`,children:e.jsx(ve,{className:"h-5 w-5","aria-hidden":"true"})}):null]})},j.id))})})]})})}const ke=()=>P().format("MM"),Te=()=>{let d=[];for(let n=7;n<13;n++)d=[...d,n];for(let n=1;n<7;n++)d=[...d,n];return d},V=d=>d.map(n=>{var o;return{id:n==null?void 0:n.contact_id,name:(o=n==null?void 0:n.contact)==null?void 0:o.name,position:n==null?void 0:n.position,no_ref:n==null?void 0:n.no_ref}}),Fe=(d,n)=>d.map(o=>{var v;return{id:o==null?void 0:o.contact_id,name:(v=o==null?void 0:o.contact)==null?void 0:v.name,position:o==null?void 0:o.position,no_ref:o==null?void 0:o.no_ref,value:n.reduce((i,m)=>i+(m.has_hour?0:m.value),0),categories:n.map(i=>({id:i==null?void 0:i.id,name:i==null?void 0:i.name,value:i==null?void 0:i.value,unit:i==null?void 0:i.unit,is_cut:!!(i!=null&&i.is_cut),has_hour:!!(i!=null&&i.has_hour),qty:i!=null&&i.has_hour?0:1,total:i!=null&&i.has_hour?0:i.value}))}});function Pe({organization:d,categories:n,newRef:o,date:v,cashAccounts:i,contacts:m,history:M}){var G,L;const{data:l,setData:N,post:C,errors:r,processing:E}=me({value:0,organization_id:d.id,no_ref:o,date:v,month:parseInt(ke()),study_year:P(v).format("YYYY").toString(),cash_account_id:"",details:Fe(m,n)}),[T,j]=p.useState({startDate:v,endDate:v}),[S,F]=p.useState({id:null,name:"",position:"",no_ref:""}),[b,Y]=p.useState({}),[q,H]=p.useState(!1),[J,Q]=p.useState({id:null,name:"",code:"",is_cash:!0}),[W]=ye(T,500),X=ge(T),[c,$]=p.useState(0);p.useEffect(()=>{ee()},[]),p.useEffect(()=>{X!==void 0&&Z()},[W]);const Z=()=>{ue.reload({only:["newRef"],data:{date:P(T.startDate).format("YYYY-MM-DD")},onSuccess:s=>{N("no_ref",s.props.newRef)}})},ee=()=>{var a,t,u,x,h,f,R,_,y,w;F({id:(a=m[0])==null?void 0:a.contact_id,name:(t=m[0])==null?void 0:t.contact.name,position:(u=m[0])==null?void 0:u.position,no_ref:(x=m[0])==null?void 0:x.no_ref}),Y({id:(h=l==null?void 0:l.details[0])==null?void 0:h.id,name:(f=l==null?void 0:l.details[0])==null?void 0:f.name,position:(R=l==null?void 0:l.details[0])==null?void 0:R.position,no_ref:(_=l==null?void 0:l.details[0])==null?void 0:_.no_ref,categories:(y=l==null?void 0:l.details[0])==null?void 0:y.categories,value:(w=l==null?void 0:l.details[0])==null?void 0:w.categories.reduce((D,k)=>D+(k.has_hour?0:k.value),0)});let s=l.details;N("value",s.reduce((D,k)=>D+k.value,0))},se=s=>{j(s),N("date",P(s.startDate).format("YYYY-MM-DD"))},ae=s=>{let a=s-1;F(V(m)[a]),Y({id:l.details[a].id,name:l.details[a].name,position:l.details[a].position,no_ref:l.details[a].no_ref,categories:l.details[a].categories,value:l.details[a].categories.reduce((t,u)=>t+(u.has_hour?0:u.value),0)}),$(a)},le=s=>{let a=s+1;F(V(m)[a]),Y({id:l.details[a].id,name:l.details[a].name,position:l.details[a].position,no_ref:l.details[a].no_ref,categories:l.details[a].categories,value:l.details[a].categories.reduce((t,u)=>t+(u.has_hour?0:u.value),0)}),$(a)},te=s=>{if(s){F({id:s.id,name:s.name,position:s.position,no_ref:s.no_ref});let a=V(m).findIndex(t=>t.id===s.id);Y({id:l.details[a].id,name:l.details[a].name,position:l.details[a].position,no_ref:l.details[a].no_ref,categories:l.details[a].categories}),$(a)}},ie=(s,a)=>{let t={...b},u=s.floatValue||0;t.categories[a]={...t.categories[a],qty:u,total:u*t.categories[a].value*(t.categories[a].is_cut?-1:1)},t={...t,value:t.categories.reduce((h,f)=>h+f.total,0)},Y(t);let x={...l};x.details[c]=t,x.value=x.details.reduce((h,f)=>h+f.value,0),N(x)},ne=(s,a)=>{let t={...b},u=s.floatValue||0;t.categories[a]={...t.categories[a],value:u,total:u*t.categories[a].qty*(t.categories[a].is_cut?-1:1)},t={...t,value:t.categories.reduce((h,f)=>h+f.total,0)},Y(t);let x={...l};x.details[c]=t,x.value=x.details.reduce((h,f)=>h+f.value,0),N(x)},de=()=>{var t,u,x,h,f,R;let s=l,a=s.details.map(_=>{let y=_.categories.map(w=>{let D=M.details.find(k=>k.contact_id===_.id&&k.category_id===w.id);return{...w,value:w.has_hour?w.value:D.value,total:w.has_hour?0:D.value,qty:w.has_hour?0:1}});return{..._,categories:y,value:y.reduce((w,D)=>w+D.total,0)}});s={...s,value:a.reduce((_,y)=>_+y.value,0),details:a},N(s),Y({id:(t=s==null?void 0:s.details[c])==null?void 0:t.id,name:(u=s==null?void 0:s.details[c])==null?void 0:u.name,position:(x=s==null?void 0:s.details[c])==null?void 0:x.position,no_ref:(h=s==null?void 0:s.details[c])==null?void 0:h.no_ref,categories:s.details[c].categories,value:(R=(f=s==null?void 0:s.details[c])==null?void 0:f.categories)==null?void 0:R.reduce((_,y)=>_+(y.has_hour?0:y.value),0)})},re=s=>{Q({id:s.id,name:s.name,code:s.code,is_cash:!0}),N("cash_account_id",s.id)},oe=s=>{s.preventDefault(),C(route("cashflow.staff-salary-payment.store",{organization:d.id}),{onSuccess:({props:a})=>{const{flash:t}=a;O.success(t.success,{position:O.POSITION.TOP_CENTER})},onError:a=>{const{error:t}=a;O.error(t,{position:O.POSITION.TOP_CENTER})}})};return e.jsxs(e.Fragment,{children:[e.jsx(ce,{title:"Pembayaran Gaji Staf"}),e.jsx(pe,{}),e.jsx("div",{className:"w-full sm:mt-2",children:e.jsx("div",{className:"sm:mx-auto px-3 sm:px-5 bg-white py-2 sm:pt-0 space-y-5 md:space-y-0",children:e.jsx("div",{className:"sm:pt-0 pb-16 pt-12",children:e.jsxs("div",{className:"bg-white py-2 px-2 sm:pt-0",children:[e.jsxs("div",{className:"w-full md:flex gap-2 md:py-5 ",children:[e.jsx("div",{className:"sm:w-1/2 text-center md:text-start w-full text-slate-900 space-y-2",children:e.jsx(U,{onClick:()=>H(!0),children:"Buat Pembayaran"})}),e.jsxs("div",{className:"sm:w-1/2 w-full text-center md:text-end text-sm text-slate-900 space-y-2 my-auto md:text-2xl font-bold",children:["Total: IDR. ",K(l.value)]})]}),e.jsxs("div",{className:"mt-5 md:mt-0",children:[e.jsxs("section",{children:[e.jsxs("div",{className:"flex justify-center gap-3",children:[e.jsx("div",{className:"my-auto",children:e.jsx("button",{onClick:()=>ae(c),className:"my-auto p-2",disabled:c<1?"disabled":!1,type:"button",children:e.jsx(Ne,{size:20,color:c<1?"gray":""})})}),e.jsx("div",{className:"my-auto relative md:w-1/3 w-3/4",children:e.jsx("div",{children:e.jsx(Ye,{resources:V(m),selected:S,setSelected:s=>te(s),maxHeight:"max-h-40",placeholder:"Cari Kontak",isError:!1,id:"contact",notFound:e.jsx("span",{children:"Tidak Ada Data."})})})}),e.jsx("div",{className:"my-auto",children:e.jsx("button",{onClick:()=>le(c),className:"my-auto p-2",disabled:m.length>c+1?!1:"disabled",type:"button",children:e.jsx(we,{size:20,color:m.length>c+1?"":"gray"})})})]}),e.jsxs("div",{className:"text-center text-xs",children:[c+1," / ",m.length]})]}),e.jsxs("section",{className:"w-full md:w-10/12 mx-auto mt-5",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(g,{value:"Nama Staff",htmlFor:"name",className:" mx-auto my-auto"})}),e.jsx("div",{className:"w-full sm:w-2/3",children:e.jsx(I,{id:"name",name:"name",className:"w-full",placeholder:"Nama",value:b.name||"",disabled:!0})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(g,{value:"Jabatan",htmlFor:"position",className:" mx-auto my-auto"})}),e.jsx("div",{className:"w-full sm:w-2/3",children:e.jsx(I,{id:"position",name:"position",className:"w-full",placeholder:"Jabatan",value:b.position||"",disabled:!0})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(g,{value:"No. Id",htmlFor:"id",className:" mx-auto my-auto"})}),e.jsx("div",{className:"w-full sm:w-2/3",children:e.jsx(I,{id:"id",name:"id",className:"w-full",placeholder:"No.Id",value:b.no_ref||"",disabled:!0})})]}),M&&e.jsx("div",{className:"w-full text-end mt-2 text-blue-500",children:e.jsxs("button",{className:"border text-xs rounded-md p-1 font-medium hover:bg-slate-100 flex space-x-1",onClick:de,children:[e.jsx("div",{className:"my-auto",children:e.jsx(be,{})}),e.jsx("div",{className:"my-auto",children:"Ambil Dari Data Sebelumnya"})]})}),((G=b==null?void 0:b.categories)==null?void 0:G.length)>0?e.jsx("div",{className:"mt-5 overflow-x-auto",children:e.jsxs("div",{className:"w-[750px] md:w-full",children:[e.jsxs("div",{className:"flex font-bold gap-3 border-b py-3",children:[e.jsx("div",{className:"w-4/12",children:"Kategori"}),e.jsx("div",{className:"w-2/12 text-end",children:"Jam/Hari"}),e.jsx("div",{className:"w-3/12 text-end",children:"Nilai"}),e.jsx("div",{className:"w-3/12 text-end",children:"Total"})]}),(L=b.categories)==null?void 0:L.map((s,a)=>e.jsxs("div",{className:"flex gap-3 border-b py-3",children:[e.jsx("div",{className:`w-5/12 my-auto${s.is_cut?" text-red-500":""}`,children:s.name}),e.jsx("div",{className:"w-1/12 text-end",children:s.has_hour&&e.jsxs("div",{className:"gap-1",children:[e.jsx(z,{value:s.qty,customInput:I,onValueChange:t=>ie(t,a),thousandSeparator:!0,className:`text-end w-full${s.is_cut?" text-red-500":""}`,prefix:""}),e.jsx("div",{className:"my-auto hidden md:block text-xs",children:s.unit})]})}),e.jsx("div",{className:"w-3/12 text-end",children:e.jsx(z,{value:s.value,customInput:I,onValueChange:t=>ne(t,a),thousandSeparator:!0,className:`text-end w-full${s.is_cut?" text-red-500":""}`,prefix:"IDR. "})}),e.jsx("div",{className:"w-3/12 text-end",children:e.jsx(z,{value:s.total,customInput:I,thousandSeparator:!0,className:`text-end w-full${s.is_cut?" text-red-500":""}`,prefix:"IDR. ",disabled:"disabled"})})]},a)),e.jsxs("div",{className:"flex font-bold gap-3 border-b py-3",children:[e.jsx("div",{className:"w-5/12",children:"Total"}),e.jsxs("div",{className:"w-7/12 text-end",children:["IDR. ",K(b.value)]})]})]})}):e.jsx("div",{className:"text-center mt-5",children:e.jsx(B,{href:route("data-master.salary-category",{organization:d.id}),children:e.jsx("button",{className:"border border-blue-500 text-blue-600 rounded-md px-5 py-1 font-bold hover:text-blue-400 hover:border-blue-400",children:e.jsx("span",{children:"Tambah Kategori"})})})})]})]})]})})})}),e.jsx(Ie,{show:q,onClose:()=>H(!1),children:e.jsxs("form",{onSubmit:oe,className:"p-6",id:"filter",name:"filter",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900",children:"Buat Pembayaran Gaji"}),e.jsxs("div",{className:"mt-6 ",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(g,{value:"No. Ref",htmlFor:"study_year",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(I,{id:"no_ref",name:"no_ref",className:"w-full",placeholder:"No Ref",value:l.no_ref||"",disabled:!0}),(r==null?void 0:r.no_ref)&&e.jsx("span",{className:"text-red-500 text-xs",children:r.no_ref})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(g,{value:"Tanggal",htmlFor:"study_year",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(xe,{value:T,onChange:se,inputClassName:(r==null?void 0:r.date)&&"border-red-500 rounded-lg",useRange:!1,asSingle:!0,placeholder:"Tanggal",id:"date",displayFormat:"MMMM DD, YYYY"}),(r==null?void 0:r.date)&&e.jsx("span",{className:"text-red-500 text-xs",children:r.date})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(g,{value:"Tahun Ajaran",htmlFor:"study_year",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsxs("select",{className:"select select-bordered w-full",value:l.study_year,onChange:s=>N("study_year",s.target.value),id:"study_year",children:[e.jsx("option",{children:P(v).format("YYYY").toString()}),e.jsx("option",{children:(P(v).format("YYYY")-1).toString()})]}),(r==null?void 0:r.study_year)&&e.jsx("span",{className:"text-red-500 text-xs",children:r.study_year})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(g,{value:"Bulan",htmlFor:"month",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx("select",{className:"select select-bordered w-full",value:l.month,onChange:s=>N("month",s.target.value),id:"month",children:Te().map((s,a)=>e.jsx("option",{children:s},a))}),(r==null?void 0:r.month)&&e.jsx("span",{className:"text-red-500 text-xs",children:r.month})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(g,{value:"Total",htmlFor:"total",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(z,{value:l.value,customInput:I,thousandSeparator:!0,className:"text-end w-full",prefix:"IDR. ",disabled:"disabled",id:"total"}),(r==null?void 0:r.value)&&e.jsx("span",{className:"text-red-500 text-xs",children:r.value})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(g,{value:"Akun Kas",htmlFor:"cash_account",className:" mx-auto my-auto"})}),e.jsx("div",{className:"w-full sm:w-2/3",children:e.jsx(Se,{resources:i,selected:J,setSelected:s=>re(s),maxHeight:"max-h-40",placeholder:"Cari Akun",isError:!!r.cash_account_id,id:"cash_account",notFound:e.jsxs("span",{children:["Tidak Ada Data. ",e.jsx(B,{className:"font-bold text-blue-600",href:route("data-ledger.account",{organization:d.id}),children:"Buat Baru ?"})]})})})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end",children:[e.jsx(Ce,{onClick:()=>H(!1),children:"Batal"}),e.jsx(U,{className:"ms-3",disabled:E,children:"Simpan"})]})]})})]})}Pe.layout=d=>e.jsx(he,{header:e.jsx(fe,{children:"Pembayaran Gaji Bulanan"}),children:d,user:d.props.auth.user,organization:d.props.organization,title:"Pembayaran Gaji Bulanan",backLink:e.jsx(B,{href:route("cashflow",d.props.organization.id),children:e.jsx(_e,{})}),breadcrumbs:e.jsx("div",{className:"text-sm breadcrumbs",children:e.jsxs("ul",{children:[e.jsx("li",{className:"font-bold",children:e.jsx(B,{href:route("cashflow.staff-salary-payment",d.props.organization.id),children:"Arus Kas"})}),e.jsx("li",{className:"font-bold",children:e.jsx(B,{href:route("cashflow.staff-salary-payment",d.props.organization.id),children:"Pembayaran Gaji Bulanan"})}),e.jsx("li",{children:"Tambah Pembayaran Gaji Bulanan"})]})}),role:d.props.role});export{Pe as default};

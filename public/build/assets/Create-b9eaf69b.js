import{r as f,W,y as q,j as e,Y as G,a as v}from"./app-a7ce059d.js";import{D as J,A as X}from"./AuthenticatedLayout-76fda790.js";import{H as Z}from"./Header-0da6650e.js";import{k as ee,Q as w}from"./react-toastify.esm-2e3bc2c6.js";/* empty css                      */import{c as ae}from"./index.esm-9ab17142.js";import{F as te}from"./FormInput-aa45199a.js";import{I as c}from"./InputLabel-8af4e50a.js";import{T as N}from"./TextInput-cd094612.js";import{S as se}from"./SecondaryButton-1129a0a6.js";import{P as le}from"./PrimaryButton-314b1799.js";import{d as y}from"./dayjs.min-4bdbfd9d.js";import{s as I}from"./studyYear-eecc7e88.js";import{C as ne}from"./StudentSelectInput-b767d163.js";import{N as de}from"./react-number-format.es-af491b55.js";import{f as oe}from"./formatNumber-b542c689.js";import{C as ie}from"./ClientSelectInput-cc728f50.js";import{a as me,u as re}from"./index.module-a7a23c76.js";import"./ApplicationLogo-02651b1a.js";import"./iconBase-9a3ee22c.js";import"./transition-b97dbf58.js";import"./combobox-873a095c.js";import"./portal-be516ad9.js";const ce=()=>{const l=y().year(),d=l-10;let h=[];for(let u=d;u<l+1;u++)h=[...h,u];return h},ue=()=>{let l=[];for(let d=7;d<13;d++)l=[...l,d];for(let d=1;d<7;d++)l=[...l,d];return l},T=()=>y().format("MM");function xe({organization:l,newRef:d,contacts:h,date:u,categories:C,studyYears:fe,accounts:Y,lastPayment:he,selectedContactParam:o}){const[F,_]=f.useState(0),{data:n,setData:m,processing:R,post:E,errors:t,setError:B,reset:pe}=W({contact_id:o?o.id:null,date:u,level:o?o.last_level.level:"",student_id:o?o.student.no_ref:"",no_ref:d,value:F,month:parseInt(T()),study_year:I(),description:"",credit_account:null,details:[]}),[M,g]=f.useState({id:o?o.id:null,name:o?o.name:"",phone:o?o.phone:""}),[p,S]=f.useState({id:null,name:"",code:"",is_cash:!1}),[j,A]=f.useState({startDate:u,endDate:u}),[k]=me(j,500),O=re(j);f.useEffect(()=>{D(d)},[]),f.useEffect(()=>{O!==void 0&&j.startDate&&$()},[k]);const D=a=>{let s=n,r=C.map(x=>({id:x.id,name:x.name,value:x.value})),i=r.reduce((x,b)=>x+b.value,0);_(i),s={...s,value:i,details:r,date:u,no_ref:a,month:parseInt(T()),study_year:I(),description:"",credit_account:null},m(s)},$=a=>{q.reload({only:["newRef"],data:{date:y(j.startDate).format("YYYY-MM-DD")},onSuccess:({props:s})=>{const{newRef:r}=s;let i=n;i={...n,no_ref:r,date:a},m(i)},onError:s=>{console.log(s)}})},K=a=>{a.preventDefault(),E(route("cashflow.student-monthly-receivable.store",l.id),{onSuccess:({props:s})=>{const{flash:r,newRef:i}=s;w.success(r.success,{position:w.POSITION.TOP_CENTER}),g({id:null,name:"",phone:""}),S({id:null,name:"",code:"",is_cash:!1}),D(i)},onError:s=>{console.log(s),w.error(s.error,{position:w.POSITION.TOP_CENTER})},preserveScroll:!1})},L=a=>{if(a){g({id:a.id,name:a.name,phone:a.phone});let s=n;s={...s,contact_id:a.id,description:`Piutang Iuran Bulanan dari ${a.name.toUpperCase()}`,student_id:a.student.no_ref,level:a.last_level.level},m(s)}},V=a=>{A(a),m("date",y(a.startDate).format("YYYY-MM-DD"))},z=(a,s)=>{const{value:r}=a;let i=[...n.details];i[s]={...i[s],value:parseInt(r)};let x=i.reduce((b,Q)=>b+Q.value,0);_(x),m({...n,details:i,value:x})},H=a=>{m("study_year",a.target.value)},P=a=>{m("month",parseInt(a.target.value))},U=a=>{a&&(S({id:a.id,name:a.name,code:a.code,is_cash:!1}),m("credit_account",a.id),B("credit_account",""))};return e.jsxs(e.Fragment,{children:[e.jsx(G,{title:"Tambah Piutang Iuran Bulanan Siswa"}),e.jsx(ee,{}),e.jsx(te,{onSubmit:K,children:e.jsx("div",{className:"w-full md:mt-2 md:py-5",children:e.jsxs("div",{className:"md:w-1/2 md:mx-auto px-3 md:px-0",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(c,{value:"No. Ref",htmlFor:"no_ref",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx(N,{id:"no_ref",name:"no_ref",className:`w-full ${(t==null?void 0:t.no_ref)&&"border-red-500"}`,placeholder:"No. Ref",value:n.no_ref||"",onChange:a=>m("no_ref",a.target.value.toUpperCase()),disabled:!0}),(t==null?void 0:t.no_ref)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.no_ref})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(c,{value:"Tanggal Input",htmlFor:"date",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx("div",{children:e.jsx(J,{value:j,onChange:V,inputClassName:(t==null?void 0:t.date)&&"border-red-500 rounded-lg",useRange:!1,asSingle:!0,placeholder:"Tanggal",id:"date",displayFormat:"MMMM DD, YYYY"})}),(t==null?void 0:t.date)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.date})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(c,{value:"Nama Siswa",htmlFor:"name",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx(ne,{resources:h,selected:M,setSelected:a=>L(a),maxHeight:"max-h-40",placeholder:"Cari Kontak",isError:!!t.contact_id,id:"name",notFound:e.jsxs("span",{children:["Tidak Ada Data. ",e.jsx(v,{className:"font-bold text-blue-600",href:route("data-master.students.create",{organization:l.id}),children:"Buat Baru ?"})]})}),(t==null?void 0:t.name)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.name})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(c,{value:"No. Siswa",htmlFor:"student_id",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx(N,{id:"student_id",name:"student_id",className:`w-full ${(t==null?void 0:t.student_id)&&"border-red-500"}`,placeholder:"No. Siswa",value:n.student_id||"",onChange:a=>m("student_id",a.target.value.toUpperCase()),disabled:!0}),(t==null?void 0:t.student_id)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.student_id})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(c,{value:"Kelas",htmlFor:"level",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx(N,{id:"level",name:"level",className:`w-full ${(t==null?void 0:t.level)&&"border-red-500"}`,placeholder:"Kelas",value:n.level||"",onChange:a=>m("level",a.target.value.toUpperCase()),disabled:!0}),(t==null?void 0:t.level)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.level})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(c,{value:"Tahun Ajaran",htmlFor:"study_year",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx("select",{className:"select select-bordered w-full",value:n.study_year,onChange:H,id:"study_year",children:ce().map((a,s)=>e.jsxs("option",{value:`${a.toString()}/${(a+1).toString()}`,children:[a.toString(),"/",(a+1).toString()]},s))}),(t==null?void 0:t.study_year)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.study_year})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(c,{value:"Bulan",htmlFor:"month",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx("select",{className:"select select-bordered w-full",value:n.month,onChange:P,id:"month",children:ue().map((a,s)=>e.jsx("option",{value:a,children:a},s))}),(t==null?void 0:t.month)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.month})]})]}),e.jsx("div",{className:"text-center mt-5 font-bold",children:"Rincian Pembayaran"}),n.details.map((a,s)=>e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(c,{value:a.name,htmlFor:`category-${s}`,className:" mx-auto my-auto"})}),e.jsx("div",{className:"w-full md:w-2/3",children:e.jsx(de,{value:a.value,customInput:N,onValueChange:r=>z(r,s),thousandSeparator:!0,className:"text-end w-full border",prefix:"IDR ",id:`category-${s}`})})]},s)),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 pt-5 md:mt-2 font-bold text-xl",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:"TOTAL"}),e.jsxs("div",{className:"w-full md:w-2/3 text-end",children:["Rp. ",oe(n.value)]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(c,{value:"Akun Kredit",htmlFor:"account",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(ie,{resources:Y,selected:p,setSelected:a=>U(a),maxHeight:"max-h-40",placeholder:"Cari Akun",isError:!!t.cash_account_id,id:"account",contactFilter:""}),(p==null?void 0:p.code)&&e.jsxs("div",{className:"absolute text-xs",children:["Kode: ",p.code]}),(t==null?void 0:t.cash_account_id)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.cash_account_id})]})]}),e.jsxs("div",{className:"flex justify-end flex-col-reverse md:flex-row gap-2 mt-5",children:[e.jsx("div",{className:"w-full md:w-1/6 my-auto text-center",children:e.jsx(v,{href:route("cashflow.student-monthly-receivable",l.id),children:e.jsx(se,{className:"w-full",children:e.jsx("div",{className:"text-center w-full",children:"Kembali"})})})}),e.jsx("div",{className:"w-full md:w-1/6 text-center",children:e.jsx(le,{className:"w-full",disabled:R,children:e.jsx("div",{className:"text-center w-full",children:"Simpan"})})})]})]})})})]})}xe.layout=l=>e.jsx(X,{header:e.jsx(Z,{children:"Tambah Piutang Iuran Bulanan Siswa"}),children:l,user:l.props.auth.user,organization:l.props.organization,title:"Tambah Piutang Iuran",backLink:e.jsx(v,{href:route("cashflow.student-monthly-receivable",l.props.organization.id),children:e.jsx(ae,{})}),breadcrumbs:e.jsx("div",{className:"text-sm breadcrumbs",children:e.jsxs("ul",{children:[e.jsx("li",{className:"font-bold",children:e.jsx(v,{href:route("cashflow",l.props.organization.id),children:"Arus Kas"})}),e.jsx("li",{className:"font-bold",children:e.jsx(v,{href:route("cashflow.student-monthly-receivable",l.props.organization.id),children:"Piutang Iuran Bulanan Siswa"})}),e.jsx("li",{children:"Tambah Piutang Iuran Bulanan Siswa"})]})}),role:l.props.role});export{xe as default};

import{W as U,r as o,y as z,j as e,Y as H,a as x}from"./app-28f057a8.js";import{D as L,A as G}from"./AuthenticatedLayout-a131beb6.js";import{H as J}from"./Header-c8c7120c.js";import{k as W,Q as p}from"./react-toastify.esm-1130444f.js";/* empty css                      */import{c as q}from"./index.esm-3b8f85fe.js";import{F as X}from"./FormInput-bf8f1bdf.js";import{I as d}from"./InputLabel-9f8e8fe1.js";import{T as v}from"./TextInput-ff1279f3.js";import{S as Z}from"./SecondaryButton-3632f05d.js";import{P as Q}from"./PrimaryButton-398f9bdd.js";import"./dayjs.min-4edafb27.js";import"./studyYear-1ee84d9d.js";import{C as ee}from"./StudentSelectInput-4e8d313e.js";import{N as ae}from"./react-number-format.es-c64d958c.js";import{f as y}from"./formatNumber-b542c689.js";import{C as se}from"./ClientSelectInput-18a0bb47.js";import le from"./ReceivableListBox-39d29b48.js";import"./ApplicationLogo-8c63ae5a.js";import"./iconBase-23d67abb.js";import"./transition-5f3f5d30.js";import"./index.module-9c92c4e1.js";import"./combobox-c6c90819.js";import"./portal-1adaa066.js";function te({organization:m,newRef:w,contacts:g,contact:ne,date:f,selectedContactQuery:t,studyYears:ie,cashAccounts:S,payments:i}){const{data:n,setData:r,processing:T,post:P,errors:s,setError:I,reset:D}=U({contact_id:t?t.id:null,date:f,level:t?t.last_level.level:"",student_id:t?t.student.no_ref:"",no_ref:w,value:i.length>0?i[0].receivable_value:0,paidValue:0,description:t?`Pembayaran Piutang Iuran Tahunan Oleh ${t.name}`:"",payment_id:i.length>0?i[0].id:null,cash_account_id:null}),[h,N]=o.useState({id:t?t.id:null,name:t?t.name:"",phone:t?t.phone:""}),[c,_]=o.useState({id:null,name:"",code:"",is_cash:!0}),[u,j]=o.useState({id:i.length>0?i[0].id:null,noRef:i.length>0?i[0].no_ref:"",receivablevalue:i.length>0?i[0].receivable_value:0,studyYear:i.length>0?i[0].study_year:""}),[R,F]=o.useState(i),[C,E]=o.useState({startDate:f,endDate:f});o.useEffect(()=>{b(w)},[]),o.useEffect(()=>{setTimeout(()=>{h.id&&Y()},0)},[h]);const Y=()=>{z.reload({only:["payments"],data:{selectedContact:h.id},onSuccess:({props:a})=>{const{payments:l}=a;r({...n,value:l[0].receivable_value,payment_id:l[0].id}),F(l),j({id:l[0].id,noRef:l[0].no_ref,receivablevalue:l[0].receivable_value,studyYear:l[0].study_year})}})},b=a=>{let l=n;l={...l,date:f,no_ref:a,paidValue:0,cash_account_id:null},r(l)},A=a=>{a.preventDefault(),P(route("cashflow.student-entry-receivable-payment.store",m.id),{only:["newRef","flash"],onSuccess:({props:l})=>{const{flash:K,newRef:M}=l;D(),p.success(K.success,{position:p.POSITION.TOP_CENTER}),_({id:null,name:"",code:"",is_cash:!0}),N({id:null,name:"",phone:""}),j({id:null,noRef:"",receivablevalue:0,studyYear:""}),b(M)},onError:l=>{p.error(l.error,{position:p.POSITION.TOP_CENTER})},preserveScroll:!1,preserveState:!0})},k=a=>{E(a),r("date",`${a.startDate.getFullYear()}-${a.startDate.getMonth()+1}-${a.startDate.getDate()}`)},O=a=>{if(a){N({id:a?a.id:null,name:a?a.name:"",phone:a?a.phone:""});let l=n;l={...l,contact_id:a?a.id:null,description:`Pembayaran Iuran Tahunan dari ${a?a.name.toUpperCase():""}`,student_id:a?a.student.no_ref:"",level:a?a.last_level.level:""},r(l)}},V=a=>{a&&(_({id:a.id,name:a.name,code:a.code,is_cash:!0}),r("cash_account_id",a.id),I("cash_account_id",""))},$=a=>{const{value:l}=a;r("paidValue",parseInt(l)??0)},B=a=>{a&&j({id:a.id,noRef:a.no_ref,receivablevalue:a.receivable_value,studyYear:a.study_year})};return e.jsxs(e.Fragment,{children:[e.jsx(H,{title:"Piutang Iuran Tahunan Siswa"}),e.jsx(W,{}),e.jsx(X,{onSubmit:A,children:e.jsx("div",{className:"w-full sm:mt-2 sm:py-5",children:e.jsxs("div",{className:"sm:w-1/2 sm:mx-auto px-3 sm:px-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(d,{value:"No. Ref",htmlFor:"no_ref",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(v,{id:"no_ref",name:"no_ref",className:`w-full ${(s==null?void 0:s.no_ref)&&"border-red-500"}`,placeholder:"No. Ref",value:n.no_ref||"",onChange:a=>r("no_ref",a.target.value.toUpperCase())}),(s==null?void 0:s.no_ref)&&e.jsx("span",{className:"text-red-500 text-xs",children:s.no_ref})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(d,{value:"Tanggal",htmlFor:"date",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx("div",{children:e.jsx(L,{value:C,onChange:k,inputClassName:(s==null?void 0:s.date)&&"border-red-500 rounded-lg",useRange:!1,asSingle:!0,placeholder:"Tanggal",inputId:"date",displayFormat:"MMMM DD, YYYY"})}),(s==null?void 0:s.date)&&e.jsx("span",{className:"text-red-500 text-xs",children:s.date})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(d,{value:"Nama Siswa",htmlFor:"name",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(ee,{resources:g,selected:h,setSelected:a=>O(a),maxHeight:"max-h-40",placeholder:"Cari Kontak",isError:!!s.contact_id,id:"name",notFound:e.jsxs("span",{children:["Tidak Ada Data. ",e.jsx(x,{className:"font-bold text-blue-600",href:route("data-master.students.create",{organization:m.id}),children:"Buat Baru ?"})]})}),(s==null?void 0:s.name)&&e.jsx("span",{className:"text-red-500 text-xs",children:s.name})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(d,{value:"No. Siswa",htmlFor:"student_id",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(v,{id:"student_id",name:"student_id",className:`w-full ${(s==null?void 0:s.student_id)&&"border-red-500"}`,placeholder:"No. Siswa",value:n.student_id||"",onChange:a=>r("student_id",a.target.value.toUpperCase()),disabled:!0}),(s==null?void 0:s.student_id)&&e.jsx("span",{className:"text-red-500 text-xs",children:s.student_id})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(d,{value:"Kelas",htmlFor:"level",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(v,{id:"level",name:"level",className:`w-full ${(s==null?void 0:s.level)&&"border-red-500"}`,placeholder:"Kelas",value:n.level||"",onChange:a=>r("level",a.target.value.toUpperCase()),disabled:!0}),(s==null?void 0:s.level)&&e.jsx("span",{className:"text-red-500 text-xs",children:s.level})]})]}),e.jsx("div",{className:"text-center mt-5 font-bold",children:"Rincian Pembayaran"}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(d,{value:"No Ref",htmlFor:"payment",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(le,{id:"payment",payments:R,isError:!1,selected:u,setSelected:a=>B(a)}),(u==null?void 0:u.studyYear)&&e.jsxs("div",{className:"absolute text-xs",children:["Tahun Ajaran: ",u.studyYear]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 pt-5 sm:mt-2 font-bold text-xl",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:"TOTAL PIUTANG"}),e.jsxs("div",{className:"w-full sm:w-2/3 text-end",children:["Rp. ",y(n.value)]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(d,{value:"Jumlah Bayar",htmlFor:"paid-value",className:" mx-auto my-auto"})}),e.jsx("div",{className:"w-full sm:w-2/3",children:e.jsx(ae,{value:n.paidValue,customInput:v,onValueChange:a=>$(a),thousandSeparator:!0,className:"text-end w-full border",prefix:"IDR ",id:"paid-value"})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:"Sisa"}),e.jsxs("div",{className:"w-full sm:w-2/3 text-end",children:["Rp. ",y(n.value-n.paidValue)]})]}),n.paidValue>0&&e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(d,{value:"Akun Kas",htmlFor:"account",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(se,{resources:S,selected:c,setSelected:a=>V(a),maxHeight:"max-h-40",placeholder:"Cari Akun",isError:!!s.cash_account_id,id:"account",contactFilter:""}),(c==null?void 0:c.code)&&e.jsxs("div",{className:"absolute text-xs",children:["Kode: ",c.code]}),(s==null?void 0:s.cash_account_id)&&e.jsx("span",{className:"text-red-500 text-xs",children:s.cash_account_id})]})]}),e.jsxs("div",{className:"flex justify-end flex-col-reverse sm:flex-row gap-2 mt-5",children:[e.jsx("div",{className:"w-full sm:w-1/6 my-auto text-center",children:e.jsx(x,{href:route("cashflow.student-entry-receivable-payment",m.id),children:e.jsx(Z,{className:"w-full",children:e.jsx("div",{className:"text-center w-full",children:"Kembali"})})})}),n.value-n.paidValue>=0&&n.cash_account_id&&e.jsx("div",{className:"w-full sm:w-1/6 text-center",children:e.jsx(Q,{className:"w-full",disabled:T,children:e.jsx("div",{className:"text-center w-full",children:"Simpan"})})})]})]})})})]})}te.layout=m=>e.jsx(G,{header:e.jsx(J,{children:"Tambah Pembayaran"}),children:m,user:m.props.auth.user,organization:m.props.organization,title:"Tambah Pembayaran",backLink:e.jsx(x,{href:route("cashflow.student-entry-receivable-payment",m.props.organization.id),children:e.jsx(q,{})}),breadcrumbs:e.jsx("div",{className:"text-sm breadcrumbs",children:e.jsxs("ul",{children:[e.jsx("li",{className:"font-bold",children:e.jsx(x,{href:route("cashflow",m.props.organization.id),children:"Arus Kas"})}),e.jsx("li",{className:"font-bold",children:e.jsx(x,{href:route("cashflow.student-entry-receivable-payment",m.props.organization.id),children:"Pembayaran Iuran Tahunan Siswa"})}),e.jsx("li",{children:"Tambah Pembayaran"})]})}),role:m.props.role});export{te as default};

import{r as o,S,j as e,m as xe,L as he,$ as x}from"./app-aef41eca.js";import{D as fe,A as pe}from"./AuthenticatedLayout-905ab386.js";import{H as ve}from"./Header-254e6151.js";import{k as je,Q as d}from"./react-toastify.esm-ec23f08f.js";/* empty css                      */import{o as be,p as Ne,I,a as E,b as _e,c as ge}from"./index.esm-8e56d419.js";import{M as J}from"./Modal-e115ddba.js";import{S as q}from"./SecondaryButton-669ef098.js";import{P as we}from"./PrimaryButton-2671d8c0.js";import{C as ye}from"./ContainerDesktop-4bf9900d.js";import{T as Se,a as Ce,P as ke,C as De}from"./ContentDesktop-6280eecf.js";import{C as Te}from"./ContentMobile-828b2b58.js";import Ie from"./SavingLedgerMobile-75250caa.js";import Ee from"./SavingLedgerDesktop-60d2e6a6.js";import{I as _}from"./InputLabel-09c9c962.js";import{T as U}from"./TextInput-0f4f9ffc.js";import{C as Oe}from"./ClientSelectInput-1c7e7cc8.js";import{D as Fe}from"./DangerButton-83e46f88.js";import{u as Z,a as ee}from"./index.module-1ab15072.js";import{a as W,b as X}from"./index.esm-92d35de4.js";import{H as y}from"./combobox-d5d5103d.js";import{z as Pe}from"./transition-ade245dd.js";import{N as Ae}from"./react-number-format.es-1a596a76.js";import{d as Re}from"./dayjs.min-241ae6cd.js";import{f as Me}from"./formatNumber-b542c689.js";import"./ApplicationLogo-af080d56.js";import"./iconBase-4cdc82a0.js";import"./portal-99a8cb71.js";import"./close-provider-c10cfe23.js";import"./index.esm-d6f255bc.js";function Be({resources:t,selected:c,setSelected:v,maxHeight:O="max-h-60",placeholder:F,onCLick:P,isError:A=!0,id:h="",contactFilter:R="",notFound:i}){const[r,C]=o.useState(R),[k,s]=o.useState(t),j=Z(r),[D]=ee(r,500);o.useEffect(()=>{j!==void 0&&$()},[D]);const $=()=>{S.reload({only:["balances"],data:{contact:r},onSuccess:({props:n})=>{const{balances:m}=n;s(m)}})};return o.useEffect(()=>{C(c==null?void 0:c.name)},[c]),e.jsx(y,{value:c,onChange:v,children:e.jsxs("div",{className:"relative mt-1",children:[e.jsxs("div",{className:`relative w-full cursor-default rounded-md bg-white text-left border focus:outline-none focus-visible:ring-2 focus-visible:ring-white/75 focus-visible:ring-offset-2 focus-visible:ring-offset-teal-300 sm:text-sm ${A?"border-red-500":"border-gray-300"}`,children:[e.jsx(y.Input,{className:"w-full border-none py-3 pl-3 pr-10 leading-5 text-gray-800 focus:ring-0",displayValue:n=>n==null?void 0:n.no_ref.toUpperCase(),onChange:n=>C(n.target.value.toUpperCase()),placeholder:F,type:"search",id:h}),e.jsx(y.Button,{className:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-600 text-lg",onClick:P,children:e.jsx(be,{})})]}),e.jsx(Pe,{as:o.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx(y.Options,{className:`absolute mt-1 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black/5 focus:outline-none sm:text-sm ${O} z-10`,children:k.length===0&&r!==""?e.jsx("div",{className:"relative cursor-default select-none px-4 py-2 text-gray-700",children:i??"Tidak Ada Data"}):k.map(n=>e.jsx(y.Option,{className:({active:m})=>`relative flex cursor-default select-none py-2 pl-10 pr-4 ${m?"bg-teal-600 text-white":"text-slate-900"}`,value:n,children:({selected:m,active:M})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`block truncate ${m?"font-medium":"font-normal"}`,children:[e.jsxs("div",{className:"text-xs",children:["Kategori Simpanan: ",e.jsx("span",{className:"font-bold",children:n.saving_category.name.toUpperCase()})]}),e.jsxs("div",{className:"text-base",children:[n.student?`${n.student.no_ref?n.student.no_ref+"-":""}`:"",n.no_ref.toUpperCase()]}),e.jsx("div",{className:"text-xs",children:e.jsxs("span",{className:"text-[10px] font-bold",children:[n.contact.name," (",n.contact.contact_categories[0].name.toUpperCase(),")"]})})]}),m?e.jsx("div",{className:`absolute inset-y-0 left-0 flex items-center pl-3 ${M?"text-white":"text-teal-600"}`,children:e.jsx(Ne,{className:"h-5 w-5","aria-hidden":"true"})}):null]})},n.id))})})]})})}function ze({ledgers:t,organization:c,role:v,newRefCredit:O,newRefDebit:F,querySearch:P,balances:A,date:h,cashAccounts:R}){const{data:i,setData:r,post:C,patch:k,errors:s,setError:j,processing:D,reset:$,delete:n}=xe({id:null,balance_id:null,balance_value:0,value:0,type:"",date:h,description:"",no_ref:"",cash_account_id:null}),[m,M]=o.useState({startDate:h,endDate:h}),[f,b]=o.useState({id:null,name:"",no_ref:"",balance_value:0}),[ae,N]=o.useState({id:null,name:"",code:"",is_cash:!0}),[L,B]=o.useState({title:"Tambah Data Simpanan",submit:"Tambah"}),[se,p]=o.useState(!1),[te,T]=o.useState(!1),[H,g]=o.useState(!1),[u,V]=o.useState(P||""),[le]=ee(u,500),ne=Z(u);o.useEffect(()=>{ne!==void 0&&ie()},[le]);const ie=()=>{S.reload({only:["ledgers"],data:{search:u},preserveState:!0})},z=()=>{S.reload({only:["balances"],data:{contact:""},preserveState:!0})},Y=a=>{B({title:(a.debit>0?"Tarik":"Tambah")+" Simpanan",submit:"Ubah"}),p(!0),g(!0),j({id:"",value:"",balance_id:"",balance_value:"",type:"",date:"",description:"",no_ref:"",cash_account_id:""}),r({id:a.id,value:a.debit>0?a.debit:a.credit,balance_id:a.saving_balance_id,balance_value:a.saving_balance.value,type:a.debit>0?"debit":"credit",date:a.date,description:a.description,no_ref:a.no_ref,cash_account_id:a.cash_account_id}),b({id:a.saving_balance.id,name:a.saving_balance.contact.name,no_ref:a.saving_balance.no_ref,balance_value:a.saving_balance.value}),N({id:a.cash_account_id,name:a.cash_account.name,code:a.cash_account.code,is_cash:!0})},K=a=>{r("id",a.id),T(!0)},re=a=>{M(a),r("date",Re(a.startDate).format("YYYY-MM-DD"))},ce=a=>{const{floatValue:l}=a;r("value",l)},oe=a=>{if(a){b({id:a.id,name:a.contact.name,no_ref:a.no_ref,balance_value:a.value});let l={...i};l={...l,balance_id:a.id,balance_value:a.value},r(l)}},Q=()=>{j({id:"",value:"",balance_id:"",balance_value:"",type:"",date:"",description:"",no_ref:"",cash_account_id:""}),f.id&&z(),b({id:null,name:"",no_ref:"",balance_value:0}),N({id:null,name:"",code:"",is_cash:!0}),p(!0),g(!1),B({title:"Tambah Simpanan",submit:"Tambah"}),r({id:null,no_ref:O,balance_value:0,balance_id:null,value:0,type:"credit",date:h,description:"SETOR TABUNGAN",cash_account_id:null})},G=()=>{j({id:"",value:"",balance_id:"",balance_value:"",type:"",date:"",description:"",no_ref:"",cash_account_id:""}),f.id&&z(),b({id:null,name:"",no_ref:"",balance_value:0}),N({id:null,name:"",code:"",is_cash:!0}),p(!0),g(!1),B({title:"Tarik Simpanan",submit:"Tarik"}),r({id:null,no_ref:F,balance_value:0,balance_id:null,value:0,date:h,type:"debit",description:"TARIK TABUNGAN",cash_account_id:null})},de=a=>{a&&(N({id:a.id,name:a.name,code:a.code,is_cash:!0}),r("cash_account_id",a.id),j("cash_account_id",""))},ue=a=>{a.preventDefault(),H?k(route("cashflow.saving.ledger.update",{organization:c.id,ledger:i.id}),{onSuccess:({props:l})=>{const{flash:w}=l;S.replace(window.location.pathname),d.success(w.success,{position:d.POSITION.TOP_CENTER}),b({id:null,name:"",no_ref:"",balance_value:0}),N({id:null,name:"",code:"",is_cash:!0}),p(!1),g(!1)},onError:l=>{d.error(l.error,{position:d.POSITION.TOP_CENTER})}}):C(route("cashflow.saving.ledger.store",{organization:c.id}),{onSuccess:({props:l})=>{const{flash:w}=l;S.replace(window.location.pathname),d.success(w.success,{position:d.POSITION.TOP_CENTER}),z(),b({id:null,name:"",no_ref:"",balance_value:0}),N({id:null,name:"",code:"",is_cash:!0}),p(!1),g(!1)},onError:l=>{console.log(l)}})},me=a=>{a.preventDefault(),n(route("cashflow.saving.ledger.delete",{organization:c.id,ledger:i.id}),{onSuccess:({props:l})=>{const{flash:w}=l;d.success(w.success,{position:d.POSITION.TOP_CENTER}),T(!1)},onError:l=>{d.error(l.error,{position:d.POSITION.TOP_CENTER})}})};return e.jsxs(e.Fragment,{children:[e.jsx(he,{title:"Tambah/Tarik Simpanan"}),e.jsx(je,{}),v!=="viewer"&&e.jsxs("div",{className:"md:hidden fixed bottom-2 w-full z-40 flex",children:[e.jsx("div",{className:"px-2",children:e.jsx("button",{type:"button",className:"btn bg-green-800 text-white w-full",onClick:Q,children:e.jsx("div",{className:"text-xl font-bold rotate-90",children:e.jsx(W,{})})})}),e.jsx("div",{className:"px-2",children:e.jsx("button",{type:"button",className:"btn bg-orange-800 text-white w-full",onClick:G,children:e.jsx("div",{className:"text-xl font-bold -rotate-90",children:e.jsx(X,{})})})})]}),e.jsx(Se,{zIndex:"z-50",search:u,setSearch:a=>V(a.target.value),pageBefore:t.links[0].url?e.jsx(x,{href:route("cashflow.saving.ledger",{organization:c.id,page:t.current_page-1,search:u}),preserveState:!0,only:["ledgers"],children:e.jsx(I,{})}):e.jsx("div",{className:"text-gray-300",children:e.jsx(I,{})}),pageAfter:t.links[t.links.length-1].url?e.jsx(x,{href:route("cashflow.saving.ledger",{organization:c.id,page:t.current_page+1,search:u}),only:["ledgers"],preserveState:!0,children:e.jsx(E,{})}):e.jsx("div",{className:"text-gray-300",children:e.jsx(E,{})}),page:e.jsxs(e.Fragment,{children:[t.current_page,"/",t.last_page]}),data:t}),e.jsx(Te,{children:t.data.map(a=>e.jsx(Ie,{ledger:a,handleDelete:()=>K(a),handleEdit:()=>Y(a),role:v},a.id))}),e.jsxs(ye,{children:[e.jsxs(Ce,{children:[e.jsx("div",{className:"my-auto w-7/12",children:v!=="viewer"&&e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{onClick:Q,className:"bg-green-800 px-4 py-2 text-white border border-transparent rounded-md font-semibold",children:e.jsx("div",{className:"text-xl font-bold rotate-90",children:e.jsx(W,{})})}),e.jsx("button",{onClick:G,className:"bg-orange-800 px-4 py-2 text-white border border-transparent rounded-md font-semibold",children:e.jsx("div",{className:"text-xl font-bold -rotate-90",children:e.jsx(X,{})})})]})}),e.jsxs("div",{className:"w-3/12 border flex rounded-lg",children:[e.jsx("label",{htmlFor:"search-input",className:"my-auto ml-2",children:e.jsx(_e,{})}),e.jsx("input",{id:"search-input",name:"search-input",type:"search",placeholder:"Cari",className:"w-full border-none focus:outline-none focus:ring-0",value:u||"",onChange:a=>V(a.target.value)})]}),e.jsx("div",{className:"italic text-xs my-auto w-1/12 text-center",children:e.jsx(ke,{data:t})}),e.jsxs("div",{className:"my-auto flex space-x-2 w-1/12",children:[e.jsx("div",{className:"my-auto",children:t.links[0].url?e.jsx(x,{href:route("cashflow.saving.ledger",{organization:c.id,page:t.current_page-1,search:u}),preserveState:!0,only:["ledgers"],children:e.jsx(I,{})}):e.jsx("div",{className:"text-gray-300",children:e.jsx(I,{})})}),e.jsxs("div",{className:"my-auto",children:[t.current_page,"/",t.last_page]}),e.jsx("div",{className:"my-auto",children:t.links[t.links.length-1].url?e.jsx(x,{href:route("cashflow.saving.ledger",{organization:c.id,page:t.current_page+1,search:u}),only:["ledgers"],preserveState:!0,children:e.jsx(E,{})}):e.jsx("div",{className:"text-gray-300",children:e.jsx(E,{})})})]})]}),e.jsx("div",{className:"sm:flex hidden gap-5",children:e.jsx("div",{className:"w-full",children:e.jsx(De,{children:e.jsxs("table",{className:"table table-pin-rows table-pin-cols text-base",children:[e.jsx("thead",{className:"text-base text-gray-900",children:e.jsxs("tr",{className:"",children:[e.jsx("th",{className:"bg-gray-200",children:"Tanggal"}),e.jsx("th",{className:"bg-gray-200",children:"No. Ref"}),e.jsx("th",{className:"bg-gray-200",children:"Rekening"}),e.jsx("th",{className:"bg-gray-200 text-end",children:"Jumlah"}),e.jsx("th",{className:"bg-gray-200"})]})}),e.jsx("tbody",{children:t.data.map((a,l)=>e.jsx(Ee,{ledger:a,className:`${l%2==0&&"bg-gray-100"}`,handleDelete:()=>K(a),handleEdit:()=>Y(a),role:v},l))})]})})})})]}),e.jsx(J,{show:se,onClose:()=>p(!1),children:e.jsxs("form",{onSubmit:ue,className:"p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 border-b-2 py-1",children:L.title}),e.jsxs("div",{className:"mt-5 space-y-5",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row w-full gap-1",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(_,{htmlFor:"date",value:"Tanggal",className:"mx-auto my-auto"})}),e.jsxs("div",{className:"sm:w-2/3 w-full",children:[e.jsx(fe,{value:m,onChange:re,inputClassName:(s==null?void 0:s.date)&&"border-red-500 rounded-lg",useRange:!1,asSingle:!0,placeholder:"Tanggal",id:"date",displayFormat:"MMMM DD, YYYY"}),s&&s.date&&e.jsx("div",{className:"-mb-3",children:e.jsx("div",{className:"text-xs text-red-500",children:s.date})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row w-full gap-1",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(_,{htmlFor:"no_ref",value:"No. Ref",className:"mx-auto my-auto"})}),e.jsxs("div",{className:"sm:w-2/3 w-full",children:[e.jsx(U,{id:"no_ref",type:"text",name:"no_ref",value:i.no_ref,className:`mt-1 w-full ${s&&s.no_ref&&"border-red-500"}`,isFocused:!0,onChange:a=>r("no_ref",a.target.value.toUpperCase()),placeholder:"No. Ref"}),s&&s.no_ref&&e.jsx("div",{className:"-mb-3",children:e.jsx("div",{className:"text-xs text-red-500",children:s.no_ref})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row w-full gap-1",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(_,{htmlFor:"description",value:"Deskripsi",className:"mx-auto my-auto"})}),e.jsxs("div",{className:"sm:w-2/3 w-full",children:[e.jsx(U,{id:"description",type:"text",name:"description",value:i.description,className:`mt-1 w-full ${s&&s.description&&"border-red-500"}`,isFocused:!0,onChange:a=>r("description",a.target.value.toUpperCase()),placeholder:"Deskripsi"}),s&&s.description&&e.jsx("div",{className:"-mb-3",children:e.jsx("div",{className:"text-xs text-red-500",children:s.description})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row w-full gap-1",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(_,{htmlFor:"balance_id",value:"Kontak",className:"mx-auto my-auto"})}),e.jsxs("div",{className:"sm:w-2/3 w-full",children:[H?e.jsx("div",{className:"border px-3 py-2 rounded-lg",children:f.no_ref}):e.jsx(Be,{resources:A,selected:f,setSelected:a=>oe(a),maxHeight:"max-h-40",placeholder:"Cari Kontak",isError:!!s.contact_id,id:"contact",notFound:e.jsxs("span",{children:["Tidak Ada Data. ",e.jsx(x,{className:"font-bold text-blue-600",href:route("data-master.contact.create",{organization:c.id}),children:"Buat Baru ?"})]})}),f.id&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("div",{children:["Nama: ",e.jsx("span",{className:"font-bold",children:f.name})]}),e.jsxs("div",{children:["Sisa Saldo: ",e.jsxs("span",{className:"text-green-700 font-bold",children:["IDR. ",Me(f.balance_value)]})]})]}),s&&s.balance_id&&e.jsx("div",{className:"-mb-3",children:e.jsx("div",{className:"text-xs text-red-500",children:"Silakan isi kontak"})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row w-full gap-1",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(_,{htmlFor:"value",value:"Jumlah",className:"mx-auto my-auto"})}),e.jsxs("div",{className:"sm:w-2/3 w-full",children:[e.jsx(Ae,{value:i.value,customInput:U,onValueChange:a=>ce(a),thousandSeparator:!0,className:`text-end w-full border ${s.value?"border-red-500":""}`,prefix:"IDR ",id:"value"}),s&&s.value&&e.jsx("div",{className:"-mb-3",children:e.jsx("div",{className:"text-xs text-red-500",children:s.value})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row w-full gap-1",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(_,{htmlFor:"value",value:"Akun Kas",className:"mx-auto my-auto"})}),e.jsxs("div",{className:"sm:w-2/3 w-full",children:[e.jsx(Oe,{resources:R,selected:ae,setSelected:a=>de(a),maxHeight:"max-h-40",placeholder:"Cari Akun",isError:!!s.cash_account_id,id:"account",contactFilter:""}),s&&s.cash_account_id&&e.jsx("div",{className:"-mb-3",children:e.jsx("div",{className:"text-xs text-red-500",children:s.cash_account_id})})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end",children:[e.jsx(q,{onClick:a=>p(!1),children:"Batal"}),i.balance_id&&i.no_ref&&i.date&&i.cash_account_id&&i.value>0&&e.jsx(we,{className:"ms-3",disabled:D,children:L.submit})]})]})]})}),e.jsx(J,{show:te,onClose:()=>T(!1),children:e.jsxs("form",{onSubmit:me,className:"p-6",id:"delete-confirmation",name:"delete-confirmation",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 text-center",children:e.jsxs("div",{children:["Hapus Data Simpanan ",i==null?void 0:i.no_ref,"?"]})}),e.jsxs("div",{className:"mt-6 flex justify-end",children:[e.jsx(q,{onClick:()=>T(!1),children:"Batal"}),e.jsx(Fe,{className:"ms-3",disabled:D,children:"Hapus"})]})]})})]})}ze.layout=t=>e.jsx(pe,{header:e.jsx(ve,{children:"Data Simpanan"}),children:t,user:t.props.auth.user,organization:t.props.organization,title:"Data Simpanan",backLink:e.jsx(x,{href:route("cashflow.saving",t.props.organization.id),children:e.jsx(ge,{})}),breadcrumbs:e.jsx("div",{className:"text-sm breadcrumbs",children:e.jsxs("ul",{children:[e.jsx("li",{className:"font-bold",children:e.jsx(x,{href:route("cashflow",t.props.organization.id),children:"Arus Kas"})}),e.jsx("li",{className:"font-bold",children:e.jsx(x,{href:route("cashflow.saving",t.props.organization.id),children:"Simpanan"})}),e.jsx("li",{children:"Tambah/Tarik Simpanan"})]})}),role:t.props.role});export{ze as default};

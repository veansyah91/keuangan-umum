import{r as p,m as z,S as P,j as e,L as U,$ as j}from"./app-aef41eca.js";import{D as H,A as Q}from"./AuthenticatedLayout-905ab386.js";import{H as q}from"./Header-254e6151.js";import{k as G,Q as v}from"./react-toastify.esm-ec23f08f.js";/* empty css                      */import{c as J}from"./index.esm-8e56d419.js";import{F as W}from"./FormInput-7eb1d7ef.js";import{I as x}from"./InputLabel-09c9c962.js";import{T as w}from"./TextInput-0f4f9ffc.js";import{S as X}from"./SecondaryButton-669ef098.js";import{P as Z}from"./PrimaryButton-2671d8c0.js";import{d as N}from"./dayjs.min-241ae6cd.js";import{s as S}from"./studyYear-7a7865a2.js";import{C as ee}from"./StudentSelectInput-d827a326.js";import{N as ae}from"./react-number-format.es-1a596a76.js";import{f as te}from"./formatNumber-b542c689.js";import{a as le,u as se}from"./index.module-1ab15072.js";import"./ApplicationLogo-af080d56.js";import"./iconBase-4cdc82a0.js";import"./transition-ade245dd.js";import"./combobox-d5d5103d.js";import"./portal-99a8cb71.js";const ne=()=>{const s=N().year(),d=s-10;let f=[];for(let u=d;u<s+1;u++)f=[...f,u];return f},de=()=>{let s=[];for(let d=7;d<13;d++)s=[...s,d];for(let d=1;d<7;d++)s=[...s,d];return s},D=()=>N().format("MM");function me({organization:s,newRef:d,contacts:f,date:u,categories:I,studyYears:oe,lastPayment:ie,selectedContactParam:m}){const[T,b]=p.useState(0),{data:n,setData:i,processing:Y,post:C,errors:t,setError:re,reset:ue}=z({contact_id:m?m.id:null,date:u,level:m?m.last_level.level:"",student_id:m?m.student.no_ref:"",no_ref:d,value:T,month:parseInt(D()),study_year:S(),description:"",debit_account:null,details:[]}),[F,g]=p.useState({id:m?m.id:null,name:m?m.name:"",phone:m?m.phone:""}),[h,R]=p.useState({startDate:u,endDate:u}),[E]=le(h,500),B=se(h);p.useEffect(()=>{_(d)},[]),p.useEffect(()=>{B!==void 0&&h.startDate&&M()},[E]);const _=a=>{let l=n,r=I.map(c=>({id:c.id,name:c.name,value:c.value})),o=r.reduce((c,y)=>c+y.value,0);b(o),l={...l,value:o,details:r,date:u,no_ref:a,month:parseInt(D()),study_year:S(),description:"",debit_account:null},i(l)},M=a=>{P.reload({only:["newRef"],data:{date:N(h.startDate).format("YYYY-MM-DD")},onSuccess:({props:l})=>{const{newRef:r}=l;let o=n;o={...n,no_ref:r,date:a},i(o)},onError:l=>{console.log(l)}})},$=a=>{a.preventDefault(),C(route("cashflow.student-monthly-receivable.store",s.id),{onSuccess:({props:l})=>{const{flash:r,newRef:o}=l;v.success(r.success,{position:v.POSITION.TOP_CENTER}),g({id:null,name:"",phone:""}),setSelectedAccount({id:null,name:"",code:"",is_cash:!1}),_(o)},onError:l=>{console.log(l),v.error(l.error,{position:v.POSITION.TOP_CENTER})},preserveScroll:!1})},A=a=>{if(a){g({id:a.id,name:a.name,phone:a.phone});let l=n;l={...l,contact_id:a.id,description:`Piutang Iuran Bulanan dari ${a.name.toUpperCase()}`,student_id:a.student.no_ref,level:a.last_level.level},i(l)}},L=a=>{R(a),i("date",N(a.startDate).format("YYYY-MM-DD"))},O=(a,l)=>{const{value:r}=a;let o=[...n.details];o[l]={...o[l],value:parseInt(r)};let c=o.reduce((y,V)=>y+V.value,0);b(c),i({...n,details:o,value:c})},k=a=>{i("study_year",a.target.value)},K=a=>{i("month",parseInt(a.target.value))};return e.jsxs(e.Fragment,{children:[e.jsx(U,{title:"Tambah Piutang Iuran Bulanan Siswa"}),e.jsx(G,{}),e.jsx(W,{onSubmit:$,children:e.jsx("div",{className:"w-full md:mt-2 md:py-5",children:e.jsxs("div",{className:"md:w-1/2 md:mx-auto px-3 md:px-0",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(x,{value:"No. Ref",htmlFor:"no_ref",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx(w,{id:"no_ref",name:"no_ref",className:`w-full ${(t==null?void 0:t.no_ref)&&"border-red-500"}`,placeholder:"No. Ref",value:n.no_ref||"",onChange:a=>i("no_ref",a.target.value.toUpperCase()),disabled:!0}),(t==null?void 0:t.no_ref)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.no_ref})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(x,{value:"Tanggal Input",htmlFor:"date",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx("div",{children:e.jsx(H,{value:h,onChange:L,inputClassName:(t==null?void 0:t.date)&&"border-red-500 rounded-lg",useRange:!1,asSingle:!0,placeholder:"Tanggal",id:"date",displayFormat:"MMMM DD, YYYY"})}),(t==null?void 0:t.date)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.date})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(x,{value:"Nama Siswa",htmlFor:"name",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx(ee,{resources:f,selected:F,setSelected:a=>A(a),maxHeight:"max-h-40",placeholder:"Cari Kontak",isError:!!t.contact_id,id:"name",notFound:e.jsxs("span",{children:["Tidak Ada Data. ",e.jsx(j,{className:"font-bold text-blue-600",href:route("data-master.students.create",{organization:s.id}),children:"Buat Baru ?"})]})}),(t==null?void 0:t.name)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.name})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(x,{value:"No. Siswa",htmlFor:"student_id",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx(w,{id:"student_id",name:"student_id",className:`w-full ${(t==null?void 0:t.student_id)&&"border-red-500"}`,placeholder:"No. Siswa",value:n.student_id||"",onChange:a=>i("student_id",a.target.value.toUpperCase()),disabled:!0}),(t==null?void 0:t.student_id)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.student_id})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(x,{value:"Kelas",htmlFor:"level",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx(w,{id:"level",name:"level",className:`w-full ${(t==null?void 0:t.level)&&"border-red-500"}`,placeholder:"Kelas",value:n.level||"",onChange:a=>i("level",a.target.value.toUpperCase()),disabled:!0}),(t==null?void 0:t.level)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.level})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(x,{value:"Tahun Ajaran",htmlFor:"study_year",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx("select",{className:"select select-bordered w-full",value:n.study_year,onChange:k,id:"study_year",children:ne().map((a,l)=>e.jsxs("option",{value:`${a.toString()}/${(a+1).toString()}`,children:[a.toString(),"/",(a+1).toString()]},l))}),(t==null?void 0:t.study_year)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.study_year})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(x,{value:"Bulan",htmlFor:"month",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx("select",{className:"select select-bordered w-full",value:n.month,onChange:K,id:"month",children:de().map((a,l)=>e.jsx("option",{value:a,children:a},l))}),(t==null?void 0:t.month)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.month})]})]}),e.jsx("div",{className:"text-center mt-5 font-bold",children:"Rincian Pembayaran"}),n.details.map((a,l)=>e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(x,{value:a.name,htmlFor:`category-${l}`,className:" mx-auto my-auto"})}),e.jsx("div",{className:"w-full md:w-2/3",children:e.jsx(ae,{value:a.value,customInput:w,onValueChange:r=>O(r,l),thousandSeparator:!0,className:"text-end w-full border",prefix:"IDR ",id:`category-${l}`})})]},l)),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 pt-5 md:mt-2 font-bold text-xl",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:"TOTAL"}),e.jsxs("div",{className:"w-full md:w-2/3 text-end",children:["Rp. ",te(n.value)]})]}),e.jsxs("div",{className:"flex justify-end flex-col-reverse md:flex-row gap-2 mt-5",children:[e.jsx("div",{className:"w-full md:w-1/6 my-auto text-center",children:e.jsx(j,{href:route("cashflow.student-monthly-receivable",s.id),children:e.jsx(X,{className:"w-full",children:e.jsx("div",{className:"text-center w-full",children:"Kembali"})})})}),e.jsx("div",{className:"w-full md:w-1/6 text-center",children:e.jsx(Z,{className:"w-full",disabled:Y,children:e.jsx("div",{className:"text-center w-full",children:"Simpan"})})})]})]})})})]})}me.layout=s=>e.jsx(Q,{header:e.jsx(q,{children:"Tambah Piutang Iuran Bulanan Siswa"}),children:s,user:s.props.auth.user,organization:s.props.organization,title:"Tambah Piutang Iuran",backLink:e.jsx(j,{href:route("cashflow.student-monthly-receivable",s.props.organization.id),children:e.jsx(J,{})}),breadcrumbs:e.jsx("div",{className:"text-sm breadcrumbs",children:e.jsxs("ul",{children:[e.jsx("li",{className:"font-bold",children:e.jsx(j,{href:route("cashflow",s.props.organization.id),children:"Arus Kas"})}),e.jsx("li",{className:"font-bold",children:e.jsx(j,{href:route("cashflow.student-monthly-receivable",s.props.organization.id),children:"Piutang Iuran Bulanan Siswa"})}),e.jsx("li",{children:"Tambah Piutang Iuran Bulanan Siswa"})]})}),role:s.props.role});export{me as default};

import{r as f,W as U,j as e,Y as V,a as v,y as Q}from"./app-494cfc61.js";import{D as W,A as q}from"./AuthenticatedLayout-11623ec7.js";import{H as G}from"./Header-f0cecfae.js";import{k as J,Q as p}from"./react-toastify.esm-84bbabca.js";/* empty css                      */import{c as X}from"./index.esm-15ebc599.js";import{F as Z}from"./FormInput-34e73001.js";import{I as c}from"./InputLabel-d153d7a7.js";import{T as j}from"./TextInput-cd5e0c42.js";import{S as ee}from"./SecondaryButton-f564c527.js";import{P as ae}from"./PrimaryButton-1101559c.js";import{d as I}from"./dayjs.min-a7f5d384.js";import{s as S}from"./studyYear-26fb3540.js";import{C as te}from"./StudentSelectInput-a46ba459.js";import{N as le}from"./react-number-format.es-0cca0452.js";import{f as se}from"./formatNumber-b542c689.js";import{C as ne}from"./ClientSelectInput-94d3c88c.js";import"./ApplicationLogo-baa2e923.js";import"./iconBase-24f1c908.js";import"./transition-c5d5c5d7.js";import"./index.module-93da3f5c.js";import"./combobox-c22eee29.js";import"./keyboard-c60468bf.js";const de=()=>{const s=I().year(),d=s-10;let x=[];for(let r=d;r<s+1;r++)x=[...x,r];return x},me=()=>{let s=[];for(let d=7;d<13;d++)s=[...s,d];for(let d=1;d<7;d++)s=[...s,d];return s},C=()=>I().format("MM");function oe({organization:s,newRef:d,contacts:x,date:r,categories:T,studyYears:ie,accounts:D,lastPayment:ce}){const[F,N]=f.useState(0),{data:n,setData:o,processing:P,post:R,errors:t,setError:E,reset:re}=U({contact_id:null,date:r,level:"",student_id:"",no_ref:d,value:F,month:parseInt(C()),study_year:S(),description:"",credit_account:null,details:[]}),[A,y]=f.useState({id:null,name:"",phone:""}),[h,g]=f.useState({id:null,name:"",code:"",is_cash:!1}),[_,B]=f.useState({startDate:r,endDate:r});f.useEffect(()=>{b(d)},[]);const b=a=>{let l=n,i=T.map(u=>({id:u.id,name:u.name,value:u.value})),m=i.reduce((u,w)=>u+w.value,0);N(m),l={...l,value:m,details:i,contact_id:null,date:r,level:"",student_id:"",no_ref:a,month:parseInt(C()),study_year:S(),description:"",credit_account:null},o(l)},Y=a=>{Q.reload({only:["newRef"],data:{date:_.startDate},onSuccess:({props:l})=>{const{newRef:i}=l;let m=n;m={...n,no_ref:i,date:a},o(m)}})},k=a=>{a.preventDefault(),R(route("cashflow.student-monthly-receivable.store",s.id),{onSuccess:({props:l})=>{const{flash:i,newRef:m}=l;p.success(i.success,{position:p.POSITION.TOP_CENTER}),y({id:null,name:"",phone:""}),g({id:null,name:"",code:"",is_cash:!1}),b(m)},onError:l=>{console.log(l),p.error(l.error,{position:p.POSITION.TOP_CENTER})},preserveScroll:!1})},O=a=>{y({id:a.id,name:a.name,phone:a.phone});let l=n;l={...l,contact_id:a.id,description:`Piutang Iuran Bulanan dari ${a.name.toUpperCase()}`,student_id:a.student.no_ref,level:a.levels[a.levels.length-1].level},o(l)},$=a=>{B(a),o("date",a.startDate),Y(a.startDate)},K=(a,l)=>{const{value:i}=a;let m=[...n.details];m[l]={...m[l],value:parseInt(i)};let u=m.reduce((w,H)=>w+H.value,0);N(u),o({...n,details:m,value:u})},M=a=>{o("study_year",a.target.value)},L=a=>{o("month",parseInt(a.target.value))},z=a=>{g({id:a.id,name:a.name,code:a.code,is_cash:!1}),o("credit_account",a.id),E("credit_account","")};return e.jsxs(e.Fragment,{children:[e.jsx(V,{title:"Tambah Piutang Iuran Bulanan Siswa"}),e.jsx(J,{}),e.jsx(Z,{onSubmit:k,children:e.jsx("div",{className:"w-full md:mt-2 md:py-5",children:e.jsxs("div",{className:"md:w-1/2 md:mx-auto px-3 md:px-0",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(c,{value:"No. Ref",htmlFor:"no_ref",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx(j,{id:"no_ref",name:"no_ref",className:`w-full ${(t==null?void 0:t.no_ref)&&"border-red-500"}`,placeholder:"No. Ref",value:n.no_ref||"",onChange:a=>o("no_ref",a.target.value.toUpperCase()),disabled:!0}),(t==null?void 0:t.no_ref)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.no_ref})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(c,{value:"Tanggal Input",htmlFor:"date",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx("div",{children:e.jsx(W,{value:_,onChange:$,inputClassName:(t==null?void 0:t.date)&&"border-red-500 rounded-lg",useRange:!1,asSingle:!0,placeholder:"Tanggal",id:"date",displayFormat:"MMMM DD, YYYY"})}),(t==null?void 0:t.date)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.date})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(c,{value:"Nama Siswa",htmlFor:"name",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx(te,{resources:x,selected:A,setSelected:a=>O(a),maxHeight:"max-h-40",placeholder:"Cari Kontak",isError:!!t.contact_id,id:"name"}),(t==null?void 0:t.name)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.name})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(c,{value:"No. Siswa",htmlFor:"student_id",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx(j,{id:"student_id",name:"student_id",className:`w-full ${(t==null?void 0:t.student_id)&&"border-red-500"}`,placeholder:"No. Siswa",value:n.student_id||"",onChange:a=>o("student_id",a.target.value.toUpperCase()),disabled:!0}),(t==null?void 0:t.student_id)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.student_id})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(c,{value:"Kelas",htmlFor:"level",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx(j,{id:"level",name:"level",className:`w-full ${(t==null?void 0:t.level)&&"border-red-500"}`,placeholder:"Kelas",value:n.level||"",onChange:a=>o("level",a.target.value.toUpperCase()),disabled:!0}),(t==null?void 0:t.level)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.level})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(c,{value:"Tahun Ajaran",htmlFor:"study_year",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx("select",{className:"select select-bordered w-full",value:n.study_year,onChange:M,id:"study_year",children:de().map((a,l)=>e.jsxs("option",{value:`${a.toString()}/${(a+1).toString()}`,children:[a.toString(),"/",(a+1).toString()]},l))}),(t==null?void 0:t.study_year)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.study_year})]})]}),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(c,{value:"Bulan",htmlFor:"month",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full md:w-2/3",children:[e.jsx("select",{className:"select select-bordered w-full",value:n.month,onChange:L,id:"month",children:me().map((a,l)=>e.jsx("option",{value:a,children:a},l))}),(t==null?void 0:t.month)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.month})]})]}),e.jsx("div",{className:"text-center mt-5 font-bold",children:"Rincian Pembayaran"}),n.details.map((a,l)=>e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 md:mt-2",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:e.jsx(c,{value:a.name,htmlFor:`category-${l}`,className:" mx-auto my-auto"})}),e.jsx("div",{className:"w-full md:w-2/3",children:e.jsx(le,{value:a.value,customInput:j,onValueChange:i=>K(i,l),thousandSeparator:!0,className:"text-end w-full border",prefix:"IDR ",id:`category-${l}`})})]},l)),e.jsxs("div",{className:"flex flex-col md:flex-row justify-between gap-1 mt-5 pt-5 md:mt-2 font-bold text-xl",children:[e.jsx("div",{className:"w-full md:w-1/3 my-auto",children:"TOTAL"}),e.jsxs("div",{className:"w-full md:w-2/3 text-end",children:["Rp. ",se(n.value)]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(c,{value:"Akun Kredit",htmlFor:"account",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(ne,{resources:D,selected:h,setSelected:a=>z(a),maxHeight:"max-h-40",placeholder:"Cari Akun",isError:!!t.cash_account_id,id:"account",contactFilter:""}),(h==null?void 0:h.code)&&e.jsxs("div",{className:"absolute text-xs",children:["Kode: ",h.code]}),(t==null?void 0:t.cash_account_id)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.cash_account_id})]})]}),e.jsxs("div",{className:"flex justify-end flex-col-reverse md:flex-row gap-2 mt-5",children:[e.jsx("div",{className:"w-full md:w-1/6 my-auto text-center",children:e.jsx(v,{href:route("cashflow.student-monthly-receivable",s.id),children:e.jsx(ee,{className:"w-full",children:e.jsx("div",{className:"text-center w-full",children:"Kembali"})})})}),e.jsx("div",{className:"w-full md:w-1/6 text-center",children:e.jsx(ae,{className:"w-full",disabled:P,children:e.jsx("div",{className:"text-center w-full",children:"Simpan"})})})]})]})})})]})}oe.layout=s=>e.jsx(q,{header:e.jsx(G,{children:"Tambah Piutang Iuran Bulanan Siswa"}),children:s,user:s.props.auth.user,organization:s.props.organization,title:"Tambah Piutang Iuran",backLink:e.jsx(v,{href:route("cashflow.student-monthly-receivable",s.props.organization.id),children:e.jsx(X,{})}),breadcrumbs:e.jsx("div",{className:"text-sm breadcrumbs",children:e.jsxs("ul",{children:[e.jsx("li",{className:"font-bold",children:e.jsx(v,{href:route("cashflow",s.props.organization.id),children:"Arus Kas"})}),e.jsx("li",{className:"font-bold",children:e.jsx(v,{href:route("cashflow.student-monthly-receivable",s.props.organization.id),children:"Piutang Iuran Bulanan Siswa"})}),e.jsx("li",{children:"Tambah Piutang Iuran Bulanan Siswa"})]})}),role:s.props.role});export{oe as default};

import{r as w,W as G,j as e,Y as J,a as y,y as X}from"./app-4c9b9d8f.js";import{D as Z,A as ee}from"./AuthenticatedLayout-cff1daa6.js";import{H as ae}from"./Header-1753a219.js";import{k as te,Q as N}from"./react-toastify.esm-c7de312a.js";/* empty css                      */import{c as se}from"./index.esm-e12b5572.js";import{F as le}from"./FormInput-6ee7dd6f.js";import{I as c}from"./InputLabel-3681ec71.js";import{T as _}from"./TextInput-6923bb04.js";import{S as ne}from"./SecondaryButton-97cb500e.js";import{P as de}from"./PrimaryButton-52b62f77.js";import{d as C}from"./dayjs.min-4c7d6ab1.js";import"./studyYear-c2aadbaa.js";import{C as re}from"./StudentSelectInput-54b8d0bf.js";import{N as me}from"./react-number-format.es-a2d10304.js";import{f as oe}from"./formatNumber-b542c689.js";import{C as ie}from"./ClientSelectInput-41a0e645.js";import"./ApplicationLogo-092176f6.js";import"./iconBase-4df3593b.js";import"./transition-2d97653b.js";import"./index.module-5c2107c6.js";import"./combobox-b8de5ab4.js";import"./keyboard-7f2e30e3.js";const ue=()=>{let n=[];for(let u=7;u<13;u++)n=[...n,u];for(let u=1;u<7;u++)n=[...n,u];return n},P=()=>C().format("MM");function ce({organization:n,newRef:u,contacts:Y,date:he,categories:I,studyYears:$,cashAccounts:B,historyCategories:g,payment:o,contact:x,details:S,debitAccount:p}){const[xe,D]=w.useState(o.value),{data:l,setData:h,processing:F,patch:M,errors:t,setError:k,reset:fe}=G({contact_id:o.contact_id,date:o.date,level:x.last_level.level,student_id:x.student.no_ref,no_ref:o.no_ref,value:o.value,type:o.type,month:o.month,study_year:o.study_year,description:`Kas Masuk / Pembayaran Iuran Bulanan dari ${x.name.toUpperCase()} Bulan ${o.month}, Tahun Ajaran ${o.study_year}`,details:[],cash_account_id:p.id}),[j,E]=w.useState({id:x.id,name:x.name,phone:x.phone}),[v,K]=w.useState({id:p.id,name:p.name,code:p.code,is_cash:p.is_cash}),[U,A]=w.useState({startDate:o.date,endDate:o.date});w.useEffect(()=>{R()},[]);const b=(a,s=null)=>{X.reload({only:["historyCategories","historyPayment"],data:{selectedContact:s??j.id,month:a.month,studyYear:a.study_year},onSuccess:({props:d})=>{const{historyCategories:m,historyPayment:i}=d;let r=[];I.filter(f=>{let T=(m.length>0?[...m]:[...S]).filter(q=>q.student_payment_category_id==f.id);r=[...r,{id:f.id,name:f.name,value:T.length>0?T[0].value:f.value}]}),a={...a,no_ref:i?i.no_ref:u,details:r},h(a)}})},R=()=>{let a=l,s=[];I.filter((d,m)=>{let i=S.filter(r=>r.student_payment_category_id==d.id);s=[...s,{id:d.id,name:d.name,value:i.length>0?i[0].value:d.value}]}),a={...a,details:s},h(a)},O=a=>{a.preventDefault(),M(route("cashflow.student-monthly-payment.update",{organization:n.id,payment:o.id}),{onSuccess:({props:s})=>{const{flash:d}=s;N.success(d.success,{position:N.POSITION.TOP_CENTER})},onError:s=>{N.error(s.error,{position:N.POSITION.TOP_CENTER})},preserveScroll:!0})},z=a=>{E({id:a.id,name:a.name,phone:a.phone});let s=l;s={...s,contact_id:a.id,description:`Kas Masuk / Pembayaran Iuran Bulanan dari ${j.name.toUpperCase()} Bulan ${l.month}, Tahun Ajaran ${l.study_year}`,student_id:a.student.no_ref,level:a.levels[a.levels.length-1].level},b(s,a.id)},H=a=>{A(a),h("date",a.startDate)},L=(a,s)=>{const{value:d}=a;let m=[...l.details];m[s]={...m[s],value:parseInt(d)};let i=m.reduce((r,f)=>r+f.value,0);D(i),h({...l,details:m,value:i})},V=a=>{let s="now",d=parseInt(C().format("YYYY"))*100+parseInt(P()),m=a.target.value.split("/");(parseInt(l.month)<7?parseInt(m[1])*100+parseInt(l.month):m[0]*100+parseInt(l.month))>d&&(s="prepaid");let r=l;r={...r,study_year:a.target.value,description:`Kas Masuk / Pembayaran Iuran Bulanan dari ${j.name.toUpperCase()} Bulan ${l.month}, Tahun Ajaran ${a.target.value}`,type:s},b(r)},Q=a=>{let s="now",d=parseInt(C().format("YYYY"))*100+parseInt(P()),m=l.study_year.split("/");(parseInt(a.target.value)<7?parseInt(m[1])*100+parseInt(a.target.value):m[0]*100+parseInt(a.target.value))>d&&(s="prepaid");let r=l;r={...r,month:parseInt(a.target.value),description:`Kas Masuk / Pembayaran Iuran Bulanan dari ${j.name.toUpperCase()} Bulan ${parseInt(a.target.value)}, Tahun Ajaran ${l.study_year}`,type:s},b(r)},W=a=>{K({id:a.id,name:a.name,code:a.code,is_cash:!0}),h("cash_account_id",a.id),k("cash_account_id","")};return e.jsxs(e.Fragment,{children:[e.jsx(J,{title:"Piutang Iuran Bulanan Siswa"}),e.jsx(te,{}),e.jsx(le,{onSubmit:O,children:e.jsx("div",{className:"w-full sm:mt-2 sm:py-5",children:e.jsxs("div",{className:"sm:w-1/2 sm:mx-auto px-3 sm:px-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(c,{value:"No. Ref",htmlFor:"no_ref",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(_,{id:"no_ref",name:"no_ref",className:`w-full ${(t==null?void 0:t.no_ref)&&"border-red-500"}`,placeholder:"No. Ref",value:l.no_ref||"",onChange:a=>h("no_ref",a.target.value.toUpperCase()),disabled:!0}),(t==null?void 0:t.no_ref)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.no_ref})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(c,{value:"Tanggal",htmlFor:"date",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx("div",{children:e.jsx(Z,{value:U,onChange:H,inputClassName:(t==null?void 0:t.date)&&"border-red-500 rounded-lg",useRange:!1,asSingle:!0,placeholder:"Tanggal",inputId:"date",displayFormat:"MMMM DD, YYYY"})}),(t==null?void 0:t.date)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.date})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(c,{value:"Nama Siswa",htmlFor:"name",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(re,{resources:Y,selected:j,setSelected:a=>z(a),maxHeight:"max-h-40",placeholder:"Cari Kontak",isError:!!t.contact_id,id:"name",notFound:e.jsxs("span",{children:["Tidak Ada Data. ",e.jsx(y,{className:"font-bold text-blue-600",href:route("data-master.students.create",{organization:n.id}),children:"Buat Baru ?"})]})}),(t==null?void 0:t.name)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.name})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(c,{value:"No. Siswa",htmlFor:"student_id",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(_,{id:"student_id",name:"student_id",className:`w-full ${(t==null?void 0:t.student_id)&&"border-red-500"}`,placeholder:"No. Siswa",value:l.student_id||"",onChange:a=>h("student_id",a.target.value.toUpperCase()),disabled:!0}),(t==null?void 0:t.student_id)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.student_id})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(c,{value:"Kelas",htmlFor:"level",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(_,{id:"level",name:"level",className:`w-full ${(t==null?void 0:t.level)&&"border-red-500"}`,placeholder:"Kelas",value:l.level||"",onChange:a=>h("level",a.target.value.toUpperCase()),disabled:!0}),(t==null?void 0:t.level)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.level})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(c,{value:"Tahun Ajaran",htmlFor:"study_year",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx("select",{className:"select select-bordered w-full",value:l.study_year,onChange:V,id:"study_year",children:$.map((a,s)=>e.jsx("option",{children:a.year},s))}),(t==null?void 0:t.study_year)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.study_year})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(c,{value:"Bulan",htmlFor:"month",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx("select",{className:"select select-bordered w-full",value:l.month,onChange:Q,id:"month",children:ue().map((a,s)=>e.jsx("option",{children:a},s))}),(t==null?void 0:t.month)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.month})]})]}),e.jsx("div",{className:"text-center mt-5 font-bold",children:"Rincian Pembayaran"}),l.details.map((a,s)=>e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(c,{value:a.name,htmlFor:`category-${s}`,className:" mx-auto my-auto"})}),e.jsx("div",{className:"w-full sm:w-2/3",children:e.jsx(me,{value:a.value,customInput:_,onValueChange:d=>L(d,s),thousandSeparator:!0,className:"text-end w-full border",prefix:"IDR ",id:`category-${s}`,disabled:(g==null?void 0:g.length)>0})})]},s)),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 pt-5 sm:mt-2 font-bold text-xl",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:"TOTAL"}),e.jsxs("div",{className:"w-full sm:w-2/3 text-end",children:["Rp. ",oe(l.value)]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(c,{value:"Akun Kas",htmlFor:"account",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(ie,{resources:B,selected:v,setSelected:a=>W(a),maxHeight:"max-h-40",placeholder:"Cari Akun",isError:!!t.cash_account_id,id:"account",contactFilter:""}),(v==null?void 0:v.code)&&e.jsxs("div",{className:"absolute text-xs",children:["Kode: ",v.code]}),(t==null?void 0:t.cash_account_id)&&e.jsx("span",{className:"text-red-500 text-xs",children:t.cash_account_id})]})]}),e.jsxs("div",{className:"flex justify-end flex-col-reverse sm:flex-row gap-2 mt-5",children:[e.jsx("div",{className:"w-full sm:w-1/6 my-auto text-center",children:e.jsx(y,{href:route("cashflow.student-monthly-payment",n.id),children:e.jsx(ne,{className:"w-full",children:e.jsx("div",{className:"text-center w-full",children:"Kembali"})})})}),e.jsx("div",{className:"w-full sm:w-1/6 text-center",children:e.jsx(de,{className:"w-full",disabled:F,children:e.jsx("div",{className:"text-center w-full",children:"Ubah"})})})]})]})})})]})}ce.layout=n=>e.jsx(ee,{header:e.jsx(ae,{children:"Ubah Pembayaran"}),children:n,user:n.props.auth.user,organization:n.props.organization,title:"Ubah Pembayaran",backLink:e.jsx(y,{href:route("cashflow.student-monthly-payment",n.props.organization.id),children:e.jsx(se,{})}),breadcrumbs:e.jsx("div",{className:"text-sm breadcrumbs",children:e.jsxs("ul",{children:[e.jsx("li",{className:"font-bold",children:e.jsx(y,{href:route("cashflow",n.props.organization.id),children:"Arus Kas"})}),e.jsx("li",{className:"font-bold",children:e.jsx(y,{href:route("cashflow.student-monthly-payment",n.props.organization.id),children:"Pembayaran Iuran Bulanan Siswa"})}),e.jsx("li",{children:"Ubah Pembayaran"})]})}),role:n.props.role});export{ce as default};

import{r as o,S as C,j as e,m as pe,L as fe,$ as x}from"./app-e310aa01.js";import{D as ve,A as je}from"./AuthenticatedLayout-69c8267d.js";import{H as be}from"./Header-e91d9d17.js";import{k as Ne,Q as d}from"./react-toastify.esm-1fbb98bc.js";/* empty css                      */import{o as _e,p as ge,I,a as E,b as we,c as ye}from"./index.esm-d43a1de0.js";import{M as q}from"./Modal-e0243bed.js";import{S as W}from"./SecondaryButton-94e34b2f.js";import{P as Se}from"./PrimaryButton-5a931109.js";import{C as Ce}from"./ContainerDesktop-25dc8bb8.js";import{T as ke,a as De,P as Te,C as Ie}from"./ContentDesktop-dc3a4124.js";import{C as Ee}from"./ContentMobile-bc5712af.js";import Fe from"./SavingLedgerMobile-c69d49db.js";import Oe from"./SavingLedgerDesktop-4a6fffd3.js";import{I as g}from"./InputLabel-befcccbc.js";import{T as $}from"./TextInput-99d89a9a.js";import{C as Ae}from"./ClientSelectInput-deddca07.js";import{D as Re}from"./DangerButton-df5923aa.js";import{u as ee,a as ae}from"./index.module-6d257d70.js";import{a as X,b as Z}from"./index.esm-8a3a5dd4.js";import{H as S}from"./combobox-418cbed0.js";import{z as Me}from"./transition-dbb0fec3.js";import{N as Pe}from"./react-number-format.es-0daa2554.js";import{d as Be}from"./dayjs.min-0b1597b0.js";import{f as ze}from"./formatNumber-b542c689.js";import"./ApplicationLogo-874ab5e7.js";import"./iconBase-076ca044.js";import"./portal-abeed8eb.js";import"./close-provider-a657bad9.js";import"./index.esm-53c9eac9.js";function Ue({resources:t,selected:r,setSelected:f,maxHeight:F="max-h-60",placeholder:O,onCLick:A,isError:R=!0,id:h="",contactFilter:M="",notFound:p}){const[l,c]=o.useState(M),[k,P]=o.useState(t),s=ee(l),[v]=ae(l,500);o.useEffect(()=>{s!==void 0&&D()},[v]);const D=()=>{C.reload({only:["balances"],data:{contact:l},onSuccess:({props:i})=>{const{balances:u}=i;P(u)}})};return o.useEffect(()=>{c(r==null?void 0:r.name)},[r]),e.jsx(S,{value:r,onChange:f,children:e.jsxs("div",{className:"relative mt-1",children:[e.jsxs("div",{className:`relative w-full cursor-default rounded-md bg-white text-left border focus:outline-none focus-visible:ring-2 focus-visible:ring-white/75 focus-visible:ring-offset-2 focus-visible:ring-offset-teal-300 sm:text-sm ${R?"border-red-500":"border-gray-300"}`,children:[e.jsx(S.Input,{className:"w-full border-none py-3 pl-3 pr-10 leading-5 text-gray-800 focus:ring-0",displayValue:i=>i==null?void 0:i.no_ref.toUpperCase(),onChange:i=>c(i.target.value.toUpperCase()),placeholder:O,type:"search",id:h}),e.jsx(S.Button,{className:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-600 text-lg",onClick:A,children:e.jsx(_e,{})})]}),e.jsx(Me,{as:o.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx(S.Options,{className:`absolute mt-1 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black/5 focus:outline-none sm:text-sm ${F} z-10`,children:k.length===0&&l!==""?e.jsx("div",{className:"relative cursor-default select-none px-4 py-2 text-gray-700",children:p??"Tidak Ada Data"}):k.map(i=>e.jsx(S.Option,{className:({active:u})=>`relative flex cursor-default select-none py-2 pl-10 pr-4 ${u?"bg-teal-600 text-white":"text-slate-900"}`,value:i,children:({selected:u,active:B})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`block truncate ${u?"font-medium":"font-normal"}`,children:[e.jsxs("div",{className:"text-xs",children:["Kategori Simpanan: ",e.jsx("span",{className:"font-bold",children:i.saving_category.name.toUpperCase()})]}),e.jsxs("div",{className:"text-base",children:[i.student?`${i.student.no_ref?i.student.no_ref+"-":""}`:"",i.no_ref.toUpperCase()]}),e.jsx("div",{className:"text-xs",children:e.jsxs("span",{className:"text-[10px] font-bold",children:[i.contact.name," (",i.contact.contact_categories[0].name.toUpperCase(),")"]})})]}),u?e.jsx("div",{className:`absolute inset-y-0 left-0 flex items-center pl-3 ${B?"text-white":"text-teal-600"}`,children:e.jsx(ge,{className:"h-5 w-5","aria-hidden":"true"})}):null]})},i.id))})})]})})}function $e({ledgers:t,organization:r,role:f,newRefCredit:F,newRefDebit:O,querySearch:A,balances:R,date:h,cashAccounts:M,whatsappPlugin:p}){const{data:l,setData:c,post:k,patch:P,errors:s,setError:v,processing:D,reset:i,delete:u}=pe({id:null,balance_id:null,balance_value:0,value:0,type:"",date:h,description:"",no_ref:"",cash_account_id:null,send_wa:p||!1}),[B,se]=o.useState({startDate:h,endDate:h}),[j,b]=o.useState({id:null,name:"",no_ref:"",phone:"",balance_value:0}),[te,N]=o.useState({id:null,name:"",code:"",is_cash:!0}),[L,z]=o.useState({title:"Tambah Data Simpanan",submit:"Tambah"}),[le,_]=o.useState(!1),[ne,T]=o.useState(!1),[V,w]=o.useState(!1),[m,H]=o.useState(A||""),[ie]=ae(m,500),re=ee(m);o.useEffect(()=>{re!==void 0&&ce()},[ie]);const ce=()=>{C.reload({only:["ledgers"],data:{search:m},preserveState:!0})},U=()=>{C.reload({only:["balances"],data:{contact:""},preserveState:!0})},Y=a=>{z({title:(a.debit>0?"Tarik":"Tambah")+" Simpanan",submit:"Ubah"}),_(!0),w(!0),v({id:"",value:"",balance_id:"",balance_value:"",type:"",date:"",description:"",no_ref:"",cash_account_id:""}),c({id:a.id,value:a.debit>0?a.debit:a.credit,balance_id:a.saving_balance_id,balance_value:a.saving_balance.value,type:a.debit>0?"debit":"credit",date:a.date,description:a.description,no_ref:a.no_ref,cash_account_id:a.cash_account_id,send_wa:!1}),b({id:a.saving_balance.id,name:a.saving_balance.contact.name,no_ref:a.saving_balance.no_ref,phone:a.saving_balance.contact.phone,balance_value:a.saving_balance.value}),N({id:a.cash_account_id,name:a.cash_account.name,code:a.cash_account.code,is_cash:!0})},K=a=>{c("id",a.id),T(!0)},oe=a=>{se(a),c("date",Be(a.startDate).format("YYYY-MM-DD"))},de=a=>{const{floatValue:n}=a;c("value",n)},me=a=>{if(a){b({id:a.id,name:a.contact.name,phone:a.contact.phone,no_ref:a.no_ref,balance_value:a.value});let n={...l};n={...n,balance_id:a.id,balance_value:a.value,send_wa:!!(p&&a.contact.phone)},c(n)}},Q=()=>{v({id:"",value:"",balance_id:"",balance_value:"",type:"",date:"",description:"",no_ref:"",cash_account_id:""}),b({id:null,name:"",no_ref:"",phone:"",balance_value:0}),N({id:null,name:"",code:"",is_cash:!0}),_(!0),w(!1),z({title:"Tambah Simpanan",submit:"Tambah"}),c({id:null,no_ref:F,balance_value:0,balance_id:null,value:0,type:"credit",date:h,description:"SETOR TABUNGAN",cash_account_id:null,send_wa:p||!1})},G=()=>{v({id:"",value:"",balance_id:"",balance_value:"",type:"",date:"",description:"",no_ref:"",cash_account_id:""}),b({id:null,name:"",no_ref:"",phone:"",balance_value:0}),N({id:null,name:"",code:"",is_cash:!0}),_(!0),w(!1),z({title:"Tarik Simpanan",submit:"Tarik"}),c({id:null,no_ref:O,balance_value:0,balance_id:null,value:0,date:h,type:"debit",description:"TARIK TABUNGAN",cash_account_id:null,send_wa:p||!1})},J=()=>{_(!1),U()},ue=a=>{a&&(N({id:a.id,name:a.name,code:a.code,is_cash:!0}),c("cash_account_id",a.id),v("cash_account_id",""))},xe=a=>{a.preventDefault(),V?P(route("cashflow.saving.ledger.update",{organization:r.id,ledger:l.id}),{onSuccess:({props:n})=>{const{flash:y}=n;C.replace(window.location.pathname),d.success(y.success,{position:d.POSITION.TOP_CENTER}),U(),b({id:null,name:"",no_ref:"",phone:"",balance_value:0}),N({id:null,name:"",code:"",is_cash:!0}),_(!1),w(!1)},onError:n=>{d.error(n.error,{position:d.POSITION.TOP_CENTER})}}):k(route("cashflow.saving.ledger.store",{organization:r.id}),{onSuccess:({props:n})=>{const{flash:y}=n;C.replace(window.location.pathname),d.success(y.success,{position:d.POSITION.TOP_CENTER}),U(),b({id:null,name:"",no_ref:"",phone:"",balance_value:0}),N({id:null,name:"",code:"",is_cash:!0}),_(!1),w(!1)},onError:n=>{console.log(n)}})},he=a=>{a.preventDefault(),u(route("cashflow.saving.ledger.delete",{organization:r.id,ledger:l.id}),{onSuccess:({props:n})=>{const{flash:y}=n;d.success(y.success,{position:d.POSITION.TOP_CENTER}),T(!1)},onError:n=>{d.error(n.error,{position:d.POSITION.TOP_CENTER})}})};return e.jsxs(e.Fragment,{children:[e.jsx(fe,{title:"Tambah/Tarik Simpanan"}),e.jsx(Ne,{}),f!=="viewer"&&e.jsxs("div",{className:"md:hidden fixed bottom-2 w-full z-40 flex",children:[e.jsx("div",{className:"px-2",children:e.jsx("button",{type:"button",className:"btn bg-green-800 text-white w-full",onClick:Q,children:e.jsx("div",{className:"text-xl font-bold rotate-90",children:e.jsx(X,{})})})}),e.jsx("div",{className:"px-2",children:e.jsx("button",{type:"button",className:"btn bg-orange-800 text-white w-full",onClick:G,children:e.jsx("div",{className:"text-xl font-bold -rotate-90",children:e.jsx(Z,{})})})})]}),e.jsx(ke,{zIndex:"z-50",search:m,setSearch:a=>H(a.target.value),pageBefore:t.links[0].url?e.jsx(x,{href:route("cashflow.saving.ledger",{organization:r.id,page:t.current_page-1,search:m}),preserveState:!0,only:["ledgers"],children:e.jsx(I,{})}):e.jsx("div",{className:"text-gray-300",children:e.jsx(I,{})}),pageAfter:t.links[t.links.length-1].url?e.jsx(x,{href:route("cashflow.saving.ledger",{organization:r.id,page:t.current_page+1,search:m}),only:["ledgers"],preserveState:!0,children:e.jsx(E,{})}):e.jsx("div",{className:"text-gray-300",children:e.jsx(E,{})}),page:e.jsxs(e.Fragment,{children:[t.current_page,"/",t.last_page]}),data:t}),e.jsx(Ee,{children:t.data.map(a=>e.jsx(Fe,{ledger:a,handleDelete:()=>K(a),handleEdit:()=>Y(a),role:f},a.id))}),e.jsxs(Ce,{children:[e.jsxs(De,{children:[e.jsx("div",{className:"my-auto w-7/12",children:f!=="viewer"&&e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{onClick:Q,className:"bg-green-800 px-4 py-2 text-white border border-transparent rounded-md font-semibold",children:e.jsx("div",{className:"text-xl font-bold rotate-90",children:e.jsx(X,{})})}),e.jsx("button",{onClick:G,className:"bg-orange-800 px-4 py-2 text-white border border-transparent rounded-md font-semibold",children:e.jsx("div",{className:"text-xl font-bold -rotate-90",children:e.jsx(Z,{})})})]})}),e.jsxs("div",{className:"w-3/12 border flex rounded-lg",children:[e.jsx("label",{htmlFor:"search-input",className:"my-auto ml-2",children:e.jsx(we,{})}),e.jsx("input",{id:"search-input",name:"search-input",type:"search",placeholder:"Cari",className:"w-full border-none focus:outline-none focus:ring-0",value:m||"",onChange:a=>H(a.target.value)})]}),e.jsx("div",{className:"italic text-xs my-auto w-1/12 text-center",children:e.jsx(Te,{data:t})}),e.jsxs("div",{className:"my-auto flex space-x-2 w-1/12",children:[e.jsx("div",{className:"my-auto",children:t.links[0].url?e.jsx(x,{href:route("cashflow.saving.ledger",{organization:r.id,page:t.current_page-1,search:m}),preserveState:!0,only:["ledgers"],children:e.jsx(I,{})}):e.jsx("div",{className:"text-gray-300",children:e.jsx(I,{})})}),e.jsxs("div",{className:"my-auto",children:[t.current_page,"/",t.last_page]}),e.jsx("div",{className:"my-auto",children:t.links[t.links.length-1].url?e.jsx(x,{href:route("cashflow.saving.ledger",{organization:r.id,page:t.current_page+1,search:m}),only:["ledgers"],preserveState:!0,children:e.jsx(E,{})}):e.jsx("div",{className:"text-gray-300",children:e.jsx(E,{})})})]})]}),e.jsx("div",{className:"sm:flex hidden gap-5",children:e.jsx("div",{className:"w-full",children:e.jsx(Ie,{children:e.jsxs("table",{className:"table table-pin-rows table-pin-cols text-base",children:[e.jsx("thead",{className:"text-base text-gray-900",children:e.jsxs("tr",{className:"",children:[e.jsx("th",{className:"bg-gray-200",children:"Tanggal"}),e.jsx("th",{className:"bg-gray-200",children:"No. Ref"}),e.jsx("th",{className:"bg-gray-200",children:"Rekening"}),e.jsx("th",{className:"bg-gray-200 text-end",children:"Jumlah"}),e.jsx("th",{className:"bg-gray-200"})]})}),e.jsx("tbody",{children:t.data.map((a,n)=>e.jsx(Oe,{ledger:a,className:`${n%2==0&&"bg-gray-100"}`,handleDelete:()=>K(a),handleEdit:()=>Y(a),role:f},n))})]})})})})]}),e.jsx(q,{show:le,onClose:J,children:e.jsxs("form",{onSubmit:xe,className:"p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 border-b-2 py-1",children:L.title}),e.jsxs("div",{className:"mt-5 space-y-5",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row w-full gap-1",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(g,{htmlFor:"date",value:"Tanggal",className:"mx-auto my-auto"})}),e.jsxs("div",{className:"sm:w-2/3 w-full",children:[e.jsx(ve,{value:B,onChange:oe,inputClassName:(s==null?void 0:s.date)&&"border-red-500 rounded-lg",useRange:!1,asSingle:!0,placeholder:"Tanggal",id:"date",displayFormat:"MMMM DD, YYYY"}),s&&s.date&&e.jsx("div",{className:"-mb-3",children:e.jsx("div",{className:"text-xs text-red-500",children:s.date})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row w-full gap-1",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(g,{htmlFor:"no_ref",value:"No. Ref",className:"mx-auto my-auto"})}),e.jsxs("div",{className:"sm:w-2/3 w-full",children:[e.jsx($,{id:"no_ref",type:"text",name:"no_ref",value:l.no_ref,className:`mt-1 w-full ${s&&s.no_ref&&"border-red-500"}`,isFocused:!0,onChange:a=>c("no_ref",a.target.value.toUpperCase()),placeholder:"No. Ref"}),s&&s.no_ref&&e.jsx("div",{className:"-mb-3",children:e.jsx("div",{className:"text-xs text-red-500",children:s.no_ref})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row w-full gap-1",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(g,{htmlFor:"description",value:"Deskripsi",className:"mx-auto my-auto"})}),e.jsxs("div",{className:"sm:w-2/3 w-full",children:[e.jsx($,{id:"description",type:"text",name:"description",value:l.description,className:`mt-1 w-full ${s&&s.description&&"border-red-500"}`,isFocused:!0,onChange:a=>c("description",a.target.value.toUpperCase()),placeholder:"Deskripsi"}),s&&s.description&&e.jsx("div",{className:"-mb-3",children:e.jsx("div",{className:"text-xs text-red-500",children:s.description})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row w-full gap-1",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(g,{htmlFor:"balance_id",value:"Kontak",className:"mx-auto my-auto"})}),e.jsxs("div",{className:"sm:w-2/3 w-full",children:[V?e.jsx("div",{className:"border px-3 py-2 rounded-lg",children:j.no_ref}):e.jsx(Ue,{resources:R,selected:j,setSelected:a=>me(a),maxHeight:"max-h-40",placeholder:"Cari Kontak",isError:!!s.contact_id,id:"contact",notFound:e.jsxs("span",{children:["Tidak Ada Data. ",e.jsx(x,{className:"font-bold text-blue-600",href:route("data-master.contact.create",{organization:r.id}),children:"Buat Baru ?"})]})}),j.id&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("div",{children:["Nama: ",e.jsx("span",{className:"font-bold",children:j.name})]}),e.jsxs("div",{children:["Sisa Saldo: ",e.jsxs("span",{className:"text-green-700 font-bold",children:["IDR. ",ze(j.balance_value)]})]})]}),s&&s.balance_id&&e.jsx("div",{className:"-mb-3",children:e.jsx("div",{className:"text-xs text-red-500",children:"Silakan isi kontak"})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row w-full gap-1",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(g,{htmlFor:"value",value:"Jumlah",className:"mx-auto my-auto"})}),e.jsxs("div",{className:"sm:w-2/3 w-full",children:[e.jsx(Pe,{value:l.value,customInput:$,onValueChange:a=>de(a),thousandSeparator:!0,className:`text-end w-full border ${s.value?"border-red-500":""}`,prefix:"IDR ",id:"value"}),s&&s.value&&e.jsx("div",{className:"-mb-3",children:e.jsx("div",{className:"text-xs text-red-500",children:s.value})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row w-full gap-1",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(g,{htmlFor:"value",value:"Akun Kas",className:"mx-auto my-auto"})}),e.jsxs("div",{className:"sm:w-2/3 w-full",children:[e.jsx(Ae,{resources:M,selected:te,setSelected:a=>ue(a),maxHeight:"max-h-40",placeholder:"Cari Akun",isError:!!s.cash_account_id,id:"account",contactFilter:""}),s&&s.cash_account_id&&e.jsx("div",{className:"-mb-3",children:e.jsx("div",{className:"text-xs text-red-500",children:s.cash_account_id})})]})]}),p&&j.phone&&e.jsxs("div",{className:"md:w-1/3 w-2/3 mt-5",children:[e.jsx("div",{className:"form-control ",children:e.jsxs("label",{className:"label cursor-pointer",htmlFor:"send_wa",children:[e.jsx("input",{type:"checkbox",className:"checkbox",id:"send_wa",value:l.send_wa,onChange:()=>c("send_wa",!l.send_wa),checked:l.send_wa}),e.jsx("span",{className:"label-text",children:"Kirim Bukti Via WhatsApp"})]})}),s&&s.send_wa&&e.jsx("div",{className:"-mb-3",children:e.jsx("div",{className:"text-xs text-red-500",children:s.send_wa})})]}),e.jsxs("div",{className:"mt-6 flex justify-end",children:[e.jsx(W,{onClick:J,children:"Batal"}),l.balance_id&&l.no_ref&&l.date&&l.cash_account_id&&l.value>0&&e.jsx(Se,{className:"ms-3",disabled:D,children:L.submit})]})]})]})}),e.jsx(q,{show:ne,onClose:()=>T(!1),children:e.jsxs("form",{onSubmit:he,className:"p-6",id:"delete-confirmation",name:"delete-confirmation",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 text-center",children:e.jsxs("div",{children:["Hapus Data Simpanan ",l==null?void 0:l.no_ref,"?"]})}),e.jsxs("div",{className:"mt-6 flex justify-end",children:[e.jsx(W,{onClick:()=>T(!1),children:"Batal"}),e.jsx(Re,{className:"ms-3",disabled:D,children:"Hapus"})]})]})})]})}$e.layout=t=>e.jsx(je,{header:e.jsx(be,{children:"Data Simpanan"}),children:t,user:t.props.auth.user,organization:t.props.organization,title:"Data Simpanan",backLink:e.jsx(x,{href:route("cashflow.saving",t.props.organization.id),children:e.jsx(ye,{})}),breadcrumbs:e.jsx("div",{className:"text-sm breadcrumbs",children:e.jsxs("ul",{children:[e.jsx("li",{className:"font-bold",children:e.jsx(x,{href:route("cashflow",t.props.organization.id),children:"Arus Kas"})}),e.jsx("li",{className:"font-bold",children:e.jsx(x,{href:route("cashflow.saving",t.props.organization.id),children:"Simpanan"})}),e.jsx("li",{children:"Tambah/Tarik Simpanan"})]})}),role:t.props.role});export{$e as default};

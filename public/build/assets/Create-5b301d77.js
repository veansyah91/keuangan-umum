import{m as Q,r as h,S as W,j as e,L as q,$ as p}from"./app-c3de5fa6.js";import{D as G,A as X}from"./AuthenticatedLayout-2f82e08a.js";import{H as Z}from"./Header-ee160182.js";import{k as ee,Q as w}from"./react-toastify.esm-94b2ee7c.js";/* empty css                      */import{c as ae}from"./index.esm-234976fb.js";import{F as se}from"./FormInput-94d371de.js";import{I as r}from"./InputLabel-60badb3d.js";import{T as f}from"./TextInput-ebb8b1c3.js";import{S as le}from"./SecondaryButton-fcf7be1a.js";import{P as te}from"./PrimaryButton-02cc0a94.js";import{d as S}from"./dayjs.min-c211a108.js";import{s as C}from"./studyYear-f1139bb1.js";import{C as ne}from"./StudentSelectInput-d0fb1638.js";import{N as D}from"./react-number-format.es-5f43fc17.js";import{f as T}from"./formatNumber-b542c689.js";import{C as me}from"./ClientSelectInput-8df18255.js";import{a as de,u as re}from"./index.module-1bc829eb.js";import"./ApplicationLogo-33e039c9.js";import"./iconBase-23c1fa9a.js";import"./transition-294d1a88.js";import"./combobox-41255761.js";import"./portal-97852d2d.js";function ie({organization:m,newRef:N,contacts:I,date:j,categories:F,studyYears:R,cashAccounts:P,whatsappPlugin:y}){const{data:t,setData:n,processing:V,post:Y,errors:s,setError:k,reset:ce}=Q({contact_id:null,date:j,level:"",student_id:"",no_ref:N,value:0,paidValue:0,study_year:C(),description:"",details:[],cash_account_id:null,send_wa:y}),[o,_]=h.useState({id:null,name:"",phone:""}),[u,b]=h.useState({id:null,name:"",code:"",is_cash:!0}),[x,A]=h.useState({startDate:j,endDate:j}),[E]=de(x,500),$=re(x);h.useEffect(()=>{g(N)},[]),h.useEffect(()=>{$!==void 0&&x.startDate&&K()},[E]);const g=a=>{let l=t,d=F.map(c=>({id:c.id,name:c.name,value:c.value})),i=d.reduce((c,v)=>c+v.value,0);l={...l,value:i,paidValue:0,details:d,contact_id:null,date:j,level:"",student_id:"",no_ref:a,study_year:C(),description:"",cash_account_id:null,send_wa:!0},n(l)},K=()=>{W.reload({only:["newRef"],data:{date:S(x.startDate).format("YYYY-MM-DD")},onSuccess:a=>{n("no_ref",a.props.newRef)}})},M=a=>{a.preventDefault(),Y(route("cashflow.student-entry-payment.store",m.id),{only:["newRef","flash"],onSuccess:({props:l})=>{const{flash:d,newRef:i}=l;w.success(d.success,{position:w.POSITION.TOP_CENTER}),b({id:null,name:"",code:"",is_cash:!0}),_({id:null,name:"",phone:""}),g(i)},onError:l=>{w.error(l.error,{position:w.POSITION.TOP_CENTER})},preserveScroll:!1})},O=a=>{A(a),n("date",S(a.startDate).format("YYYY-MM-DD"))},B=a=>{var d;let l=t;l={...l,study_year:a.target.value,description:`Pembayaran Iuran Tahunan dari ${(d=o==null?void 0:o.name)==null?void 0:d.toUpperCase()}  Tahun Ajaran ${a.target.value}`},n(l)},L=a=>{if(a){_({id:a.id,name:a.name,phone:a.phone});let l=t;l={...l,contact_id:a.id,description:`Pembayaran Iuran Tahunan dari ${a.name.toUpperCase()} Tahun Ajaran ${t.study_year}`,student_id:a.student.no_ref,level:a.last_level.level},n(l)}},U=a=>{a&&(b({id:a.id,name:a.name,code:a.code,is_cash:!0}),n("cash_account_id",a.id),k("cash_account_id",""))},z=(a,l)=>{const{value:d}=a;let i=[...t.details];i[l]={...i[l],value:parseInt(d)};let c=i.reduce((v,J)=>v+J.value,0);n({...t,details:i,value:c})},H=a=>{const{value:l}=a;n("paidValue",parseInt(l)??0)};return e.jsxs(e.Fragment,{children:[e.jsx(q,{title:"Pembayaran Iuran Tahunan Siswa"}),e.jsx(ee,{}),e.jsx(se,{onSubmit:M,children:e.jsx("div",{className:"w-full sm:mt-2 sm:py-5",children:e.jsxs("div",{className:"sm:w-1/2 sm:mx-auto px-3 sm:px-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(r,{value:"No. Ref",htmlFor:"no_ref",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(f,{id:"no_ref",name:"no_ref",className:`w-full ${(s==null?void 0:s.no_ref)&&"border-red-500"}`,placeholder:"No. Ref",value:t.no_ref||"",onChange:a=>n("no_ref",a.target.value.toUpperCase())}),(s==null?void 0:s.no_ref)&&e.jsx("span",{className:"text-red-500 text-xs",children:s.no_ref})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(r,{value:"Tanggal",htmlFor:"date",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx("div",{children:e.jsx(G,{value:x,onChange:O,inputClassName:(s==null?void 0:s.date)&&"border-red-500 rounded-lg",useRange:!1,asSingle:!0,placeholder:"Tanggal",inputId:"date",displayFormat:"MMMM DD, YYYY"})}),(s==null?void 0:s.date)&&e.jsx("span",{className:"text-red-500 text-xs",children:s.date})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(r,{value:"Nama Siswa",htmlFor:"name",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(ne,{resources:I,selected:o,setSelected:a=>L(a),maxHeight:"max-h-40",placeholder:"Cari Kontak",isError:!!s.contact_id,id:"name",notFound:e.jsxs("span",{children:["Tidak Ada Data. ",e.jsx(p,{className:"font-bold text-blue-600",href:route("data-master.students.create",{organization:m.id}),children:"Buat Baru ?"})]})}),(s==null?void 0:s.name)&&e.jsx("span",{className:"text-red-500 text-xs",children:s.name})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(r,{value:"No. Siswa",htmlFor:"student_id",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(f,{id:"student_id",name:"student_id",className:`w-full ${(s==null?void 0:s.student_id)&&"border-red-500"}`,placeholder:"No. Siswa",value:t.student_id||"",onChange:a=>n("student_id",a.target.value.toUpperCase()),disabled:!0}),(s==null?void 0:s.student_id)&&e.jsx("span",{className:"text-red-500 text-xs",children:s.student_id})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(r,{value:"Kelas",htmlFor:"level",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(f,{id:"level",name:"level",className:`w-full ${(s==null?void 0:s.level)&&"border-red-500"}`,placeholder:"Kelas",value:t.level||"",onChange:a=>n("level",a.target.value.toUpperCase()),disabled:!0}),(s==null?void 0:s.level)&&e.jsx("span",{className:"text-red-500 text-xs",children:s.level})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(r,{value:"Tahun Ajaran",htmlFor:"study_year",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx("select",{className:"select select-bordered w-full",value:t.study_year,onChange:B,id:"study_year",children:R.map((a,l)=>e.jsx("option",{children:a.year},l))}),(s==null?void 0:s.study_year)&&e.jsx("span",{className:"text-red-500 text-xs",children:s.study_year})]})]}),e.jsx("div",{className:"text-center mt-5 font-bold",children:"Rincian Pembayaran"}),t.details.map((a,l)=>e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(r,{value:a.name,htmlFor:`category-${l}`,className:" mx-auto my-auto"})}),e.jsx("div",{className:"w-full sm:w-2/3",children:e.jsx(D,{value:a.value,customInput:f,onValueChange:d=>z(d,l),thousandSeparator:!0,className:"text-end w-full border",prefix:"IDR ",id:`category-${l}`})})]},l)),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 pt-5 sm:mt-2 font-bold text-xl",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:"TOTAL"}),e.jsxs("div",{className:"w-full sm:w-2/3 text-end",children:["Rp. ",T(t.value)]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(r,{value:"Jumlah Bayar",htmlFor:"paid-value",className:" mx-auto my-auto"})}),e.jsx("div",{className:"w-full sm:w-2/3",children:e.jsx(D,{value:t.paidValue,customInput:f,onValueChange:a=>H(a),thousandSeparator:!0,className:"text-end w-full border",prefix:"IDR ",id:"paid-value"})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:"Sisa"}),e.jsxs("div",{className:"w-full sm:w-2/3 text-end",children:["Rp. ",T(t.value-t.paidValue)]})]}),t.paidValue>0&&e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(r,{value:"Akun Kas",htmlFor:"account",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(me,{resources:P,selected:u,setSelected:a=>U(a),maxHeight:"max-h-40",placeholder:"Cari Akun",isError:!!s.cash_account_id,id:"account",contactFilter:""}),(u==null?void 0:u.code)&&e.jsxs("div",{className:"absolute text-xs",children:["Kode: ",u.code]}),(s==null?void 0:s.cash_account_id)&&e.jsx("span",{className:"text-red-500 text-xs",children:s.cash_account_id})]})]}),y&&o.phone&&e.jsxs("div",{className:"md:w-1/3 w-2/3 mt-5",children:[e.jsx("div",{className:"form-control ",children:e.jsxs("label",{className:"label cursor-pointer",htmlFor:"send_wa",children:[e.jsx("input",{type:"checkbox",className:"checkbox",id:"send_wa",value:t.send_wa,onChange:()=>n("send_wa",!t.send_wa),checked:t.send_wa}),e.jsx("span",{className:"label-text",children:"Kirim Bukti Via WhatsApp"})]})}),s&&s.send_wa&&e.jsx("div",{className:"-mb-3",children:e.jsx("div",{className:"text-xs text-red-500",children:s.send_wa})})]}),e.jsxs("div",{className:"flex justify-end flex-col-reverse sm:flex-row gap-2 mt-5",children:[e.jsx("div",{className:"w-full sm:w-1/6 my-auto text-center",children:e.jsx(p,{href:route("cashflow.student-entry-payment",m.id),children:e.jsx(le,{className:"w-full",children:e.jsx("div",{className:"text-center w-full",children:"Kembali"})})})}),t.value-t.paidValue>=0&&e.jsx("div",{className:"w-full sm:w-1/6 text-center",children:e.jsx(te,{className:"w-full",disabled:V,children:e.jsx("div",{className:"text-center w-full",children:"Simpan"})})})]})]})})})]})}ie.layout=m=>e.jsx(X,{header:e.jsx(Z,{children:"Tambah Pembayaran"}),children:m,user:m.props.auth.user,organization:m.props.organization,title:"Tambah Pembayaran",backLink:e.jsx(p,{href:route("cashflow.student-entry-payment",m.props.organization.id),children:e.jsx(ae,{})}),breadcrumbs:e.jsx("div",{className:"text-sm breadcrumbs",children:e.jsxs("ul",{children:[e.jsx("li",{className:"font-bold",children:e.jsx(p,{href:route("cashflow",m.props.organization.id),children:"Arus Kas"})}),e.jsx("li",{className:"font-bold",children:e.jsx(p,{href:route("cashflow.student-entry-payment",m.props.organization.id),children:"Pembayaran Iuran Tahunan Siswa"})}),e.jsx("li",{children:"Tambah Pembayaran"})]})}),role:m.props.role});export{ie as default};

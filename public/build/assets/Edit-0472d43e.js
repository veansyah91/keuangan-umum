import{W as L,r as c,y as g,j as e,Y as G,a as p}from"./app-b1bae4cf.js";import{D as J,A as W}from"./AuthenticatedLayout-5344e0b9.js";import{H as q}from"./Header-c0cfe33d.js";import{k as X,Q as w}from"./react-toastify.esm-f0fa79de.js";/* empty css                      */import{c as Z}from"./index.esm-cc030e73.js";import{F as Q}from"./FormInput-02984735.js";import{I as u}from"./InputLabel-7f7b4adc.js";import{T as N}from"./TextInput-03bbc330.js";import{S as ee}from"./SecondaryButton-d8ddebe6.js";import{P as ae}from"./PrimaryButton-8fd5a5e1.js";import{C as se}from"./StudentSelectInput-f35b12b9.js";import{N as te}from"./react-number-format.es-e3900a44.js";import{f as S}from"./formatNumber-b542c689.js";import{C as le}from"./ClientSelectInput-cdebcd65.js";import ne from"./ReceivableListBox-bc34ec05.js";import{o as ie,u as de}from"./index.module-5597c952.js";import{d as _}from"./dayjs.min-b8e970d9.js";import"./ApplicationLogo-4245bc52.js";import"./iconBase-d2085e51.js";import"./transition-26553514.js";import"./combobox-c84417da.js";import"./portal-962230a7.js";function re({organization:r,contacts:D,selectedContactQuery:t,cashAccounts:I,payments:n,receivablePayment:d,cashAccount:j}){const{data:i,setData:m,processing:T,patch:R,errors:s,setError:Y,reset:me}=L({contact_id:t?t.id:null,date:d.date,level:t?t.last_level.level:"",student_id:t?t.student.no_ref:"",no_ref:d.no_ref,value:n.length>0?n[0].receivable_value+d.credit:d.credit,paidValue:d.credit,description:t?`Pembayaran Piutang Iuran Tahunan Oleh ${t.name}`:"",payment_id:n.length>0?n[0].id:null,cash_account_id:j.id}),[v,F]=c.useState({id:t?t.id:null,name:t?t.name:"",phone:t?t.phone:""}),[f,E]=c.useState({id:j.id,name:j.name,code:j.code,is_cash:!0}),[h,y]=c.useState({id:n.length>0?n[0].id:null,noRef:n.length>0?n[0].no_ref:"",receivablevalue:n.length>0?n[0].receivable_value:0,studyYear:n.length>0?n[0].study_year:""}),[P,C]=c.useState(n),[x,V]=c.useState({startDate:d.date,endDate:d.date}),[O]=ie(x,500),$=de(x);c.useEffect(()=>{setTimeout(()=>{v.id&&A()},0)},[v]),c.useEffect(()=>{if($!==void 0&&x.startDate){let a=_(x.startDate),l=`${a.month()+1}-${a.year()}`,o=_(d.date),b=`${o.month()+1}-${o.year()}`;l!==b?k():m("no_ref",d.no_ref)}},[O]);const k=()=>{g.reload({only:["newRef"],data:{date:_(x.startDate).format("YYYY-MM-DD")},onSuccess:a=>{m("no_ref",a.props.newRef)}})},A=()=>{g.reload({only:["payments"],data:{selectedContact:v.id},onSuccess:({props:a})=>{const{payments:l}=a;let o=l.filter(b=>parseInt(b.id)===parseInt(d.payment_id));m("value",o[0].receivable_value+d.credit),C(l),y({id:o[0].id,noRef:o[0].no_ref,receivablevalue:o[0].receivable_value,studyYear:o[0].study_year})}})},M=a=>{a.preventDefault(),R(route("cashflow.student-entry-receivable-payment.update",{organization:r.id,receivablePayment:d}),{only:["flash"],onSuccess:({props:l})=>{const{flash:o}=l;w.success(o.success,{position:w.POSITION.TOP_CENTER})},onError:l=>{w.error(l.error,{position:w.POSITION.TOP_CENTER})},preserveScroll:!1})},U=a=>{V(a),m("date",_(a.startDate).format("YYYY-MM-DD"))},B=a=>{if(a){F({id:a.id,name:a.name,phone:a.phone});let l=i;l={...l,contact_id:a.id,description:`Pembayaran Piutang Iuran Tahunan dari ${a.name.toUpperCase()} Tahun Ajaran ${i.study_year}`,student_id:a.student.no_ref,level:a.last_level.level},m(l)}},K=a=>{a&&(E({id:a.id,name:a.name,code:a.code,is_cash:!0}),m("cash_account_id",a.id),Y("cash_account_id",""))},z=a=>{const{value:l}=a;m("paidValue",parseInt(l)??0)},H=a=>{a&&y({id:a.id,noRef:a.no_ref,receivablevalue:a.receivable_value,studyYear:a.study_year})};return e.jsxs(e.Fragment,{children:[e.jsx(G,{title:"Piutang Iuran Tahunan Siswa"}),e.jsx(X,{}),e.jsx(Q,{onSubmit:M,children:e.jsx("div",{className:"w-full sm:mt-2 sm:py-5",children:e.jsxs("div",{className:"sm:w-1/2 sm:mx-auto px-3 sm:px-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(u,{value:"No. Ref",htmlFor:"no_ref",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(N,{id:"no_ref",name:"no_ref",className:`w-full ${(s==null?void 0:s.no_ref)&&"border-red-500"}`,placeholder:"No. Ref",value:i.no_ref||"",onChange:a=>m("no_ref",a.target.value.toUpperCase())}),(s==null?void 0:s.no_ref)&&e.jsx("span",{className:"text-red-500 text-xs",children:s.no_ref})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(u,{value:"Tanggal",htmlFor:"date",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx("div",{children:e.jsx(J,{value:x,onChange:U,inputClassName:(s==null?void 0:s.date)&&"border-red-500 rounded-lg",useRange:!1,asSingle:!0,placeholder:"Tanggal",inputId:"date",displayFormat:"MMMM DD, YYYY"})}),(s==null?void 0:s.date)&&e.jsx("span",{className:"text-red-500 text-xs",children:s.date})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(u,{value:"Nama Siswa",htmlFor:"name",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(se,{resources:D,selected:v,setSelected:a=>B(a),maxHeight:"max-h-40",placeholder:"Cari Kontak",isError:!!s.contact_id,id:"name",notFound:e.jsxs("span",{children:["Tidak Ada Data. ",e.jsx(p,{className:"font-bold text-blue-600",href:route("data-master.students.create",{organization:r.id}),children:"Buat Baru ?"})]})}),(s==null?void 0:s.name)&&e.jsx("span",{className:"text-red-500 text-xs",children:s.name})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(u,{value:"No. Siswa",htmlFor:"student_id",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(N,{id:"student_id",name:"student_id",className:`w-full ${(s==null?void 0:s.student_id)&&"border-red-500"}`,placeholder:"No. Siswa",value:i.student_id||"",onChange:a=>m("student_id",a.target.value.toUpperCase()),disabled:!0}),(s==null?void 0:s.student_id)&&e.jsx("span",{className:"text-red-500 text-xs",children:s.student_id})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(u,{value:"Kelas",htmlFor:"level",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(N,{id:"level",name:"level",className:`w-full ${(s==null?void 0:s.level)&&"border-red-500"}`,placeholder:"Kelas",value:i.level||"",onChange:a=>m("level",a.target.value.toUpperCase()),disabled:!0}),(s==null?void 0:s.level)&&e.jsx("span",{className:"text-red-500 text-xs",children:s.level})]})]}),e.jsx("div",{className:"text-center mt-5 font-bold",children:"Rincian Pembayaran"}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(u,{value:"No Ref",htmlFor:"payment",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(ne,{id:"payment",payments:P,isError:!1,selected:h,setSelected:a=>H(a)}),(h==null?void 0:h.studyYear)&&e.jsxs("div",{className:"absolute text-xs",children:["Tahun Ajaran: ",h.studyYear]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 pt-5 sm:mt-2 font-bold text-xl",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:"TOTAL PIUTANG"}),e.jsxs("div",{className:"w-full sm:w-2/3 text-end",children:["Rp. ",S(i.value)]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(u,{value:"Jumlah Bayar",htmlFor:"paid-value",className:" mx-auto my-auto"})}),e.jsx("div",{className:"w-full sm:w-2/3",children:e.jsx(te,{value:i.paidValue,customInput:N,onValueChange:a=>z(a),thousandSeparator:!0,className:"text-end w-full border",prefix:"IDR ",id:"paid-value"})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:"Sisa"}),e.jsxs("div",{className:"w-full sm:w-2/3 text-end",children:["Rp. ",S(i.value-i.paidValue)]})]}),i.paidValue>0&&e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(u,{value:"Akun Kas",htmlFor:"account",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(le,{resources:I,selected:f,setSelected:a=>K(a),maxHeight:"max-h-40",placeholder:"Cari Akun",isError:!!s.cash_account_id,id:"account",contactFilter:""}),(f==null?void 0:f.code)&&e.jsxs("div",{className:"absolute text-xs",children:["Kode: ",f.code]}),(s==null?void 0:s.cash_account_id)&&e.jsx("span",{className:"text-red-500 text-xs",children:s.cash_account_id})]})]}),e.jsxs("div",{className:"flex justify-end flex-col-reverse sm:flex-row gap-2 mt-5",children:[e.jsx("div",{className:"w-full sm:w-1/6 my-auto text-center",children:e.jsx(p,{href:route("cashflow.student-entry-receivable-payment",r.id),children:e.jsx(ee,{className:"w-full",children:e.jsx("div",{className:"text-center w-full",children:"Kembali"})})})}),i.value-i.paidValue>=0&&i.cash_account_id&&e.jsx("div",{className:"w-full sm:w-1/6 text-center",children:e.jsx(ae,{className:"w-full",disabled:T,children:e.jsx("div",{className:"text-center w-full",children:"Simpan"})})})]})]})})})]})}re.layout=r=>e.jsx(W,{header:e.jsx(q,{children:"Ubah Pembayaran"}),children:r,user:r.props.auth.user,organization:r.props.organization,title:"Ubah Pembayaran",backLink:e.jsx(p,{href:route("cashflow.student-entry-receivable-payment",r.props.organization.id),children:e.jsx(Z,{})}),breadcrumbs:e.jsx("div",{className:"text-sm breadcrumbs",children:e.jsxs("ul",{children:[e.jsx("li",{className:"font-bold",children:e.jsx(p,{href:route("cashflow",r.props.organization.id),children:"Arus Kas"})}),e.jsx("li",{className:"font-bold",children:e.jsx(p,{href:route("cashflow.student-entry-receivable-payment",r.props.organization.id),children:"Pembayaran Iuran Tahunan Siswa"})}),e.jsx("li",{children:"Ubah Pembayaran"})]})}),role:r.props.role});export{re as default};

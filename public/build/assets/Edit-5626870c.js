import{r as d,W as je,y as ve,j as e,Y as Ne,a as T}from"./app-ad4257d5.js";import{D as be,A as we}from"./AuthenticatedLayout-d335000d.js";import{H as ge}from"./Header-f91aa4a0.js";import{F as De}from"./FormInput-ba7dde2c.js";import{I as v}from"./InputLabel-b46afe51.js";import{C as E}from"./ClientSelectInput-014da62a.js";import{T as I}from"./TextInput-d4fc5d93.js";import{t as k,u as ye,m as Se,c as _e}from"./index.esm-c0a97de4.js";import{N as M}from"./react-number-format.es-dde96bb5.js";import{k as Ee,Q as C}from"./react-toastify.esm-78ca1e04.js";import{f as U}from"./formatNumber-b542c689.js";import{o as Ie,u as ke}from"./index.module-411b404b.js";import{S as Ce}from"./SecondaryButton-f5ea60a7.js";import{P as Ae}from"./PrimaryButton-6102adfd.js";import{d as A}from"./dayjs.min-0ca5a2a2.js";import{$ as Y}from"./disclosure-9bece854.js";import{X as Te}from"./transition-1e2b0758.js";import"./ApplicationLogo-ed865fd2.js";import"./iconBase-a1a0f175.js";/* empty css                      */import"./combobox-b4ee8432.js";import"./portal-8468025e.js";import"./close-provider-3c7c4627.js";function Pe({organization:i,accounts:J,journal:n,ledgers:V,program:m,department:u,project:x,programs:P,departments:O,projects:F}){var $;const[h,w]=d.useState([]),[f,N]=d.useState([]),[g,R]=d.useState({id:null,name:"",code:""}),[z,Oe]=d.useState(""),[D,B]=d.useState({id:null,name:"",code:""}),[X,Fe]=d.useState(""),[y,K]=d.useState({id:null,name:"",code:""}),[q,Re]=d.useState(""),{data:r,setData:c,patch:Q,reset:Be,errors:Ke,setError:Ue,processing:W}=je({date:"",no_ref:"",description:"",is_approved:!1,program_id:null,project_id:null,department_id:null,accounts:[]}),[j,G]=d.useState({startDate:n.date,endDate:n.date}),[S,Z]=d.useState(0),[_,ee]=d.useState(0),[se]=Ie(j,500),te=ke(j);d.useEffect(()=>{let t=[...h],s=[...f],l=[];V.map(a=>{t=[...t,{id:a.account.id,name:a.account.name,code:a.account.code,is_cash:a.account.is_cash}],s=[...s,""],l=[...l,{id:a.account.id,name:a.account.name,code:a.account.code,debit:a.debit,credit:a.credit,is_cash:a.account.is_cash}]}),w(t),m&&B({id:m.id,code:m.code,name:m.name}),x&&R({id:x.id,code:x.code,name:x.name}),u&&K({id:u.id,code:u.code,name:u.name}),N(s),c({date:n.date,no_ref:n.no_ref,description:n.description,is_approved:n.is_approved,accounts:l,program_id:m==null?void 0:m.id,project_id:x==null?void 0:x.id,department_id:u==null?void 0:u.id})},[]),d.useEffect(()=>{if(te!==void 0&&j.startDate){let t=A(j.startDate),s=`${t.month()+1}-${t.year()}`,l=A(n.date),a=`${l.month()+1}-${l.year()}`;s!==a?ae():c("code",n.no_ref)}},[se]),d.useEffect(()=>{let t=r.accounts.reduce((l,a)=>l+a.debit,0);Z(t);let s=r.accounts.reduce((l,a)=>l+a.credit,0);ee(s)},[r]);const ae=()=>{ve.reload({only:["newRef"],data:{date:A(j.startDate).format("YYYY-MM-DD")},onSuccess:t=>{c("no_ref",t.props.newRef)}})},le=(t,s)=>{const{value:l}=t,a=[...r.accounts];a[s]={...a[s],debit:parseInt(l)},c("accounts",a)},ce=(t,s)=>{const{value:l}=t,a=[...r.accounts];a[s]={...a[s],credit:parseInt(l)},c("accounts",a)},re=t=>{G(t),c("date",A(t.startDate).format("YYYY-MM-DD"))},de=t=>{const s=[...r.accounts];s.splice(t,1),c("accounts",s);const l=[...h];l.splice(t,1),w(l);let a=[...f];a.splice(t,1),N(a)},ie=()=>{const t=[...r.accounts,{account_id:null,account_name:"",account_code:"",debit:0,credit:0,is_cash:!1}];c("accounts",t);const s=[...h,{id:null,name:"",code:"",is_cash:!1}];w(s);let l=[...f];l=[...l,""],N(l)},ne=(t,s)=>{var p,b,H,L;const l=[...h];l[s]=t,w(l);const a=[...r.accounts];a[s]={...a[s],id:(p=l[s])==null?void 0:p.id,code:(b=l[s])==null?void 0:b.code,name:(H=l[s])==null?void 0:H.name,is_cash:(L=l[s])==null?void 0:L.is_cash},c("accounts",a);let o=[...f];o[s]="",N(o)},oe=t=>{B(t),c("program_id",t.id)},me=()=>{B({id:null,name:"",code:""}),c("program_id",null)},ue=t=>{R(t),c("project_id",t.id)},xe=()=>{R({id:null,name:"",code:""}),c("project_id",null)},he=t=>{K(t),c("department_id",t.id)},pe=()=>{K({id:null,name:"",code:""}),c("department_id",null)},fe=t=>{t.preventDefault(),Q(route("data-ledger.journal.update",{organization:i.id,journal:n.id}),{onSuccess:s=>{C.success("Jurnal Berhasil Diubah",{position:C.POSITION.TOP_CENTER})},onError:s=>{const l=Object.entries(s).map(([o,p])=>({key:o,value:p}));let a=[];for(let o=0;o<f.length;o++){let p="";l.map(b=>{b.key.split(".").length===3&&b.key==`accounts.${o}.id`&&(p="required")}),a=[...a,p]}N(a),s!=null&&s.empty&&C.error("Nilai Debit Dan Kredit Tidak Boleh Kosong",{position:C.POSITION.TOP_CENTER})},preserveScroll:!0})};return e.jsxs(e.Fragment,{children:[e.jsx(Ne,{title:"Ubah Jurnal Umum"}),e.jsx(Ee,{}),e.jsx(d.Suspense,{fallback:e.jsx("div",{children:"Loading"}),children:e.jsx(De,{onSubmit:fe,children:e.jsx("div",{className:"w-full sm:mt-2 sm:py-5",children:e.jsxs("div",{className:"sm:mx-auto px-3 sm:px-5",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-3",children:[e.jsxs("div",{className:"sm:w-1/4 w-full text-slate-900 space-y-2",children:[e.jsx("div",{children:e.jsx(v,{value:"Tanggal"})}),e.jsx("div",{children:e.jsx(be,{value:j,onChange:re,classNames:"border-2",useRange:!1,asSingle:!0,placeholder:"Tanggal",id:"date"})})]}),e.jsxs("div",{className:"sm:w-1/4 w-full text-slate-900 space-y-2",children:[e.jsx("div",{children:e.jsx(v,{value:"No. Ref",htmlFor:"no_ref"})}),e.jsx("div",{children:e.jsx(I,{id:"no_ref",className:"w-full",value:r.no_ref,onChange:t=>c("no_ref",t.target.value)})})]}),e.jsxs("div",{className:"sm:w-1/2 w-full text-slate-900 space-y-2",children:[e.jsx("div",{children:e.jsx(v,{value:"Deskripsi",htmlFor:"description"})}),e.jsx("div",{children:e.jsx(I,{id:"description",className:"w-full",value:r.description,onChange:t=>c("description",t.target.value)})})]})]}),(F.length>0||P.length>0||O.length>0)&&e.jsx("div",{className:"mt-3",children:e.jsx(Y,{children:({open:t})=>e.jsxs(e.Fragment,{children:[e.jsx(Te,{enter:"transition duration-100 ease-out",enterFrom:"transform scale-95 opacity-0",enterTo:"transform scale-100 opacity-100",leave:"transition duration-75 ease-out",leaveFrom:"transform scale-100 opacity-100",leaveTo:"transform scale-95 opacity-0",children:e.jsx(Y.Panel,{children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-start gap-3 sm:py-5 mb-3",children:[P.length>0&&e.jsxs("div",{className:"sm:w-1/3 w-full text-slate-900 space-y-2",children:[e.jsx("div",{children:e.jsx(v,{value:"Program Kegiatan",htmlFor:"program"})}),e.jsxs("div",{className:"flex w-full relative",children:[e.jsxs("div",{className:"w-5/6",children:[e.jsx(E,{resources:P,selected:D,setSelected:s=>oe(s),maxHeight:"max-h-40",placeholder:"Cari Program Kegiatan",isError:!!X,id:"program"}),D.id&&e.jsxs("span",{className:"text-xs absolute",children:["Kode: ",D.code]})]}),D.id&&e.jsx("div",{className:"w-1/6 my-auto",children:e.jsx("button",{type:"button",className:"text-red-500 text-xl hover:bg-slate-200 rounded-full p-2",onClick:me,children:e.jsx(k,{})})})]})]}),F.length>0&&e.jsxs("div",{className:"sm:w-1/3 w-full text-slate-900 space-y-2",children:[e.jsx("div",{children:e.jsx(v,{value:"Proyek",htmlFor:"project"})}),e.jsxs("div",{className:"flex w-full relative",children:[e.jsxs("div",{className:"w-5/6",children:[e.jsx(E,{resources:F,selected:g,setSelected:s=>ue(s),maxHeight:"max-h-40",placeholder:"Cari Proyek",isError:!!z,id:"project"}),g.id&&e.jsxs("span",{className:"text-xs absolute",children:["Kode: ",g.code]})]}),g.id&&e.jsx("div",{className:"w-1/6 my-auto",children:e.jsx("button",{type:"button",className:"text-red-500 text-xl hover:bg-slate-200 rounded-full p-2",onClick:xe,children:e.jsx(k,{})})})]})]}),O.length>0&&e.jsxs("div",{className:"sm:w-1/3 w-full text-slate-900 space-y-2",children:[e.jsx("div",{children:e.jsx(v,{value:"Departemen",htmlFor:"department"})}),e.jsxs("div",{className:"flex w-full relative",children:[e.jsxs("div",{className:"w-5/6",children:[e.jsx(E,{resources:O,selected:y,setSelected:s=>he(s),maxHeight:"max-h-40",placeholder:"Cari Departemen",isError:!!q,id:"department"}),y.id&&e.jsxs("span",{className:"text-xs absolute",children:["Kode: ",y.code]})]}),y.id&&e.jsx("div",{className:"w-1/6 my-auto",children:e.jsx("button",{type:"button",className:"text-red-500 text-xl hover:bg-slate-200 rounded-full p-2",onClick:pe,children:e.jsx(k,{})})})]})]})]})})}),e.jsx(Y.Button,{className:"flex w-full justify-between rounded-lg bg-slate-100 px-4 py-2 text-left text-sm font-medium text-slate-900 hover:bg-slate-200 focus:outline-none focus-visible:ring focus-visible:ring-slate-500/75",children:e.jsxs("div",{className:"flex justify-center w-full gap-3",children:[e.jsxs("span",{children:["Tampilkan Lebih ",t?"Sedikit":"Banyak"]}),e.jsx(ye,{className:`${t?"":"rotate-180 transform"} h-5 w-5 text-slate-500`})]})})]})})}),e.jsx("div",{className:"mt-5 overflow-x-auto",children:e.jsxs("div",{className:"w-[600px] md:w-full",children:[e.jsxs("div",{className:"flex font-bold gap-3 border-b py-3",children:[e.jsx("div",{className:"w-5/12",children:"AKUN"}),e.jsx("div",{className:"w-3/12 text-end",children:"DEBIT"}),e.jsx("div",{className:"w-3/12 text-end",children:"KREDIT"}),e.jsx("div",{className:"w-1/12 text-center",children:"#"})]}),($=r==null?void 0:r.accounts)==null?void 0:$.map((t,s)=>{var l;return e.jsxs("div",{className:"flex gap-3 py-3 mt-2",children:[e.jsxs("div",{className:"w-5/12 relative",children:[e.jsx(E,{resources:J,selected:h[s],setSelected:a=>ne(a,s),maxHeight:"max-h-40",placeholder:"Cari Akun",isError:!!f[s]}),((l=h[s])==null?void 0:l.code)&&e.jsxs("div",{className:"absolute text-xs",children:["Kode: ",h[s].code]})]}),e.jsx("div",{className:"w-3/12 text-end my-auto",children:e.jsx(M,{value:t.debit,customInput:I,onValueChange:a=>le(a,s),thousandSeparator:!0,className:"text-end w-full",prefix:"IDR "})}),e.jsx("div",{className:"w-3/12 text-end my-auto",children:e.jsx(M,{value:t.credit,customInput:I,onValueChange:a=>ce(a,s),thousandSeparator:!0,className:"text-end w-full",prefix:"IDR "})}),e.jsx("div",{className:"w-1/12 text-center my-auto",children:e.jsx("button",{className:"text-red-500 text-xl hover:bg-slate-200 rounded-full p-2",onClick:()=>de(s),children:e.jsx(k,{})})})]},s)}),e.jsx("div",{className:"py-3 mt-4",children:e.jsxs("button",{className:"w-full border bg-slate-100 hover:bg-slate-200 text-slate-500 py-3 flex justify-center gap-2",type:"button",onClick:ie,children:[e.jsx("div",{className:"my-auto",children:e.jsx(Se,{})}),e.jsx("div",{children:"Tambah Baris Baru"})]})})]})}),e.jsxs("div",{className:"md:flex font-bold gap-3",children:[e.jsx("div",{className:"w-5/12"}),e.jsxs("div",{className:"md:w-7/12 w-full md:flex border-t py-3 gap-12 px-3",children:[e.jsxs("div",{className:"md:w-1/2 w-full font-bold flex gap-1",children:[e.jsx("div",{className:"w-1/2",children:"TOTAL DEBIT "}),e.jsxs("div",{className:"w-1/2 text-end",children:["IDR ",U(S)]})]}),e.jsxs("div",{className:"md:w-1/2 w-full font-bold flex gap-1",children:[e.jsx("div",{className:"w-1/2",children:"TOTAL KREDIT "}),e.jsxs("div",{className:"w-1/2 text-end",children:["IDR ",U(_)]})]})]})]}),e.jsxs("div",{className:"md:flex font-bold gap-3",children:[e.jsx("div",{className:"w-5/12"}),e.jsxs("div",{className:"md:w-7/12 flex border-t py-3 gap-12 px-3",children:[e.jsx("div",{className:"w-1/2",children:"SELISIH "}),e.jsxs("div",{className:`w-1/2 text-end ${Math.abs(S-_)>0&&"text-red-500"}`,children:["IDR ",U(Math.abs(S-_))]})]})]}),e.jsxs("div",{className:"md:flex font-bold gap-3",children:[e.jsx("div",{className:"w-5/12"}),e.jsx("div",{className:"md:w-7/12 flex border-t py-3 gap-2 px-3",children:e.jsx("div",{className:"form-control",children:e.jsxs("label",{className:"label cursor-pointer gap-2",htmlFor:"checkbox",children:[e.jsx("input",{type:"checkbox",className:"checkbox",id:"checkbox",value:!r.is_approved,onChange:()=>c("is_approved",!r.is_approved),checked:!r.is_approved}),e.jsx("span",{className:"label-text",children:"Simpan Ke Dalam Draft"})]})})})]}),e.jsxs("div",{className:"flex justify-end flex-col-reverse sm:flex-row gap-2 mt-5",children:[e.jsx("div",{className:"w-full sm:w-1/12 my-auto text-center",children:e.jsx(T,{href:route("data-master.fixed-asset",i.id),children:e.jsx(Ce,{className:"w-full",children:e.jsx("div",{className:"text-center w-full",children:"Batal"})})})}),Math.abs(S-_)===0&&e.jsx("div",{className:"w-full sm:w-1/12 text-center",children:e.jsx(Ae,{className:"w-full",disabled:W,children:e.jsx("div",{className:"text-center w-full",children:"Ubah"})})})]})]})})})})]})}Pe.layout=i=>e.jsx(we,{header:e.jsx(ge,{children:"Edit Jurnal Umum"}),children:i,user:i.props.auth.user,organization:i.props.organization,title:"Edit Jurnal Umum",backLink:e.jsx(T,{href:route("data-ledger.journal",i.props.organization.id),children:e.jsx(_e,{})}),breadcrumbs:e.jsx("div",{className:"text-sm breadcrumbs",children:e.jsxs("ul",{children:[e.jsx("li",{className:"font-bold",children:e.jsx(T,{href:route("data-ledger",i.props.organization.id),children:"Buku Besar"})}),e.jsx("li",{className:"font-bold",children:e.jsx(T,{href:route("data-ledger.journal",i.props.organization.id),children:"Jurnal Umum"})}),e.jsx("li",{children:"Edit Jurnal Umum"})]})}),role:i.props.role});export{Pe as default};

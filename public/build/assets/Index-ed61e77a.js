import{r as c,S as E,j as e,m as me,L as xe,$ as x}from"./app-e83142f3.js";import{D as he,A as fe}from"./AuthenticatedLayout-9fce3876.js";import{H as pe}from"./Header-62783548.js";import{k as ve,Q as d}from"./react-toastify.esm-24c54db9.js";/* empty css                      */import{o as be,p as je,I as T,a as I,b as _e,c as Ne}from"./index.esm-b77cfcfa.js";import{M as Q}from"./Modal-8147e6bd.js";import{S as J}from"./SecondaryButton-a19a00db.js";import{P as ge}from"./PrimaryButton-8f455cec.js";import{C as ye}from"./ContainerDesktop-c52dc2d4.js";import{T as we,a as Se,P as Ce,C as ke}from"./ContentDesktop-2968678f.js";import{C as De}from"./ContentMobile-61b7ae96.js";import Te from"./SavingLedgerMobile-77711f10.js";import Ie from"./SavingLedgerDesktop-2f5e807f.js";import{I as y}from"./InputLabel-8c78f10a.js";import{T as q}from"./TextInput-b1394ab8.js";import{C as Ee}from"./ClientSelectInput-5b99565d.js";import{D as Oe}from"./DangerButton-fdcb9341.js";import{u as X,a as Z}from"./index.module-b9fb6ad6.js";import{a as G,b as W}from"./index.esm-d45a7681.js";import{H as w}from"./combobox-f36570d5.js";import{z as Fe}from"./transition-155365a3.js";import{N as Pe}from"./react-number-format.es-2b3823be.js";import{d as Me}from"./dayjs.min-55994c47.js";import{f as Re}from"./formatNumber-b542c689.js";import"./ApplicationLogo-b4a187c6.js";import"./iconBase-c9c81c8c.js";import"./portal-16ac43ea.js";import"./close-provider-3bd0d8d7.js";import"./index.esm-183097be.js";function Ae({resources:s,selected:r,setSelected:p,maxHeight:O="max-h-60",placeholder:F,onCLick:P,isError:M=!0,id:h="",contactFilter:R="",notFound:i}){const[o,S]=c.useState(R),[C,t]=c.useState(s),v=X(o),[k]=Z(o,500);c.useEffect(()=>{v!==void 0&&z()},[k]);const z=()=>{E.reload({only:["balances"],data:{contact:o},onSuccess:({props:n})=>{const{balances:m}=n;t(m)}})};return c.useEffect(()=>{S(r==null?void 0:r.name)},[r]),e.jsx(w,{value:r,onChange:p,children:e.jsxs("div",{className:"relative mt-1",children:[e.jsxs("div",{className:`relative w-full cursor-default rounded-md bg-white text-left border focus:outline-none focus-visible:ring-2 focus-visible:ring-white/75 focus-visible:ring-offset-2 focus-visible:ring-offset-teal-300 sm:text-sm ${M?"border-red-500":"border-gray-300"}`,children:[e.jsx(w.Input,{className:"w-full border-none py-3 pl-3 pr-10 leading-5 text-gray-800 focus:ring-0",displayValue:n=>n==null?void 0:n.no_ref.toUpperCase(),onChange:n=>S(n.target.value.toUpperCase()),placeholder:F,type:"search",id:h}),e.jsx(w.Button,{className:"absolute inset-y-0 right-0 flex items-center pr-3 text-gray-600 text-lg",onClick:P,children:e.jsx(be,{})})]}),e.jsx(Fe,{as:c.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx(w.Options,{className:`absolute mt-1 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black/5 focus:outline-none sm:text-sm ${O} z-10`,children:C.length===0&&o!==""?e.jsx("div",{className:"relative cursor-default select-none px-4 py-2 text-gray-700",children:i??"Tidak Ada Data"}):C.map(n=>e.jsx(w.Option,{className:({active:m})=>`relative flex cursor-default select-none py-2 pl-10 pr-4 ${m?"bg-teal-600 text-white":"text-slate-900"}`,value:n,children:({selected:m,active:A})=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:`block truncate ${m?"font-medium":"font-normal"}`,children:[e.jsxs("div",{className:"text-xs",children:["Kategori Simpanan: ",e.jsx("span",{className:"font-bold",children:n.saving_category.name.toUpperCase()})]}),e.jsxs("div",{className:"text-base",children:[n.student?`${n.student.no_ref?n.student.no_ref+"-":""}`:"",n.no_ref.toUpperCase()]}),e.jsx("div",{className:"text-xs",children:e.jsxs("span",{className:"text-[10px] font-bold",children:[n.contact.name," (",n.contact.contact_categories[0].name.toUpperCase(),")"]})})]}),m?e.jsx("div",{className:`absolute inset-y-0 left-0 flex items-center pl-3 ${A?"text-white":"text-teal-600"}`,children:e.jsx(je,{className:"h-5 w-5","aria-hidden":"true"})}):null]})},n.id))})})]})})}function $e({ledgers:s,organization:r,role:p,newRefCredit:O,newRefDebit:F,querySearch:P,balances:M,date:h,cashAccounts:R}){const{data:i,setData:o,post:S,patch:C,errors:t,setError:v,processing:k,reset:z,delete:n}=me({id:null,balance_id:null,balance_value:0,value:0,type:"",date:h,description:"",no_ref:"",cash_account_id:null}),[m,A]=c.useState({startDate:h,endDate:h}),[_,b]=c.useState({id:null,name:"",no_ref:"",balance_value:0}),[ee,j]=c.useState({id:null,name:"",code:"",is_cash:!0}),[B,$]=c.useState({title:"Tambah Data Simpanan",submit:"Tambah"}),[ae,f]=c.useState(!1),[se,D]=c.useState(!1),[L,N]=c.useState(!1),[u,U]=c.useState(P||""),[te]=Z(u,500),le=X(u);c.useEffect(()=>{le!==void 0&&ne()},[te]);const ne=()=>{E.reload({only:["ledgers"],data:{search:u},preserveState:!0})},H=a=>{$({title:(a.debit>0?"Tarik":"Tambah")+" Simpanan",submit:"Ubah"}),f(!0),N(!0),v({id:"",value:"",balance_id:"",balance_value:"",type:"",date:"",description:"",no_ref:"",cash_account_id:""}),o({id:a.id,value:a.debit>0?a.debit:a.credit,balance_id:a.saving_balance_id,balance_value:a.saving_balance.value,type:a.debit>0?"debit":"credit",date:a.date,description:a.description,no_ref:a.no_ref,cash_account_id:a.cash_account_id}),b({id:a.saving_balance.id,name:a.saving_balance.contact.name,no_ref:a.saving_balance.no_ref,balance_value:a.saving_balance.value}),j({id:a.cash_account_id,name:a.cash_account.name,code:a.cash_account.code,is_cash:!0})},V=a=>{o("id",a.id),D(!0)},ie=a=>{A(a),o("date",Me(a.startDate).format("YYYY-MM-DD"))},re=a=>{const{floatValue:l}=a;o("value",l)},oe=a=>{if(a){b({id:a.id,name:a.contact.name,no_ref:a.no_ref,balance_value:a.value});let l={...i};l={...l,balance_id:a.id,balance_value:a.value,description:`${a.contact.name} ${l.type=="credit"?"menambah":"menarik"} tabungan`},o(l)}},Y=()=>{v({id:"",value:"",balance_id:"",balance_value:"",type:"",date:"",description:"",no_ref:"",cash_account_id:""}),b({id:null,name:"",no_ref:"",balance_value:0}),j({id:null,name:"",code:"",is_cash:!0}),f(!0),N(!1),$({title:"Tambah Simpanan",submit:"Tambah"}),o({id:null,no_ref:O,balance_value:0,balance_id:null,value:0,type:"credit",date:h,description:"",cash_account_id:null})},K=()=>{v({id:"",value:"",balance_id:"",balance_value:"",type:"",date:"",description:"",no_ref:"",cash_account_id:""}),b({id:null,name:"",no_ref:"",balance_value:0}),j({id:null,name:"",code:"",is_cash:!0}),f(!0),N(!1),$({title:"Tarik Simpanan",submit:"Tarik"}),o({id:null,no_ref:F,balance_value:0,balance_id:null,value:0,date:h,type:"debit",description:"",cash_account_id:null})},ce=a=>{a&&(j({id:a.id,name:a.name,code:a.code,is_cash:!0}),o("cash_account_id",a.id),v("cash_account_id",""))},de=a=>{a.preventDefault(),L?C(route("cashflow.saving.ledger.update",{organization:r.id,ledger:i.id}),{onSuccess:({props:l})=>{const{flash:g}=l;E.replace(window.location.pathname),d.success(g.success,{position:d.POSITION.TOP_CENTER}),b({id:null,name:"",no_ref:"",balance_value:0}),j({id:null,name:"",code:"",is_cash:!0}),f(!1),N(!1)},onError:l=>{d.error(l.error,{position:d.POSITION.TOP_CENTER})}}):S(route("cashflow.saving.ledger.store",{organization:r.id}),{onSuccess:({props:l})=>{const{flash:g}=l;E.replace(window.location.pathname),d.success(g.success,{position:d.POSITION.TOP_CENTER}),b({id:null,name:"",no_ref:"",balance_value:0}),j({id:null,name:"",code:"",is_cash:!0}),f(!1),N(!1)},onError:l=>{console.log(l)}})},ue=a=>{a.preventDefault(),n(route("cashflow.saving.ledger.delete",{organization:r.id,ledger:i.id}),{onSuccess:({props:l})=>{const{flash:g}=l;d.success(g.success,{position:d.POSITION.TOP_CENTER}),D(!1)},onError:l=>{d.error(l.error,{position:d.POSITION.TOP_CENTER})}})};return e.jsxs(e.Fragment,{children:[e.jsx(xe,{title:"Tambah/Tarik Simpanan"}),e.jsx(ve,{}),p!=="viewer"&&e.jsxs("div",{className:"md:hidden fixed bottom-2 w-full z-40 flex",children:[e.jsx("div",{className:"px-2",children:e.jsx("button",{type:"button",className:"btn bg-green-800 text-white w-full",onClick:Y,children:e.jsx("div",{className:"text-xl font-bold rotate-90",children:e.jsx(G,{})})})}),e.jsx("div",{className:"px-2",children:e.jsx("button",{type:"button",className:"btn bg-orange-800 text-white w-full",onClick:K,children:e.jsx("div",{className:"text-xl font-bold -rotate-90",children:e.jsx(W,{})})})})]}),e.jsx(we,{zIndex:"z-50",search:u,setSearch:a=>U(a.target.value),pageBefore:s.links[0].url?e.jsx(x,{href:route("cashflow.saving.ledger",{organization:r.id,page:s.current_page-1,search:u}),preserveState:!0,only:["ledgers"],children:e.jsx(T,{})}):e.jsx("div",{className:"text-gray-300",children:e.jsx(T,{})}),pageAfter:s.links[s.links.length-1].url?e.jsx(x,{href:route("cashflow.saving.ledger",{organization:r.id,page:s.current_page+1,search:u}),only:["ledgers"],preserveState:!0,children:e.jsx(I,{})}):e.jsx("div",{className:"text-gray-300",children:e.jsx(I,{})}),page:e.jsxs(e.Fragment,{children:[s.current_page,"/",s.last_page]}),data:s}),e.jsx(De,{children:s.data.map(a=>e.jsx(Te,{ledger:a,handleDelete:()=>V(a),handleEdit:()=>H(a),role:p},a.id))}),e.jsxs(ye,{children:[e.jsxs(Se,{children:[e.jsx("div",{className:"my-auto w-7/12",children:p!=="viewer"&&e.jsxs("div",{className:"space-x-2",children:[e.jsx("button",{onClick:Y,className:"bg-green-800 px-4 py-2 text-white border border-transparent rounded-md font-semibold",children:e.jsx("div",{className:"text-xl font-bold rotate-90",children:e.jsx(G,{})})}),e.jsx("button",{onClick:K,className:"bg-orange-800 px-4 py-2 text-white border border-transparent rounded-md font-semibold",children:e.jsx("div",{className:"text-xl font-bold -rotate-90",children:e.jsx(W,{})})})]})}),e.jsxs("div",{className:"w-3/12 border flex rounded-lg",children:[e.jsx("label",{htmlFor:"search-input",className:"my-auto ml-2",children:e.jsx(_e,{})}),e.jsx("input",{id:"search-input",name:"search-input",type:"search",placeholder:"Cari",className:"w-full border-none focus:outline-none focus:ring-0",value:u||"",onChange:a=>U(a.target.value)})]}),e.jsx("div",{className:"italic text-xs my-auto w-1/12 text-center",children:e.jsx(Ce,{data:s})}),e.jsxs("div",{className:"my-auto flex space-x-2 w-1/12",children:[e.jsx("div",{className:"my-auto",children:s.links[0].url?e.jsx(x,{href:route("cashflow.saving.ledger",{organization:r.id,page:s.current_page-1,search:u}),preserveState:!0,only:["ledgers"],children:e.jsx(T,{})}):e.jsx("div",{className:"text-gray-300",children:e.jsx(T,{})})}),e.jsxs("div",{className:"my-auto",children:[s.current_page,"/",s.last_page]}),e.jsx("div",{className:"my-auto",children:s.links[s.links.length-1].url?e.jsx(x,{href:route("cashflow.saving.ledger",{organization:r.id,page:s.current_page+1,search:u}),only:["ledgers"],preserveState:!0,children:e.jsx(I,{})}):e.jsx("div",{className:"text-gray-300",children:e.jsx(I,{})})})]})]}),e.jsx("div",{className:"sm:flex hidden gap-5",children:e.jsx("div",{className:"w-full",children:e.jsx(ke,{children:e.jsxs("table",{className:"table table-pin-rows table-pin-cols text-base",children:[e.jsx("thead",{className:"text-base text-gray-900",children:e.jsxs("tr",{className:"",children:[e.jsx("th",{className:"bg-gray-200",children:"Tanggal"}),e.jsx("th",{className:"bg-gray-200",children:"No. Ref"}),e.jsx("th",{className:"bg-gray-200",children:"Rekening"}),e.jsx("th",{className:"bg-gray-200 text-end",children:"Jumlah"}),e.jsx("th",{className:"bg-gray-200"})]})}),e.jsx("tbody",{children:s.data.map((a,l)=>e.jsx(Ie,{ledger:a,className:`${l%2==0&&"bg-gray-100"}`,handleDelete:()=>V(a),handleEdit:()=>H(a),role:p},l))})]})})})})]}),e.jsx(Q,{show:ae,onClose:()=>f(!1),children:e.jsxs("form",{onSubmit:de,className:"p-6",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 border-b-2 py-1",children:B.title}),e.jsxs("div",{className:"mt-5 space-y-5",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row w-full gap-1",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(y,{htmlFor:"date",value:"Tanggal",className:"mx-auto my-auto"})}),e.jsxs("div",{className:"sm:w-2/3 w-full",children:[e.jsx(he,{value:m,onChange:ie,inputClassName:(t==null?void 0:t.date)&&"border-red-500 rounded-lg",useRange:!1,asSingle:!0,placeholder:"Tanggal",id:"date",displayFormat:"MMMM DD, YYYY"}),t&&t.date&&e.jsx("div",{className:"-mb-3",children:e.jsx("div",{className:"text-xs text-red-500",children:t.date})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row w-full gap-1",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(y,{htmlFor:"no_ref",value:"No. Ref",className:"mx-auto my-auto"})}),e.jsxs("div",{className:"sm:w-2/3 w-full",children:[e.jsx(q,{id:"no_ref",type:"text",name:"no_ref",value:i.no_ref,className:`mt-1 w-full ${t&&t.no_ref&&"border-red-500"}`,isFocused:!0,onChange:a=>o("no_ref",a.target.value.toUpperCase()),placeholder:"No. Ref"}),t&&t.no_ref&&e.jsx("div",{className:"-mb-3",children:e.jsx("div",{className:"text-xs text-red-500",children:t.no_ref})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row w-full gap-1",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(y,{htmlFor:"balance_id",value:"Kontak",className:"mx-auto my-auto"})}),e.jsxs("div",{className:"sm:w-2/3 w-full",children:[L?e.jsx("div",{className:"border px-3 py-2 rounded-lg",children:_.no_ref}):e.jsx(Ae,{resources:M,selected:_,setSelected:a=>oe(a),maxHeight:"max-h-40",placeholder:"Cari Kontak",isError:!!t.contact_id,id:"contact",notFound:e.jsxs("span",{children:["Tidak Ada Data. ",e.jsx(x,{className:"font-bold text-blue-600",href:route("data-master.contact.create",{organization:r.id}),children:"Buat Baru ?"})]})}),_.id&&e.jsxs("div",{className:"flex justify-between text-xs",children:[e.jsxs("div",{children:["Nama: ",e.jsx("span",{className:"font-bold",children:_.name})]}),e.jsxs("div",{children:["Sisa Saldo: ",e.jsxs("span",{className:"text-green-700 font-bold",children:["IDR. ",Re(_.balance_value)]})]})]}),t&&t.balance_id&&e.jsx("div",{className:"-mb-3",children:e.jsx("div",{className:"text-xs text-red-500",children:"Silakan isi kontak"})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row w-full gap-1",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(y,{htmlFor:"value",value:"Jumlah",className:"mx-auto my-auto"})}),e.jsxs("div",{className:"sm:w-2/3 w-full",children:[e.jsx(Pe,{value:i.value,customInput:q,onValueChange:a=>re(a),thousandSeparator:!0,className:`text-end w-full border ${t.value?"border-red-500":""}`,prefix:"IDR ",id:"value"}),t&&t.value&&e.jsx("div",{className:"-mb-3",children:e.jsx("div",{className:"text-xs text-red-500",children:t.value})})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row w-full gap-1",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(y,{htmlFor:"value",value:"Akun Kas",className:"mx-auto my-auto"})}),e.jsxs("div",{className:"sm:w-2/3 w-full",children:[e.jsx(Ee,{resources:R,selected:ee,setSelected:a=>ce(a),maxHeight:"max-h-40",placeholder:"Cari Akun",isError:!!t.cash_account_id,id:"account",contactFilter:""}),t&&t.cash_account_id&&e.jsx("div",{className:"-mb-3",children:e.jsx("div",{className:"text-xs text-red-500",children:t.cash_account_id})})]})]}),e.jsxs("div",{className:"mt-6 flex justify-end",children:[e.jsx(J,{onClick:a=>f(!1),children:"Batal"}),i.balance_id&&i.no_ref&&i.date&&i.cash_account_id&&i.value>0&&e.jsx(ge,{className:"ms-3",disabled:k,children:B.submit})]})]})]})}),e.jsx(Q,{show:se,onClose:()=>D(!1),children:e.jsxs("form",{onSubmit:ue,className:"p-6",id:"delete-confirmation",name:"delete-confirmation",children:[e.jsx("h2",{className:"text-lg font-medium text-gray-900 text-center",children:e.jsxs("div",{children:["Hapus Data Simpanan ",i==null?void 0:i.no_ref,"?"]})}),e.jsxs("div",{className:"mt-6 flex justify-end",children:[e.jsx(J,{onClick:()=>D(!1),children:"Batal"}),e.jsx(Oe,{className:"ms-3",disabled:k,children:"Hapus"})]})]})})]})}$e.layout=s=>e.jsx(fe,{header:e.jsx(pe,{children:"Data Simpanan"}),children:s,user:s.props.auth.user,organization:s.props.organization,title:"Data Simpanan",backLink:e.jsx(x,{href:route("cashflow.saving",s.props.organization.id),children:e.jsx(Ne,{})}),breadcrumbs:e.jsx("div",{className:"text-sm breadcrumbs",children:e.jsxs("ul",{children:[e.jsx("li",{className:"font-bold",children:e.jsx(x,{href:route("cashflow",s.props.organization.id),children:"Arus Kas"})}),e.jsx("li",{className:"font-bold",children:e.jsx(x,{href:route("cashflow.saving",s.props.organization.id),children:"Simpanan"})}),e.jsx("li",{children:"Tambah/Tarik Simpanan"})]})}),role:s.props.role});export{$e as default};

import{W as H,r as x,y as L,j as e,Y as J,a as h}from"./app-a7ce059d.js";import{D as Q,A as W}from"./AuthenticatedLayout-76fda790.js";import{H as q}from"./Header-0da6650e.js";import{k as G,Q as j}from"./react-toastify.esm-2e3bc2c6.js";/* empty css                      */import{c as X}from"./index.esm-9ab17142.js";import{F as Z}from"./FormInput-aa45199a.js";import{I as r}from"./InputLabel-8af4e50a.js";import{T as f}from"./TextInput-cd094612.js";import{S as ee}from"./SecondaryButton-1129a0a6.js";import{P as ae}from"./PrimaryButton-314b1799.js";import{d as v}from"./dayjs.min-4bdbfd9d.js";import"./studyYear-eecc7e88.js";import{C as se}from"./StudentSelectInput-b767d163.js";import{N as _}from"./react-number-format.es-af491b55.js";import{f as y}from"./formatNumber-b542c689.js";import{C as te}from"./ClientSelectInput-cc728f50.js";import{a as le,u as ne}from"./index.module-a7a23c76.js";import"./ApplicationLogo-02651b1a.js";import"./iconBase-9a3ee22c.js";import"./transition-b97dbf58.js";import"./combobox-873a095c.js";import"./portal-be516ad9.js";function de({organization:c,newRef:ie,contacts:b,date:ce,categories:g,studyYears:D,cashAccounts:S,payment:n}){const{data:d,setData:i,processing:C,patch:I,errors:s,setError:T,reset:oe}=H({contact_id:n.contact_id,date:n.date,level:n.contact.last_level.level,student_id:n.contact.student.no_ref,no_ref:n.no_ref,value:n.value,paidValue:n.value-n.receivable_value,study_year:n.study_year,description:n.journal.description,details:[],cash_account_id:null}),[p,F]=x.useState({id:n.contact.id,name:n.contact.name,phone:n.contact.phone}),[u,N]=x.useState({id:null,name:"",code:"",is_cash:!0}),[m,P]=x.useState({startDate:n.date,endDate:n.date}),[R]=le(m,500),Y=ne(m);x.useEffect(()=>{E()},[]),x.useEffect(()=>{if(Y!==void 0&&m.startDate){let a=v(m.startDate),t=`${a.month()+1}-${a.year()}`,l=v(n.date),o=`${l.month()+1}-${l.year()}`;t!==o?V():i("no_ref",n.no_ref)}},[R]);const E=()=>{let a=d,t=[];g.filter(l=>{let o=n.details.filter(w=>w.id==l.id);t=[...t,{id:l.id,name:l.name,value:o.length>0?o[0].pivot.value:0}]}),n.journal.ledgers.map(l=>{l.debit>0&&l.account.is_cash&&(a={...a,cash_account_id:l.account_id},N({id:l.account.id,name:l.account.name,code:l.account.code,is_cash:!0}))}),a={...a,details:t},i(a)},V=()=>{L.reload({only:["newRef"],data:{date:v(m.startDate).format("YYYY-MM-DD")},onSuccess:a=>{i("no_ref",a.props.newRef)}})},$=a=>{a.preventDefault(),I(route("cashflow.student-entry-payment.update",{organization:c.id,payment:n.id}),{onSuccess:({props:t})=>{const{flash:l}=t;j.success(l.success,{position:j.POSITION.TOP_CENTER})},onError:t=>{console.log(t),j.error(t.error,{position:j.POSITION.TOP_CENTER})},preserveScroll:!1})},A=a=>{P(a),i("date",v(a.startDate).format("YYYY-MM-DD"))},k=a=>{var l;let t=d;t={...t,study_year:a.target.value,description:`Pembayaran Iuran Tahunan dari ${(l=p==null?void 0:p.name)==null?void 0:l.toUpperCase()}  Tahun Ajaran ${a.target.value}`},i(t)},O=a=>{if(a){F({id:a.id,name:a.name,phone:a.phone});let t=d;t={...t,contact_id:a.id,description:`Pembayaran Iuran Tahunan dari ${a.name.toUpperCase()} Tahun Ajaran ${d.study_year}`,student_id:a.student.no_ref,level:a.last_level.level},i(t)}},U=a=>{a&&(N({id:a.id,name:a.name,code:a.code,is_cash:!0}),i("cash_account_id",a.id),T("cash_account_id",""))},M=(a,t)=>{const{value:l}=a;let o=[...d.details];o[t]={...o[t],value:parseInt(l)};let w=o.reduce((B,z)=>B+z.value,0);i({...d,details:o,value:w})},K=a=>{const{value:t}=a;i("paidValue",parseInt(t)??0)};return e.jsxs(e.Fragment,{children:[e.jsx(J,{title:"Piutang Iuran Tahunan Siswa"}),e.jsx(G,{}),e.jsx(Z,{onSubmit:$,children:e.jsx("div",{className:"w-full sm:mt-2 sm:py-5",children:e.jsxs("div",{className:"sm:w-1/2 sm:mx-auto px-3 sm:px-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(r,{value:"No. Ref",htmlFor:"no_ref",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(f,{id:"no_ref",name:"no_ref",className:`w-full ${(s==null?void 0:s.no_ref)&&"border-red-500"}`,placeholder:"No. Ref",value:d.no_ref||"",onChange:a=>i("no_ref",a.target.value.toUpperCase())}),(s==null?void 0:s.no_ref)&&e.jsx("span",{className:"text-red-500 text-xs",children:s.no_ref})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(r,{value:"Tanggal",htmlFor:"date",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx("div",{children:e.jsx(Q,{value:m,onChange:A,inputClassName:(s==null?void 0:s.date)&&"border-red-500 rounded-lg",useRange:!1,asSingle:!0,placeholder:"Tanggal",inputId:"date",displayFormat:"MMMM DD, YYYY"})}),(s==null?void 0:s.date)&&e.jsx("span",{className:"text-red-500 text-xs",children:s.date})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(r,{value:"Nama Siswa",htmlFor:"name",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(se,{resources:b,selected:p,setSelected:a=>O(a),maxHeight:"max-h-40",placeholder:"Cari Kontak",isError:!!s.contact_id,id:"name",notFound:e.jsxs("span",{children:["Tidak Ada Data. ",e.jsx(h,{className:"font-bold text-blue-600",href:route("data-master.students.create",{organization:c.id}),children:"Buat Baru ?"})]})}),(s==null?void 0:s.name)&&e.jsx("span",{className:"text-red-500 text-xs",children:s.name})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(r,{value:"No. Siswa",htmlFor:"student_id",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(f,{id:"student_id",name:"student_id",className:`w-full ${(s==null?void 0:s.student_id)&&"border-red-500"}`,placeholder:"No. Siswa",value:d.student_id||"",onChange:a=>i("student_id",a.target.value.toUpperCase()),disabled:!0}),(s==null?void 0:s.student_id)&&e.jsx("span",{className:"text-red-500 text-xs",children:s.student_id})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(r,{value:"Kelas",htmlFor:"level",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(f,{id:"level",name:"level",className:`w-full ${(s==null?void 0:s.level)&&"border-red-500"}`,placeholder:"Kelas",value:d.level||"",onChange:a=>i("level",a.target.value.toUpperCase()),disabled:!0}),(s==null?void 0:s.level)&&e.jsx("span",{className:"text-red-500 text-xs",children:s.level})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(r,{value:"Tahun Ajaran",htmlFor:"study_year",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx("select",{className:"select select-bordered w-full",value:d.study_year,onChange:k,id:"study_year",children:D.map((a,t)=>e.jsx("option",{children:a.year},t))}),(s==null?void 0:s.study_year)&&e.jsx("span",{className:"text-red-500 text-xs",children:s.study_year})]})]}),e.jsx("div",{className:"text-center mt-5 font-bold",children:"Rincian Pembayaran"}),d.details.map((a,t)=>e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(r,{value:a.name,htmlFor:`category-${t}`,className:" mx-auto my-auto"})}),e.jsx("div",{className:"w-full sm:w-2/3",children:e.jsx(_,{value:a.value,customInput:f,onValueChange:l=>M(l,t),thousandSeparator:!0,className:"text-end w-full border",prefix:"IDR ",id:`category-${t}`})})]},t)),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 pt-5 sm:mt-2 font-bold text-xl",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:"TOTAL"}),e.jsxs("div",{className:"w-full sm:w-2/3 text-end",children:["Rp. ",y(d.value)]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(r,{value:"Jumlah Bayar",htmlFor:"paid-value",className:" mx-auto my-auto"})}),e.jsx("div",{className:"w-full sm:w-2/3",children:e.jsx(_,{value:d.paidValue,customInput:f,onValueChange:a=>K(a),thousandSeparator:!0,className:"text-end w-full border",prefix:"IDR ",id:"paid-value"})})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:"Sisa"}),e.jsxs("div",{className:"w-full sm:w-2/3 text-end",children:["Rp. ",y(d.value-d.paidValue)]})]}),d.paidValue>0&&e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-1 mt-5 sm:mt-2",children:[e.jsx("div",{className:"w-full sm:w-1/3 my-auto",children:e.jsx(r,{value:"Akun Kas",htmlFor:"account",className:" mx-auto my-auto"})}),e.jsxs("div",{className:"w-full sm:w-2/3",children:[e.jsx(te,{resources:S,selected:u,setSelected:a=>U(a),maxHeight:"max-h-40",placeholder:"Cari Akun",isError:!!s.cash_account_id,id:"account",contactFilter:""}),(u==null?void 0:u.code)&&e.jsxs("div",{className:"absolute text-xs",children:["Kode: ",u.code]}),(s==null?void 0:s.cash_account_id)&&e.jsx("span",{className:"text-red-500 text-xs",children:s.cash_account_id})]})]}),e.jsxs("div",{className:"flex justify-end flex-col-reverse sm:flex-row gap-2 mt-5",children:[e.jsx("div",{className:"w-full sm:w-1/6 my-auto text-center",children:e.jsx(h,{href:route("cashflow.student-entry-payment",c.id),children:e.jsx(ee,{className:"w-full",children:e.jsx("div",{className:"text-center w-full",children:"Kembali"})})})}),d.value-d.paidValue>=0&&e.jsx("div",{className:"w-full sm:w-1/6 text-center",children:e.jsx(ae,{className:"w-full",disabled:C,children:e.jsx("div",{className:"text-center w-full",children:"Ubah"})})})]})]})})})]})}de.layout=c=>e.jsx(W,{header:e.jsx(q,{children:"Ubah Pembayaran"}),children:c,user:c.props.auth.user,organization:c.props.organization,title:"Ubah Pembayaran",backLink:e.jsx(h,{href:route("cashflow.student-entry-payment",c.props.organization.id),children:e.jsx(X,{})}),breadcrumbs:e.jsx("div",{className:"text-sm breadcrumbs",children:e.jsxs("ul",{children:[e.jsx("li",{className:"font-bold",children:e.jsx(h,{href:route("cashflow",c.props.organization.id),children:"Arus Kas"})}),e.jsx("li",{className:"font-bold",children:e.jsx(h,{href:route("cashflow.student-entry-payment",c.props.organization.id),children:"Pembayaran Iuran Tahunan Siswa"})}),e.jsx("li",{children:"Ubah Pembayaran"})]})}),role:c.props.role});export{de as default};
